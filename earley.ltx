\documentclass[draft,12pt]{amsart}
\usepackage{float}

\usepackage[final]{listings}
\usepackage{float}
\usepackage{flafter}
\floatstyle{boxed}
\restylefloat{figure}
\usepackage{arydshln}
\usepackage{multirow}
\usepackage{needspace}

\usepackage{thmtools}

\newcommand{\Pipe}{\charâ€˜\|}
\newcommand{\See}[2]{\emph{see} #1}
\usepackage{amssymb}
\usepackage{wasysym} % Used for \Circle
\usepackage{algorithm}
\usepackage[commentColor=blue,italicComments=false]{algpseudocodex}
\usepackage{xspace}
\usepackage{graphicx}
\usepackage{ragged2e}
\usepackage{url}
\usepackage[final]{hyperref}
\usepackage{placeins}
\usepackage{mfirstuc}
\usepackage{ifdraft}
\usepackage[obeyDraft]{todonotes}
\usepackage{datetime2}
\ifdraft{
        \usepackage[
    colorspec=0,
    text=DRAFT\ \DTMnow{}\ DRAFT,
    angle=0,
    scale=1.5,
    fontsize=12pt,
    vpos=.5in
        ]{draftwatermark}
}{}

% Fix conflict between todonotes and amsart packages
% See http://ctan.math.washington.edu/tex-archive/macros/latex/contrib/todonotes/todonotes.pdf,
% p. 10.
\makeatletter
\providecommand\@dotsep{5}
\def\listtodoname{List of TODOs}
\def\listoftodos{\@starttoc{tdo}\listtodoname}
\makeatother

\makeatletter
\renewcommand{\listofalgorithms}{\@starttoc{loa}{List of algorithms}}
\let\l@algorithm=\l@figure
\makeatother

% Re hbox's, see
% https://tex.stackexchange.com/questions/241343/what-is-the-meaning-of-fussy-sloppy-emergencystretch-tolerance-hbadness
\raggedbottom

% Replaced by todonotes package
% \newcommand{\todo}[1]{\par{\large\bf Todo: #1}\par}

\newcommand{\mymathop}[1]{\mathop{\texttt{#1}}}
\newcommand{\mymathbin}[1]{\mathbin{\texttt{#1}}}

% For a type name, when it occurs in text
\newcommand{\type}[1]{\ensuremath{\texttt{#1}}}

\newcommand{\True}{\mbox{\sf T}\xspace}
\newcommand{\False}{\mbox{\sf F}\xspace}
\newcommand{\Trueword}{\sf true}
\newcommand{\Falseword}{\sf false}
\newcommand{\Neg}{\neg}
\newcommand{\Implies}{\supset}
\newcommand{\ImpliesAlt}{\Rightarrow}
\newcommand{\NEquiv}{\not\equiv}
\newcommand{\NEquivRel}{\mathrel{\not\equiv}}

\newcommand{\qeq}{\simeq}
\newcommand{\nqeq}{\not\simeq}
\newcommand{\unicorn}{\ensuremath{\bot}\xspace}
\newcommand{\TRUE}{\ensuremath{\mathbb T}\xspace}
\newcommand{\FALSE}{\ensuremath{\mathbb F}\xspace}

\newcommand{\mult}{\mathbin{\ast}}
\newcommand{\dfn}[1]{{\bf #1}}
\newcommand{\sep}{\,\mid\,}
\newcommand{\mydot}{\raisebox{.05em}{$\,\bullet\,$}}
\newcommand{\wmydot}{\raisebox{.05em}{$\,\,\bullet\,\,$}}
\newcommand{\cat}{\,.\,}
\newcommand{\wcat}{\,\,.\,\,}
\newcommand{\size}[1]{\ensuremath{\left | {#1} \right |}}
\newcommand{\Vsize}[1]{\ensuremath{\size{\var{#1}}}}
\newcommand{\bigsize}[1]{\ensuremath{\bigl| {#1} \bigr|}}
\newcommand{\order}[1]{\ensuremath{{\mathcal O}(#1)}\xspace}
\newcommand{\Oc}{\order{1}}
\newcommand{\On}{\order{\var{n}}}
\newcommand{\inference}[2]{\genfrac{}{}{1pt}{}{#1}{#2}}

\newcommand{\lastix}[1]{\ensuremath{\##1}}
\newcommand{\Vlastix}[1]{\ensuremath{\lastix{\V{#1}}}}
\newcommand{\VlastElement}[1]{\Velement{#1}{\Vlastix{#1}}}
\newcommand{\element}[2]{\ensuremath{\mathop{#1}
    \mathopen{}\left[#2\right]\mathclose{}}}
\newcommand{\Velement}[2]{\ensuremath{\mathop{\V{#1}}
    \mathopen{}\left[#2\right]\mathclose{}}}
\newcommand{\VVelement}[2]{\ensuremath{\mathop{\V{#1}}
    \mathopen{}\left[ \V{#2}
    \right]\mathclose{} }}

% \newcommand{\tuple}[1]{\ensuremath{\left\langle #1 \right\rangle}}
\newcommand{\tuple}[1]{\ensuremath{\mathopen{}\left[#1\right]\mathclose{}}}

\newcommand{\mcolon}{\mathrel:}
\newcommand{\mcoloncolon}{\mathrel{\vcenter{\hbox{$::$}}}}

% \newcommand{\suchthat}{\mcoloncolon}
% In this paper, use \mid
\newcommand{\suchthat}{\mid}
\newcommand{\quantify}[3]{% quantifier, binding, predicate
    \ensuremath{\mathrel{#1}#2 \; \suchthat \; #3}%
}

\newcommand{\existUniqQOp}{\mathop{\exists{!}}}
\newcommand{\existUniqQ}[2]{\quantify{\existUniqQOp}{#1}{#2}}
% extra {} in existQOP and univQOp to raise to baseline
\newcommand{\existQOp}{\mathop{\exists{}}}
\newcommand{\existQ}[2]{\quantify{\existQOp}{#1}{#2}}
\newcommand{\nexistQOp}{\mathop{\nexists{}}}
\newcommand{\nexistQ}[2]{\quantify{\nexistQOp}{#1}{#2}}
% extra {} in existQOP and univQOp to raise to baseline
\newcommand{\univQOp}{\mathop{\forall{}\,}}
\newcommand{\univQ}[2]{\quantify{\univQOp}{#1}{#2}}

% I use hyphens in variable names,
% so I need to ensure that subtraction is
% clearly distinguished by the typography
\newcommand{\subtract}{\,-\,}

\newcommand{\var}[1]{\ensuremath{\texttt{#1}}}
\newcommand{\V}[1]{\ensuremath{\texttt{\mbox{#1}}}}

\newcommand{\cfg}{CFG}

\newcommand{\de}{\mathrel{::=}}
\newcommand{\derives}{\Rightarrow}
\newcommand{\derivesRaw}[2]
    {\mathrel{\mbox{$\:\underset{#2}{\overset{#1}{\Rightarrow}}$}}}
\newcommand{\derivesW}[1]
    {\mathrel{\mbox{$\:\underset{#1}{\Rightarrow}$}}}
\newcommand{\derivesV}[1]{\derivesW{\V{#1}}}
\newcommand{\destar}
    {\mathrel{\mbox{$\:\stackrel{\!{\ast}}{\Rightarrow\!}\:$}}}
\newcommand{\destarW}[1]
    {\mathrel{\mbox{$\:\underset{#1}{\overset{\ast\:}{\Rightarrow}}$}}}
\newcommand{\destarV}[1]{\destarW{\V{#1}}}
\newcommand{\deplus}
    {\mathrel{\mbox{$\:\stackrel{\!{+}}{\Rightarrow\!}\:$}}}
\newcommand{\deplusW}[1]
    {\mathrel{\mbox{$\:\underset{#1}{\overset{{+}\:}{\Rightarrow}}$}}}
\newcommand{\deplusV}[1]{\deplusW{\V{#1}}}
\newcommand{\derivg}[1]{\mathrel{\mbox{$\:\Rightarrow\:$}}}
\newcommand{\derivrg}[2]{\mathrel{\mbox{$\:\stackrel{\!{#1}}%
        {\Rightarrow\!}\:$}}}

% For the type subscript for powersets
\newcommand{\setOf}[1]{{{#1}^{\mbox{\normalsize $\ast$}}}}

\newcommand{\set}[1]{{\left\lbrace #1 \right\rbrace} }
\newcommand{\bigset}[1]{{\bigl\lbrace #1 \bigr\rbrace} }
\newcommand{\Bigset}[1]{{\Bigl\lbrace #1 \Bigr\rbrace} }

\DeclareMathOperator{\wrt}{wrt}

% use internal counter of algorithmicx
\newcommand{\algnested}{ %
  \makeatletter\ALG@nested\makeatother %
}

\newcommand{\algstrut}{\rule{0pt}{.85\baselineskip}}



% I use parboxes in equations.  This sets a useful width for them.
\newlength{\mathparwidth}
\newlength{\longtagwidth}
\settowidth{\longtagwidth}{(99999)\quad}
\setlength{\mathparwidth}{\dimexpr\textwidth-\longtagwidth}
\newcommand{\myparbox}[2][\mathparwidth]{%
  \parbox[t]{#1}{%
  % \linespread{1.15}\selectfont
  \ignorespaces#2\par%
  }%
}
\newcommand{\mycpar}[2][\mathparwidth]{%
  \parbox[c]{#1}{\centering%
  % \linespread{1.15}\selectfont
  \ignorespaces#2\par%
  }%
}

\newcommand{\parcomment}[2]{\hspace{\dimexpr \algorithmicindent * #1}$\triangleright$ #2}

% \newcommand{\rawparcomment}[2][\algparwidth]{%
  % \myparbox[#1]{#2}%
% }
% \newcommand{\parcomment}[2][\algparwidth]{%
  % \myparbox[#1]{$\triangleright$ #2}%
% }
% \newcommand{\parcomment}[1]{\hspace{\dimexpr \algorithmicindent - \labelwidth }$\triangleright$
  % \protect\parbox[t]{\dimexpr \textwidth - (\algorithmicindent - \labelwidth)}{#1}%
% }

% I want to use 'call' outside of pseudocode
\newcommand\call[2]{\textproc{#1}\ifthenelse{\equal{#2}{}}{}{(#2)}}%

\newcommand{\mname}[1]{\mbox{\sf #1}}
% [O]perator [A]pplication
\newcommand{\Oname}[1]{\mname{#1}}
% The \mathopen{} and \mathclose{} eliminate unwanted extra space
\newcommand{\OA}[2]{\ensuremath{%
    \mathop{\Oname{#1}}\mathopen{}\left(#2\right)\mathclose{}%
}}
\newcommand{\VOA}[2]{\OA{#1}{\V{#2}}}
% [F]unction [A]pplication, replaces \myfn
\newcommand{\smallrawfn}[2]{\ensuremath{\mathop{#1}(#2)}}
% The \mathopen{} and \mathclose{} eliminate unwanted extra space
\newcommand{\rawfn}[2]{\ensuremath{\mathop{#1}\mathopen{}\left(#2\right)\mathclose{}}}
\newcommand{\Fname}[1]{\V{#1}}
\newcommand{\FA}[2]{\ensuremath{\rawfn{\mathop{\Fname{#1}}}{#2}}}
\newcommand{\VFA}[2]{\FA{#1}{\V{#2}}}

\newcommand{\cuz}{\ensuremath{\mathrel{\because}}\xspace}
\newcommand{\bcuz}{\linebreak[1]\cuz}

% * Reference meta tags ("classifying prefixes") use in this document:
% * From fancyref:
% Chapter chap:
% Section sec:
% Equation eq:
% Figure fig:
% Table tab:
% Enumeration enum:
% Footnote fn:
%
% * Not in fancyref
% Definition df:
% Epigraph epi:
% Theorem th:
% Lemma lm:
% Remark rm:
% Observation ob:
% Example ex:
% Page page:

% The "page:" metatag is for labels intended as the target of
% page references.

% The auto-placement of qed's fails a lot.
% Semi-manual replacement using \qedhere often fails as well.
% I went with % 100% manual placement,
% which in fact is not any more trouble,
% and which is the only way to guarantee the QED's wind up where I
% want them.

% Try to gather all the stuff to do with theoremoids here
% Start off with theorems, then the other theoremoids,
% mostly alphabetically.

\renewcommand{\qedsymbol}{}
\newcommand{\myqed}{%
  \ifmmode\square
  \else$\square$
  \fi%
}

\newcommand{\colonpageref}[1]{%
 \ifthenelse{\equal{\pageref{#1}}{\thepage}}%
  {}{{:}\pageref*{#1}}%
}

% genref -- generic reference
\newcommand{\genref}[3][]{%
    \ifthenelse{\equal{#1}{}}{}{%
      \ifmmode \text{``#1''}%
      \else``#1'' %
      \fi%
    }%
    (\ensuremath{% To cover both cases, force math mode
        \hyperref[#2]{%
            \textrm{#3}\ref*{#2}\colonpageref{#2}%
        }%
    })%
}

\newcommand{\Sref}[2][]{\genref[#1]{sec:#2}{S}}

\theoremstyle{definition}

% theoremoids: Th

\newtheorem{theorem}{Theorem}
\newcommand{\Thref}[2][]{%
    \genref[#1]{th:#2}{Th}%
}
% some day delete \longThref
\newcommand{\longThref}[2]{%
  \ifmmode \text{``#1''\Thref{#2}}%
  \else``#1'' \Thref{#2}%
  \fi%
}
% "full" ref -- always includes page
\newcommand{\ThFref}[1]{(\textrm{Th}\ref{#1}:\pageref{#1})}
\newcommand{\thEnd}{\Circle}

% theoremoids: Df

\newtheorem{definition}[theorem]{Definition}
\newcommand{\Dfref}[2][]{%
    \genref[#1]{df:#2}{Df}%
}
\newcommand{\dfEnd}{\Circle}

% theoremoids: Eq

\newcommand{\Algref}[1]{\genref{alg:#1}{Alg}}
\newcommand{\Eqref}[1]{\genref{eq:#1}{Eq}}

% theoremoids: Ex

\newtheorem{example}[theorem]{Example}
\newcommand{\Exref}[1]{\genref{ex:#1}{Ex}}
\newcommand{\exEnd}{\Circle}

% theoremoids: Ob

\newtheorem{observation}[theorem]{Observation}
\newcommand{\Obref}[1]{\genref{ob:#1}{Ob}}
\newcommand{\obEnd}{\Circle}

% theoremoids: Rm

\newtheorem{remark}[theorem]{Remark}
\newcommand{\Rmref}[2][]{\genref[#1]{rm:#2}{Rm}}
\newcommand{\rmEnd}{\Circle}

% local theoremoids: Lm

\newtheorem{lemma}[theorem]{Lemma}
\newcommand{\Lmref}[2][]{\genref[#1]{lm:#2}{Lm}}
% some day delete \longLmref
\newcommand{\longLmref}[2]{%
  \ifmmode \text{``#1''\Lmref{#2}}%
  \else``#1'' \Lmref{#2}%
  \fi%
}
\newcommand{\lmEnd}{\thEnd}

\newcommand{\naturals}{\ensuremath{\mathbb{N}}\xspace}
\newcommand{\countables}{\ensuremath{\mathbb{CNT}}\xspace}
\newcommand{\integers}{\ensuremath{\mathbb{Z}}\xspace}

\hyphenation{oper-and oper-ands}
\hyphenation{look-ahead}
\hyphenation{memo-ization}
\hyphenation{aleth-eme}
\hyphenation{aleth-emes}
\hyphenation{llguid-ance}

% I like to silence underfull hbox messages.
% This is syntactic sugar for doing that.
\newenvironment{MYsloppy}[1][3em]{\par\tolerance9999 \emergencystretch#1\relax}{\par}
% This form allows the resetting of hbadness, which may be necessary to
% shut up an "underfull" warning.
\newenvironment{MYsloppyB}[2]{\par\tolerance9999 \emergencystretch#1 \hbadness#2\relax}{\par}
% This form is for a trick:  Tolerances are evaluated line by line, so a tolerance
% less than 9999 may produce a better looking paragraph and reduce the "badness".
\newenvironment{MYsloppyC}[3]{\par\tolerance#3 \emergencystretch#1 \hbadness#2\relax}{\par}

\title
  [Lostwave Earley]
  {Correctness proofs for a the Lostwave variant of Earley's algorithm}

\author{Jeffrey Kegler}
\ifdraft{ \thanks{DRAFT as of \DTMnow} }{}
\date{\DTMnow.}

\newcommand\textvtt[1]{{\normalfont\fontfamily{cmvtt}\selectfont #1}}
\newcommand{\llguidance}{\textvtt{llguidance}\xspace}
\newcommand{\LEV}{{Lostwave Earley}\xspace}
\newcommand{\pref}[1]{\ref{#1} on page~\pageref{#1}\xspace}

\begin{document}

\maketitle
\tableofcontents

\section{About this document}
\label{sec:about-me}

This document contains a proof of correctness for \LEV.
It assumes familiarity with parsing theory.
Familiarity with the code in \LEV
and with the traditional proof of correctness
for Earley's algorithm~\cite[pp. 323-325]{AH1972v1}
will be helpful.

\section{Conventions}
\noindent $\bullet$
``AF'' and its capitalization variants abbreviates
``assumption for''.
For example ``AF theorem'' abbreviates
``assumption for the theorem''.
\par
\noindent $\bullet$
``Iff'' and its capitalization variants abbreviates
``if and only if''.
\par
\noindent $\bullet$
``Wlog'' and its capitalization variants abbreviates
``without log of generality''.
\par
\noindent $\bullet$
``Wrt'' and its capitalization variants abbreviates
    ``with respect to''.
    \par
\noindent $\bullet$
Ranges are inclusive start,
    exclusive end, so that, for example,
        \begin{gather*}
            \element{(\texttt{"abcd"})}{0,2} = \texttt{"ab"} \text{, and} \\
            \element{(\texttt{"abcd"})}{2,3} = \texttt{"c"}.
        \end{gather*}
\par
\noindent $\bullet$ \TRUE is a boolean (or optional boolean) true; and
        \FALSE is a boolean (or optional boolean) false.
\par
\noindent $\bullet$ The epsilon symbol ($\epsilon$) is notation for the
empty string.

\section{Definitions}

\begin{definition}[The input \V{w}]
        In  this paper, \V{w} is a string of symbols.
        The ``symbols'' are, for our purposes, an unordered
        set of opaque objects.
        We call the string \V{w}, the \textbf{input}.
        \dfEnd
\end{definition}

\begin{definition}[Grammar]
\label{df:grammar}
A grammar is a 5-tuple
\[
        \tuple{\V{N},\V{T},\V{P},\V{S}},
\]
where \V{N} (the non-terminals)
and \V{T} (the terminals) are disjoint sets of symbols.
$\V{S} \in \V{N}$ is
the \textbf{dedicated} start symbol.
\V{P} is the set of rules, or productions.
The rules are of the form
$\V{A} \de \V{rhs}$,
where $\V{A} \in \V{N}$
and
$\V{rhs} \in (\V{N}\cup\V{T})^\ast$.
\dfEnd
\end{definition}


\begin{definition}[The grammar \V{g}]
\label{df:g}
Every grammar in this document is the proper grammar
\[
        \V{g} = \tuple{\V{N},\V{T},\V{P},\V{S}}. \quad \dfEnd
\]
\end{definition}

\begin{definition}[Proper grammar]
\label{df:proper-grammar}
When we say that a grammar is \textbf{proper} we mean that it has
no unreachable symbols, no unproductive symbol,
        \todo{Define unreachable symbol}
        \todo{Define unproductive symbol}
        \todo{Define cycle}
and no cycles. \dfEnd
\end{definition}

\begin{definition}[Dedicated start symbol]
\label{df:dedicated-start}
        When we say the start symbol \V{S} is dedicated
        we mean that there is a dedicated start rule
        \[ \mycpar{$(\V{S} \de \V{rhs}) \in \V{P}$ for some $\V{rhs} \in \V{STR}$,} \]
        that \V{S} does not occur on any other LHS,
        \[ \nexistQ{\V{rhs2} \in \V{STR}}{\V{rhs2} \neq \V{rhs} \land (\V{S} \de \V{rhs2}) \in \V{P}}, \]
        and that \V{S} never occurs on a RHS,
         \[ \nexistQ{\alpha, \beta \in \V{STR},\V{A} \in \V{N}}{(\V{A} \de \alpha \cat \V{S} \cat \beta) \in \V{P}}.
                 \quad \dfEnd \]
\end{definition}

\begin{definition}[Earley edge]
We will write an \textbf{Earley edge}\footnote{%
For this document,
we have adapted chart parsing terminology
in place of the terminology used in the older
literature on Earley parsing.
The chart parsing terms are less overloaded,
and are more familiar to an audience with an
AI background.
What we call an ``Earley edge''
is traditionally
called an ``Earley item''.
What we call an ``Earley row'' is traditionally called
an ``Earley set''.
And what we call an ``Earley chart'' is traditionally
called an Earley table.}
as
\[
        \tuple{\V{A} \de \alpha \mydot \beta, \V{origin}, \V{current}}
\]
where $\alpha$ and $\beta$ are sentential forms,
\[
        \alpha \in (\V{N} \cup \V{T}^\ast) \land \beta \in (\V{N} \cup \V{T})^\ast,
\]
and $\V{A} \de \alpha \cat \beta$ is a rule in the grammar \V{g},
\[
        (\V{A} \de \alpha \cat \beta) \in \V{P}.
\]
A large raised dot ($\mydot$) indicates
the \textbf{dot location} within the rule.
\V{origin} is the location of the start of the Earley edge in the input,
also called the \textbf{origin}.
\V{current} is
the location of the dot within the input,
also called the \textbf{current location}.
\dfEnd
\end{definition}

\begin{definition}[Predot symbol]
In an Earley edge
\[
        \tuple{\V{A} \de \alpha \mydot \beta, \V{origin}, \V{current}},
\]
we call the last symbol in $\alpha$, \element{\alpha}{\lastix{\alpha}},
the predot symbol.
When $\size{\alpha} = 0$, there is no predot symbol. \dfEnd
\end{definition}

\begin{definition}[Types of Earley edge]
        \label{df:ee-types}
We say that
\begin{itemize}
\item an Earley edge is a \textbf{start edge}
        if its LHS is the start symbol and
        it has no predot symbol;
\item an Earley edge is \textbf{predicted}, or a \textbf{prediction}
        if its LHS is not the start symbol and
        it has no predot symbol;
\item an Earley edge is \textbf{confirmed}, or a \textbf{confirmation},
        if it has a predot symbol;
\item an Earley edge is \textbf{scanned}, or a \textbf{scansion},
        if its predot symbol is a terminal,
         $\element{\alpha}{\lastix{\alpha}} \in \V{T}$;
\item an Earley edge is \textbf{reduced}, or a \textbf{reduction},
        if its predot symbol is a non-terminal;
        $\element{\alpha}{\lastix{\alpha}} \in \V{N}$; \qquad \dfEnd
\end{itemize}
\end{definition}

\begin{definition}[Strings]
\label{df:string}
        A \textbf{string} is a sequence whose members are
        elements of the set $(\V{N}\cup\V{T})$.
        In this document, we will use the symbol \V{STR} for set of finite
        strings,
        and $\V{STR}^+$ for set of non-empty finite strings:
        \[ \V{STR}^+ = \V{STR} \subtract \epsilon. \]
        A \textbf{terminal string} is a sequence whose members are
        elements of the set \V{T}.
        In this document, we will use the symbol \V{TSTR} for set of finite
        terminal strings,
        and $\V{TSTR}^+$ for set of non-empty finite terminal strings:
        \[ \V{TSTR}^+ = \V{TSTR} \subtract \epsilon.  \dfEnd \]
\end{definition}

\begin{definition}[SF transition]
        \label{df:transition}
        An \textbf{SF transition}
        is a duple of two sentential forms,
        such that a non-terminal member in the first element of the pair
        is expanded, according to a rule of \V{g}, in the second element of the pair.
        More precisely, let $\V{tr} = (\V{Lstr}, \V{Rstr})$ be an SF transition.
        Then, without loss of generality,
        \begin{equation}
                \V{Lstr} = \alpha \cat \V{A} \cat \beta \\
                \land \; \V{Rstr} = \alpha \cat \V{rhsA} \cat \beta \\
                \land \; \V{A} \de \V{rhsA} \in \V{P}
        \end{equation}
        where $\alpha$ and $\beta$ are strings.
        Overloading terminology a bit,
        \V{A} is called the \textbf{LHS symbol} of \V{tr},
        \V{rhs} is called the \textbf{direct expansion} of \V{tr},
        \V{Lstr} is called the \textbf{LHS step} of \V{tr},
        and \V{Rstr} is called the \textbf{RHS step} of \V{tr}.
        \dfEnd
\end{definition}

\begin{definition}[Full derivation]
        \label{df:full-derivation}
        A derivation, call it \V{drv}, is a sequence of strings
        \begin{itemize}
                \item the first of which consists only of the start symbol, \V{S}; and
                \item and such that every consecutive pair of the sequence is a string transition.
        \end{itemize}
        The individual members of a derivation are strings,
        and in the context of the derivation are called \V{steps}.
        \dfEnd
\end{definition}

\begin{definition}[Trivial derivation]
        In the SF transition
        \[ ( (\alpha \cat \V{A} \cat \beta), (\alpha \cat \V{rhsA} \cat \beta), \]
        where $\V{A} \de \V{rhsA} \in \V{P}$,
        the symbols in
        $\alpha$ and $\beta$ are simply copied --- they can
        be said to be derived from themselves.
        We say that the
        $\alpha$ and $\beta$ in \V{Rstr}
        are \textbf{trivially derived} from
        $\alpha$ and $\beta$ in \V{Lstr}.
        We also that that
        the substrings of $\alpha$ and $\beta$ in \V{Lstr}
        are \textbf{trivially derived} from
        the corresponding substrings of $\alpha$ and $\beta$ in \V{Lstr};
        and that
        the symbol instances of $\alpha$ and $\beta$ in \V{Lstr}
        are \textbf{trivially derived} from
        the corresponding symbol instances in $\alpha$ and $\beta$ in \V{Lstr};
\dfEnd
\end{definition}

\begin{definition}[Symbol instance]
        A symbol may occur many times in a derivation.
        Each occurrence can be identified by the index of the step (\V{stepIX}),
        within the derivation (\V{drv}),
        and the index (\V{pos}) of the symbol occurrence within the string,
        so that the triple $(\V{stepIX}, \V{pos}, \V{drv})$ represents
        a symbol instance.
        More practically, we will tag symbols with an instance identifier,
        separated from the symbol name by a colon, for example,
        \begin{equation}
                \label{eq:df-instance-010}
                \V{A:f,0}.
        \end{equation}
        The instance tag consists of a major and minor identifier,
        separated by a comma.
        For example in \eqref{eq:df-instance-010},
        ``\texttt{A}'' is the symbol name,
        ``\texttt{f,0}'' is the instance tag,
        ``\texttt{f}'' is the major identifier, and
        ``\texttt{0}'' is the minor identifier.

        The major identifier of the tag is inherited by its trivial productions.
        The minor identifier of the tag is used to distinguish symbol instances
        with the same major identifier.

        The minor identifier is rarely necessary and is almost always omitted.
        For example, \eqref{eq:df-instance-010}
        would almost always be written \V{A:f}.

        When the minor indentifier is omitted,
        the reference is to the first occurrence in the derivation
        of an instance with that symbol and major identifier.
        The tag ``\texttt{f}'', as in \V{A:f}, is frequently used.
        The ``\texttt{f}''is intended to suggest that the instance is the current
        topic or ``focus''.

        Instance tags are also used after strings,
        to indicate that every symbol instance in the string instance has that
        instance tag.
        For example, if
        \[
        \V{predot} = \V{A}\cat\V{B}\cat\V{C},
        \]
        then
        \[
        \V{predot:f} = \V{A:f}\cat\V{B:f}\cat\V{C:f}. \quad \dfEnd
        \]
\end{definition}

\begin{definition}[Sentences and Sentential forms]
Every step in the derivation is a \textbf{sentential form}.
If a sentential form consists entirely of terminals,
it is a \textbf{sentence}.
\dfEnd
\end{definition}

\begin{definition}[Aletheme]
        \label{df:aletheme}
        An \textbf{Earley aletheme}, or \textbf{aletheme},
        is an 8-tuple
        \begin{equation}
        \begin{gathered}
                (\V{drv},\V{fore},\V{aft},\V{pre},\V{post},\V{lhs},\V{origin},\V{current}) \\
                \text{where \V{drv} is a derivation,} \\
                \V{fore},\V{aft},\V{pre},\V{post} \in \V{STR}, \\
                \V{lhs} \in \V{N} \text{, and}, \\
                \V{origin},\V{current} \in \naturals.
        \end{gathered}
        \end{equation}
        An aletheme is considered \textbf{sound} if and only if
        \begin{gather}
                \V{A} \de \V{pre} \cat \V{post} \in \V{P} \\
                \land \; \V{S} \destarV{drv} \V{fore} \cat \V{lhs} \cat \V{aft} \\
                \land \; \V{pre} \destarV{drv} \Velement{w}{\V{origin},\V{current}} \\
                \land \; \V{fore} \destarV{drv} \Velement{w}{0,\V{origin}}. \quad \dfEnd
        \end{gather}
\end{definition}

An aletheme is so called because it is the smallest unit of soundness
in an Earley parsing context.  It comes from \textit{\kern-2pt alethes},
the Greek word
for ``truth''.

\begin{definition}[Predot and postdot symbol instance]
\label{df:predot-symbol-instance}
Let
\[ \V{al} = (\V{drv},\V{fore},\V{aft},\V{pre},\V{post},\V{lhs},\V{origin},\V{current}) \]
be an aletheme.
The \textbf{predot symbol instance} is the last symbol instance in \V{pre}.
The predot symbol instance does not exist if $\V{pre} = \epsilon$.
The \textbf{postdot symbol instance} is the first symbol instance in \V{post}.
The postdot symbol instance does not exist if $\V{post} = \epsilon$.
\dfEnd
\end{definition}

\begin{definition}[Earley edge concepts and alethemes]
\label{df:ee-al-concept}
        An Earley edge concept applied to an aletheme
        applies to the Earley edge of the aletheme.
        For example, an aletheme
        is a reduction if its Earley edge is a reduction.
        \dfEnd
\end{definition}

\begin{definition}[Tangible symbol]
        \label{df:tangible-symbol}
        In the context of a derivation,
        a \textbf{tangible} symbol instance is one that produces
        at least one terminal,
        and an \textbf{intangible} symbol instance in one that is
        not tangible.
        \dfEnd
\end{definition}

\begin{definition}[Tangible reduction aletheme]
        \label{df:tangible-reduction}
        A \textbf{tangible reduction aletheme}
        is a reduction aletheme whose
        predot symbol instance is tangible.
        An \textbf{intangible reduction aletheme}
        is a reduction aletheme
        whose predot symbol instance is intangible.
        \dfEnd
\end{definition}

\begin{definition}[Earley edge to aletheme correspondence]
        \label{df:ee-to-al}
Alethemes of the form
\begin{equation}
        \label{eq:df-ee-to-al-010}
        (\V{drv},\V{fore},\V{aft},\V{pre},\V{post},\V{lhs},\V{origin},\V{current})
\end{equation}
correspond to the Earley edge
\begin{equation}
        \label{eq:df-ee-to-al-020}
        \tuple{\V{A} \de \V{pre} \mydot \V{post}, \V{origin}, \V{current}}.
\end{equation}
In the other direction, the Earley edge \eqref{eq:df-ee-to-al-020}
\textbf{corresponds} to the alethemes of the form \eqref{eq:df-ee-to-al-010}.
We note that aletheme-to-edge correspondence is a many-to-one relationship.
\dfEnd
\end{definition}

\begin{definition}[Soundness]
Let \V{aleths} be the set of sound
alethemes for a grammar \V{g} and an input \V{w}.
Let \V{edges} be a set of Earley edges.
\V{edges} is \textbf{sound}
with respect to \V{aleths}
iff \V{edges} does not contain any nulling completions,
and if every element of \V{edges}
corresponds to an element of \V{aleths}.
\qquad \dfEnd
\end{definition}

\begin{definition}[Completeness]
\label{df:completeness}
Let \V{aleths} be a subset of the sound
alethemes for a grammar \V{g} and an input \V{w}.
An Earley chart is \textbf{complete}
with respect to \V{aleths} iff,
for every $\V{al} \in \V{aleths}$,
either \V{al} is a nulling completion,
or an Earley edge corresponding to \V{al} is in the Earley chart.
\dfEnd
\end{definition}

We note that our definition of \Dfref{completeness},
nulling completions.
This differs from
the usual definition of completeness in Earley parsing,
and is a special feature of the \LEV.

\begin{definition}[Rank]
        \label{df:rank}
        Let
        \[ \V{x} = (\V{drv},\V{fore},\V{aft},\V{pre},\V{post},\V{lhs},\V{origin},\V{current}) \]
        be an aletheme.
        The \textbf{depth} of \V{x}, \VFA{Dp}{x}, is the length of the shortest derivation such
        that
        \[ \V{S} \destarV{g} \V{fore} \cat \V{lhs} \cat \V{aft}. \]
        The \textbf{height} of \V{x}, \VFA{Ht}{x}, is the length of the shortest derivation such
        that
        \[ \V{fore} \cat \V{pre} \destarV{g} \Velement{w}{0,\V{current}}. \]
        The \textbf{rank} of \V{x} is
        \[ \VFA{Rank}{x} = \VFA{Dp}{x} + 2 \mult \VFA{Ht}{x}. \quad \dfEnd \]
\end{definition}

\begin{definition}[Transition expansion]
        \label{df:transition-expansion}
In the context of a derivation, expansions are defined recursively,
as follows:
\begin{itemize}
                \begin{MYsloppy}
\item The symbol instance string \V{str} is an
expansion of the LHS symbol instance of a transition \V{tr},
if \V{str} is the direct expansion of the transition \V{tr}.
\item The direct expansion of a symbol instance string \V{str2} is the concatenation
of the direct expansions of the symbol instances in \V{str2}.
\item A symbol instance string \V{str4} is an expansion of \V{str3} if
\V{str4} is a direct expansion of an expansion of \V{str3}.
\item A symbol instance string \V{str4} is an expansion of the symbol instance \V{A}
if \V{str4} is a direct expansion of an expansion of \V{A}.  \dfEnd
                \end{MYsloppy}
\end{itemize}
\end{definition}

\begin{definition}[Transition descendant]
        \label{df:transition-descendant}
In the context of a derivation,
a transition is considered to be a \textbf{descendant}
of the symbol instance \V{A:f} if its LHS symbol instance
is \V{A:f} or if its LHS symbol instance
is part of an expansion of \V{A:f}.
A transition is considered to be an descendant
of a string of symbol instances if it is a descendant
of any symbol instance in the string.
The descendant transitions are considered to be
\textbf{non-trivial descendants}
if they are non-trivial transitions.
\dfEnd
\end{definition}

\begin{definition}[Partial derivation]
        \label{df:partial-derivation}
        Let \V{fdrv} be a full derivation.
        We define a \textbf{partial derivation}
        from a symbol instance \V{A:f}
        to a symbol string instance \V{str:f},
        where \V{str:f} is an expansion of \V{A:f},
        as a 4-tuple
        \[ \V{drv} = (\V{fdrv}, \V{fromStep}, \V{toStep}, \V{lhsIx}), \]
        where
\begin{itemize}
        \item \V{fromStep} is the index in \V{fdrv} of the
step which contains \V{A:f};
\item \V{lhsIX} is the index of \V{A:f} in \VVelement{fdrv}{fromStep},
\item \V{toStep} is the index in \V{fdrv} of the step which contains \V{str:f}.
\end{itemize}
This implies that
\[ \element{\VVelement{fdrv}{fromStep}}{\V{lhsIX}} = \V{A:f}. \]
We call \V{A:f} the \textbf{source} of \V{drv}
and we call \V{str:f} the \textbf{target} of \V{drv}.
When it is clear we are speaking of a partial derivation, we often
refer to it simply as a \textbf{derivation}.
\dfEnd
\end{definition}

\begin{definition}[Partial derivation from string]
\label{df:partial-derivation-string}
Let \V{fdrv} be a full derivation.
We define a \textbf{partial derivation}
from a symbol string instance \V{src:f}
to a symbol string instance \V{tgt:f},
where \V{tgt:f} is an expansion of \V{src:f},
as a 5-tuple
\[ \V{drv} = (\V{fdrv}, \V{fromStep}, \V{toStep}, \V{lhsIx1}, \V{lhsIx2}), \]
where
\V{fromStep} in the index in the derivation of the
step which contains \V{Lstr:f},
\[ \element{\VVelement{drv}{fromStep}}{\V{lhsIx1},\V{lhsIx2}} = \V{src:f}, \]
and
\V{toStep} is the index in \V{drv} of the step which contains \V{tgt:f}.
We call \V{src:f} the \textbf{source} of \V{drv}
and we call \V{tgt:f} the \textbf{target} of \V{drv}.
\dfEnd
\end{definition}

\begin{definition}[Derivation length]
        \label{df:derivation-length}
        Let \V{fdrv} be a full derivation, and
        let $\V{drv} = (\V{fdrv}, \V{fromStep}, \V{toStep}, \V{lhsIx})$,
        be a partial derivation from a symbol instance in \V{drv},
        such that the source of \V{drv} is \V{A:t}.
        The \textbf{length} of \V{drv}
        is the number of
        transitions which are non-trivial descendants of \V{A:t}
        in the range of steps \Velement{fdrv}{\V{fromStep},\V{toStep}}.

        We define the \textbf{length of a partial derivation from a string}
        analogously.
        Let \V{fdrv} be a full derivation, and let
        \[ \V{drv} = (\V{fdrv}, \V{fromStep}, \V{toStep}, \V{lhsIx1}, \V{lhsIx2}), \]
        be a partial derivation from a symbol instance string in \V{drv},
        such that the source of \V{drv} is \V{$\alpha$:t}.
        The length of \V{drv}
        is the number of
        transitions which are non-trivial descendants of \V{$\alpha$:t}
        in the range of steps \Velement{fdrv}{\V{fromStep},\V{toStep}}.
\dfEnd
\end{definition}

\begin{observation}[Target symbol ancestry]
\label{ob:target symbol ancestor}
In a partial derivation from a string,
every symbol instance in the target string has
exactly one ancestor symbol in the source string.
\obEnd
\end{observation}

\begin{definition}[Image of source symbol in target string]
\label{df:source-image}
In a partial derivation,
The string composed of the symbols which share the
same ancestor symbol instance in the source string, is called
the \textbf{image} of that symbol instance in the target string.
\dfEnd
\end{definition}

\begin{observation}[Derivation source length concatenation]
\label{ob:derivation-source-length}
        The length of a partial derivation from a string to its target
        is the sum of the lengths of the partial derivations of the
        component symbols to their images in the target string.
\obEnd
\end{observation}

\begin{observation}[Derivation chaining]
\label{ob:derivation-chain}
Partial derivations that share the same full
derivation can be chained.
In every predecessor, successor pair of derivation
the target of the predecessor must be the source of the successor.
\obEnd
\end{observation}

\begin{observation}[Derivation chain length concatenation]
\label{ob:derivation-chain-length}
        The length of a chain of partial derivation is
        is the sum of the lengths of the partial derivations that
        are the components of the chain.
\obEnd
\end{observation}

\begin{definition}[Partial derivation notation]
\label{ob:partial-derivation-notation}
        We notate a partial derivation from \V{src} to \V{tgt} as
        \[ \V{src} \derivesRaw{\V{L}}{\V{X}} \V{tgt}, \]
        where \V{L} is a length indicator,
        and \V{X} is a derivation indicator.
        The length indicator \V{L} may be a natural number constant
        or variable, or one of the two special length indicators,
        ``$\ast$'' and ``$+$''.
        The indicator ``$\ast$'' specifies that the length can be
        any natural number.
        The indicator ``$+$'' specifies that the length can be
        any non-zero natural number.
        Where \V{L} is omitted, the length of the partial
        derivation is exactly one.

        The derivation indicator can be either a full derivation
        or \V{g}.
        When the derivation indicator is \V{g}, it specifies that
        the derivation may be any full derivation of \V{w} using
        grammar \V{g}.
        Omission of the derivation indicator is the same as
        specifying \V{g} as the derivation indicator.
\dfEnd
\end{definition}

\begin{definition}[Confirmation mainstem]
        \label{df:conf-stem}
        Suppose, without loss of generality, that
        \[ \V{down} = (\V{drv},\V{fore},\V{aft},(\V{antepre}\cat\V{B}),\V{post},\V{lhs},\V{origin},\V{current}) \]
        is an confirmed aletheme.
Then we say that
an aletheme of the form
\[
        \V{stem} = (\V{drv},\V{fore},\V{aft},\V{antepre},(\V{B} \cat \V{post}),\V{lhs},\V{origin},\V{j})
\]
is a \textbf{mainstem} of
\V{down} at the \textbf{joint location} \V{j}.
We also say that \V{down} is the \textbf{downstream channel}
(or simply \textbf{downstream})
of \V{mainstem}.
\dfEnd
\end{definition}

\begin{definition}[Reduction tributary]
\label{df:red-trib}
        Suppose, without loss of generality, that
        \[ \V{down} = (\V{drv},\V{fore},\V{aft},(\V{antepre}\cat\V{B}),\V{post},\V{lhs},\V{origin},\V{current}) \]
        is a sound confirmed aletheme.
        Where $\V{B} \de \V{rhs} \in \V{P}$,
then we say that
a sound aletheme of the form
        \[ \V{trib} = (\V{drv2},(\V{fore}\cat\V{antepre}),\V{aft},\V{rhs},\epsilon,\V{B},\V{j},\V{current}) \]
is a \textbf{tributary} of
\V{down} at the \textbf{joint location} \V{j}.
If $\V{drv} = \V{drv2}$,
then \V{trib} is a \V{direct tributary} of \V{down}.
We also say that \V{down} is the \textbf{downstream channel}
(or simply \textbf{downstream})
of \V{trib}.
\dfEnd
\end{definition}

The term ``joint location'' is based on the idea that the joint location
is the place where the mainstem and tributary ``join'' to form the downstream.

\begin{definition}[Prediction mainstem]
\label{df:prediction-stem}
        Suppose, without loss of generality, that
\begin{equation}
        \V{down} = (\V{drv},\V{fore},\V{aft},\epsilon,\V{rhs},\V{B},\V{current},\V{current})
\end{equation}
is a sound aletheme.
Then we say that
any sound aletheme of the form
        \[ \V{main} = (\V{drv},\V{fore},\V{aft},\V{pre},\V{B}\cat\V{post},\V{A},\V{origin},\V{current}) \]
        is a \textbf{mainstem} of
        \V{down}.
We also say that \V{down} is the \textbf{downstream channel}
(or simply \textbf{downstream})
of \V{stem}.
\dfEnd
\end{definition}

\begin{definition}[Start aletheme]
        \label{df:start-aletheme}
        The start aletheme is the aletheme corresponding
        to the start edge \Dfref{ee-types}.\dfEnd
        \dfEnd
\end{definition}

\needspace{6in}
\section{Algorithm}
\label{sec:algorithm}

\FloatBarrier

\begin{algorithm}[ht]
\caption{Do Earley Parse}
\label{alg:earley}
\begin{algorithmic}[1]
        \Procedure{DoEarleyParse}{}
        \State \Call {AddRow0}{}
        \For{$\V{i} \gets 1, \Vsize{\V{w}}$}
                \State \Call {AddRow}{\V{i}}
        \EndFor
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
\caption{Add Row 0}
\label{alg:add-row-0}
\begin{algorithmic}[1]
        \Procedure{AddRow0}{}
        \State \Call {AddStartStates}{}
        \State \Call {FinishRow}{0}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Add Row \V{n}}
\label{alg:add-row-n}
\begin{algorithmic}[1]
        \Procedure{AddRow}{\V{n}}
        \State \Call {AddScansions}{\V{n}}
        \State \Call {FinishRow}{\V{n}}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Finish Row \V{n}}
\label{alg:finish-row}
\begin{algorithmic}[1]
        \Procedure{FinishRow}{\V{n}}
        \label{li:finish-row-010}
        \State $\V{i} \gets 0$ \Comment{Initialize \V{i}}
        \label{li:finish-row-020}
        \While {$\V{i} < \Vsize{row}$} \Comment {Earley edge activation loop}
        \LComment{The activation loop activates the edges in \V{row}, from index 0 to \Vsize{row}.
        New edges are added to \V{row} during the loop
                so that \Vsize{row} increases during the running of the loop.}
        \label{li:finish-row-030}
        \State $\V{current} \gets \Velement{row}{\V{i}}$
                \Comment {\VVelement{row}{i} is \V{i}'th Earley edge in row}
        \label{li:finish-row-040}
        \If {\V{current} is complete}
        \label{li:finish-row-050}
             \State $\V{origin} \gets$ origin of \V{current}
        \label{li:finish-row-060}
             \If {$\V{origin} < \V{n}$}
        \label{li:finish-row-070}
                  \State \Call{AddTangibleReductions}{\V{current}}
        \label{li:finish-row-080}
             \EndIf
        \label{li:finish-row-090}
        \Else \Comment {... else if \V{current} is an incompletion}
        \label{li:finish-row-100}
             \State $\V{postdot} \gets$ postdot symbol of \V{current}
        \label{li:finish-row-110}
             \If {\V{postdot} is nullable}
        \label{li:finish-row-120}
                  \State \Call{AddIntangibleReduction}{\V{current}}
        \label{li:finish-row-130}
             \EndIf
        \label{li:finish-row-140}
             \State \Call{AddPredictions}{\V{postdot},\V{n}}
        \label{li:finish-row-150}
        \EndIf
        \label{li:finish-row-160}
        \State $\V{i} \gets \V{i} + 1$
        \label{li:finish-row-170}
        \EndWhile
        \label{li:finish-row-180}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{definition}[Earley edge recording]
        An Earley edge is \textbf{recorded} when it is added to the
        Earley chart.
        An \textbf{Earley edge recording event} is a series of
        code steps during which the Earley edge is recorded.
\dfEnd
\end{definition}

\begin{definition}[Earley edge activation]
        An Earley edge is \textbf{activated} when it is examined
        and used for recording other Earley edges.
        An \textbf{Earley edge activation event} is a series of
        code steps during which the Earley edge
        is being examined and used
        for the purpose of recording other Earley edges.
\dfEnd
\end{definition}

Based on the pseudocode, we make a series of observations.

\begin{observation}[No Earley edge is recorded twice]
        There are no duplicate Earley edges.
        That is, an Earley edge is recorded at most one.
        This is enforced at
        line \ref{li:record-edge-100} of \Algref{record-edge}.
        \obEnd
\end{observation}

\begin{observation}[An Earley edge is activated once]
        \label{ob:activation-unique}
        A recorded Earley edge is activated exactly once.
        Relevant to this observation is the activation loop in \Algref{finish-row}.
        \obEnd
\end{observation}

\begin{observation}[Recording and activation of an event do not overlap]
        While the activation loop \Algref{finish-row} records edges
        during activation events,
        the recorded edges are always edges other than the activated edge.
        No steps in the activation of an event \V{ev} overlap
        steps in the the recording of \V{ev},
        and vice versa.
        \obEnd
\end{observation}

\begin{observation}[Edge activation is after recording]
        \label{ob:activation-after-recording}
        Before any Earley edge is activated,
        it must first be recorded.
        \obEnd
\end{observation}

\begin{observation}[Edges are recorded row by row]
        \label{ob:recording-row-by-row}
        Edges are recorded one row at a time.
        More precisely, no edge in row \V{i}
        will
        ever be recorded after any edge in row $\V{i}+1$
        is recorded.
        \obEnd
\end{observation}

\begin{observation}[Edges are recorded at current location]
        \label{ob:recording-at-currloc}
        If edge \V{edge} is recorded by the activation loop
        for row \V{i},  the current location of \V{edge}
        will be row \V{i}.
        \obEnd
\end{observation}

\begin{observation}[Edges are activated row by row]
        \label{ob:activation-row-by-row}
        Edges are activated one row at a time.
        More precisely, no edge in row \V{i}
        will
        ever be activated after any edge in row $\V{i}+1$
        is recorded.
        \obEnd
\end{observation}

\begin{observation}[Edge activation at current location]
        \label{ob:activation-at-currloc}
        An edge is activated in the activation loop for
        its current location.
        \obEnd
\end{observation}

\begin{observation}[Activation is after recording of previous rows]
        \label{ob:activation-after-previous-row}
        Before any Earley edge is activated,
        all Earley edges that will ever be recorded in previous rows
        must already have been recorded.
        One way this can be seen is from
        \Obref{activation-after-recording},
        \Obref{recording-row-by-row},
        and \Obref{activation-row-by-row}.
        \obEnd
\end{observation}

\begin{observation}[Scansion timing]
        \label{ob:scansion-timing}
        Scansion occurs between activation loops.
        More specifically, scansions for row $\V{i}+1$
        are recorded by \Algref{scansion},
        which is called after the activation loop for row \V{i},
        and before the activation loop for row $\V{i}+1$.
\end{observation}

\FloatBarrier

\begin{algorithm}[ht]
        \caption{Add Tangible Reductions}
\label{alg:tangible-reduction}
\begin{algorithmic}[1]
        \Procedure{AddTangibleReductions}{\V{tributary}}
        \label{li:tangible-reduction-010}
        \State $\V{tribOrigin} \gets \text{origin of \V{tributary}}$
        \label{li:tangible-reduction-020}
        \State $\V{tribCurrent} \gets \text{current location of \V{tributary}}$
        \label{li:tangible-reduction-030}
        \LComment{This procedure is never called with $\V{tribCurrent} = 0$}
        \State $\V{tribLHS} \gets \text{LHS of \V{tributary}`s rule}$
        \label{li:tangible-reduction-040}
        \LComment{Find the row where \V{tributary} starts}
        \State $\V{originRow} \gets \VVelement{rows}{tribOrigin}$
        \label{li:tangible-reduction-050}
        \label{li:tangible-reduction-060}
        \LComment{Set \V{mainstems} to the set of Earley edges in \V{originRow} whose postdot
                symbol is \V{tribLHS}.}
        \State $\V{mainstems} \gets$
        \label{li:tangible-reduction-070}
        \Statex $\qquad \qquad \lbrace \V{edge} \in \V{originRow} \mid \VFA{Postdot}{edge} =  \V{tribLHS} \rbrace$
        \label{li:tangible-reduction-080}
     \For {$\V{mainstem} \in \V{mainstems}$}
        \label{li:tangible-reduction-100}
          \State $\V{dotted} \gets \text{dotted rule of \V{mainstem}}$
          \label{li:tangible-reduction-110}
          \State $\V{newDotted} \gets \Call{AdvanceDot}{\V{dotted}}$
          \label{li:tangible-reduction-120}
          \State $\V{newOrigin} \gets \text{origin of \V{mainstem}}$
          \label{li:tangible-reduction-130}
          \State \Call{RecordEdge}{\V{newDotted}, \V{newOrigin}, \V{tribCurrent}}
     \EndFor
        \label{li:tangible-reduction-170}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\FloatBarrier

The caller \Algref{finish-row} ensures that
\Algref{tangible-reduction} is never called when
\[ \V{tribCurrent} = 0. \]

\FloatBarrier

\begin{algorithm}[ht]
        \caption{Add Scansions}
\label{alg:scansion}
\begin{algorithmic}[1]
        \Procedure{AddScansions}{\V{current}}
        \label{li:scansion-040}
        \LComment{Find the row where the terminal starts}
        \State $\V{prevRow} \gets \V{current} \subtract 1$
        \label{li:scansion-050}
        \State $\V{prevEdges} \gets \VVelement{rows}{prevRow}$
        \label{li:scansion-060}
        \LComment{Set \V{mainstems} to the set of Earley edges in row
                $(\V{current} \subtract 1)$ whose postdot
                symbol is
                \rule[-.5\baselineskip]{0pt}{\baselineskip}
                \Velement{w}{(\V{current}\subtract 1)}.}
        \State{$\V{mainstems} \gets \rule[-1\baselineskip]{0in}{\baselineskip}
                \left\lbrace \quad \begin{gathered} \V{edge} \in \V{prevEdges} \\[-.4ex]
                \mid \; \VFA{Postdot}{edge} =  \VVelement{w}{prevRow}
        \end{gathered}\; \right\rbrace$}
        \label{li:scansion-080}
     \For {$\V{mainstem} \in \V{mainstems}$}
        \label{li:scansion-100}
          \State $\V{dotted} \gets \text{dotted rule of \V{mainstem}}$
          \label{li:scansion-110}
          \State $\V{newDotted} \gets \Call{AdvanceDot}{\V{dotted}}$
          \label{li:scansion-120}
          \State $\V{newOrigin} \gets \text{origin of \V{mainstem}}$
          \label{li:scansion-130}
          \State \Call{RecordEdge}{\V{newDotted}, \V{newOrigin}, \V{current}}
     \EndFor
        \label{li:scansion-170}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Advance Dot}
\label{alg:advance-dot}
\begin{algorithmic}[1]
        \Function{AdvanceDot}{\V{dottedRule}}
        \State \textbf{let} \V{dottedRule} \text{be} $(\V{A} \de \alpha \mydot \V{B} \cat \beta)$
        \State $\qquad \qquad \textbf{where } \alpha, \beta \in (\V{N}\cup\V{T})^\ast \text{ and }  \V{B} \in (\V{N}\cup\V{T})$
        \State \textbf{return} $(\V{A} \de \alpha \cat \V{B} \mydot \beta)$
\EndFunction
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Record Edge}
\label{alg:record-edge}
\begin{algorithmic}[1]
        \Function{RecordEdge}{\V{edge}}
        \State \textbf{let} \V{edge} \text{be} $(\V{dottedRule}, \V{origin}, \V{current})$
        \If {\V{edge} is already in the Earley chart}
        \State \textbf{return} \Comment{Do not add duplicate edges}
        \label{li:record-edge-100}
        \EndIf
        \If {\V{dottedRule} is completion and $\V{origin} = \V{current}$}
        \State \textbf{return} \Comment{Do not add nulling completion}
        \EndIf
        \State Add \V{edge} to the Earley chart
\EndFunction
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Add Intangible Reduction}
\label{alg:intangible-reduction}
\begin{algorithmic}[1]
        \Procedure{AddIntangibleReduction}{\V{mainstem}}
        \State \textbf{let} \V{mainstem} \text{be} $(\V{dottedRule}, \V{origin}, \V{current})$
        \If {$\V{current} = 0$}
             \State \textbf{return} \Comment{No reductions in row 0}
        \EndIf
        \State $\V{newDotted} \gets \Call{AdvanceDot}{\V{dotted}}$
        \State \Call{RecordEdge}{\V{newDotted}, \V{origin}, \V{current}}
        \label{li:intangible-reduction-record-edge}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Add Predictions}
\label{alg:predictions}
\begin{algorithmic}[1]
        \Procedure{AddPredictions}{\V{sym},\V{currLoc}}
        \LComment{for every \V{rule} in grammar with LHS equal to \V{sym}}
        \For {every \V{rule} such that $\V{sym} \de \alpha$ and $\alpha \in (\V{N}\cup\V{T})^\ast$}
                \State \Call{RecordEdge}{$(\V{sym} \de \mydot \alpha), \V{currLoc}, \V{currLoc}$}
        \EndFor
\EndProcedure
\end{algorithmic}
\end{algorithm}

\FloatBarrier

\section{Soundness}

\begin{theorem}[\LEV is sound]
        \label{th:lev-sound}
        After running the algorithm of \LEV,
        the contents of the Earley chart will be sound.
        \lmEnd
\end{theorem}

\begin{proof}
        Proof omitted. \todo{Write this proof}
        \myqed
\end{proof}

\section{Inflow lemmas}

\begin{lemma}[Confirmation mainstem inflow]
        \label{lm:conf-stem}
        Let \V{downAL} be a confirmed aletheme,
        whose predot symbol is \V{B},
        whose current location is \V{current},
        and where \V{j} is such that
        \[
                0 \le \V{j} \le \V{current} \land
                \V{B} \destarV{g} \Velement{w}{\V{j},\V{current}}.
        \]
        Then \V{downAL} has a mainstem \V{stemAL}
        at joint location \V{j},
        the current location of \V{stemAL} is \V{j},
        and
        \[
                \VFA{Rank}{stemAL} < \VFA{Rank}{downAL}. \quad \lmEnd
        \]
\end{lemma}

\begin{proof}
Our proof strategy is to assume a confirmed aletheme,
described as in
the statement of the lemma and otherwise arbitrary,
and then to show
that we have the mainstem described in
the statement of the lemma.

We assumed for the lemma the following confirmed aletheme:
\begin{equation}
\label{eq:pr-conf-stem-010}
        \begin{gathered}
        \V{downAL} =
                \left( \begin{gathered}
                        \V{drv},\V{fore},\V{aft},(\V{antepre}\cat\V{B}),\V{post},\V{A}, \\
                        \V{origin},\V{current}
                \end{gathered} \right) \\
                \text{\cuz AF lemma, WLOG.}
        \end{gathered}
\end{equation}
We also assumed for the lemma that
\begin{equation}
\label{eq:pr-conf-stem-020}
        \begin{gathered}
                0 \le \V{j} \le \V{current} \\
                \land \; \V{B} \destarV{drv} \Velement{w}{\V{j},\V{current}} \\
                \text{\cuz AF lemma, WLOG.}
        \end{gathered}
\end{equation}
From \V{downAL} we can conclude
\begin{gather}
\label{eq:pr-conf-stem-030}
        \mycpar{$\V{A} \de \V{antepre}\cat\V{B} \cat \V{post} \in \V{P}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-conf-stem-010}.} \\
\label{eq:pr-conf-stem-040}
        \mycpar{$\V{antepre}\cat\V{B} \destarV{drv} \Velement{w}{\V{origin},\V{current}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-conf-stem-010}.} \\
\label{eq:pr-conf-stem-050}
        \mycpar{$\V{S} \destar \V{fore} \cat \V{A} \cat \V{aft}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-conf-stem-010}.} \\
\label{eq:pr-conf-stem-060}
        \mycpar{$\V{fore} \destarV{drv} \Velement{w}{0,\V{origin}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-conf-stem-010}.}
\end{gather}
We can deduce one useful new derivation:
\begin{gather}
\label{eq:pr-conf-stem-070}
        \mycpar{$\V{antepre} \destarV{drv} \Velement{w}{\V{origin},\V{j}}$
              \cuz \eqref{eq:pr-conf-stem-020}, \eqref{eq:pr-conf-stem-040}.}
\end{gather}
With the foregoing, we have our mainstem aletheme:
\begin{equation}
\label{eq:pr-conf-stem-080}
        \begin{gathered}
        \V{stemAL} =
                \left( \begin{gathered}
                        \V{drv},\V{fore},\V{aft},\V{antepre},(\V{B}\cat\V{post}),\V{A}, \\
                        \V{origin},\V{j}
                \end{gathered} \right) \\
                \text{\cuz \Dfref{aletheme}, \Dfref{conf-stem},
                        \eqref{eq:pr-conf-stem-030}, \eqref{eq:pr-conf-stem-050},
                        \eqref{eq:pr-conf-stem-060}, \eqref{eq:pr-conf-stem-070}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-090}
        \mycpar{The current location of \V{stemAL} is \V{j} \cuz \eqref{eq:pr-conf-stem-080}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-100}
        \mycpar{The joint location of \V{stemAL} is \V{j} \cuz \Dfref{conf-stem}, \eqref{eq:pr-conf-stem-080}.}
\end{equation}
For the lemma, it remains to show the relationship between the rank of the mainstem
and its downstream.
\begin{equation}
\label{eq:pr-conf-stem-110}
        \mycpar{Let \V{n1} be the minimum number of steps in the derivation \\
        $\V{S} \destarV{g} \V{fore} \cat \V{A} \cat \V{aft}.$}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-120}
        \mycpar{\VFA{Dp}{downAL} = \V{n1} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-010}, \eqref{eq:pr-conf-stem-110}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-123}
        \mycpar{\VFA{Dp}{stemAL} = \V{n1} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-080}, \eqref{eq:pr-conf-stem-110}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-126}
        \mycpar{\VFA{Dp}{downAL} = \VFA{Dp}{stemAL} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-120}, \eqref{eq:pr-conf-stem-123}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-130}
        \mycpar{Let \V{n2} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \cat \V{B} \destarV{g} \Velement{w}{0,\V{current}}$ \\
        \cuz \eqref{eq:pr-conf-stem-040}, \eqref{eq:pr-conf-stem-060}.
        }
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-140}
        \mycpar{\VFA{Ht}{downAL} = \V{n2} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-010}, \eqref{eq:pr-conf-stem-130}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-150}
        \mycpar{Let \V{n3} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \destarV{g} \Velement{w}{0,\V{j}}$ \\
        \cuz \eqref{eq:pr-conf-stem-040}, \eqref{eq:pr-conf-stem-060}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-160}
        \mycpar{\VFA{Ht}{stemAL} = \V{n3} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-080}, \eqref{eq:pr-conf-stem-150}.}
\end{equation}
Because the derivation from \V{B}, even if it is $\V{B} \derivesV{g} \epsilon$,
must take at least one step, we know that
\begin{equation}
\label{eq:pr-conf-stem-170}
        \V{n3} < \V{n2} \cuz \eqref{eq:pr-conf-stem-130}, \eqref{eq:pr-conf-stem-150}.
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-180}
        \VFA{Ht}{stemAL} < \VFA{Ht}{downAL} \cuz \eqref{eq:pr-conf-stem-140},
                \eqref{eq:pr-conf-stem-160}, \eqref{eq:pr-conf-stem-170}.
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-190}
        \VFA{Rank}{downAL} = \VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-200}
        \VFA{Rank}{stemAL} = \VFA{Dp}{stemAL} + 2 \mult \VFA{Ht}{stemAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-210}
        \VFA{Rank}{stemAL} < \VFA{Rank}{downAL} \cuz \eqref{eq:pr-conf-stem-126},
                \eqref{eq:pr-conf-stem-180},
                \eqref{eq:pr-conf-stem-190},
                \eqref{eq:pr-conf-stem-200}.
\end{equation}
With \eqref{eq:pr-conf-stem-080}, \eqref{eq:pr-conf-stem-090}, \eqref{eq:pr-conf-stem-100},
and \eqref{eq:pr-conf-stem-210},
we have the lemma.
\myqed
\end{proof}

\begin{lemma}[Height minimization helper]
        \label{lm:ht-minimization}
\begin{gather}
        \label{eq:lm-ht-minimization-050}
        \mycpar{Let \V{HtB} be the length of a minimal length derivation
        from \V{B} to \Velement{w}{\V{a},\V{b}},
        where $\V{B} \in \V{N}$
        and $0 \le \V{a} < \V{b} < \Vsize{w}$,} \\
        \label{eq:lm-ht-minimization-055}
        \mycpar{let $\V{B} \derivesV{drv} \V{rhs} \destarV{drv} \Velement{w}{\V{a},\V{b}}$ \\
        be a minimal length derivation of length \V{HtB}, and} \\
        \label{eq:lm-ht-minimization-060}
        \mycpar{let \V{HtRHS} be the length of $\V{rhs} \destarV{drv} \Velement{w}{\V{a},\V{b}}.$}
\end{gather}
        Then
\begin{equation}
\label{eq:lm-ht-minimization-065}
        \mycpar{$\V{HtB} = \V{HtRHS} + 1$ and}
\end{equation}
\begin{equation}
\label{eq:lm-ht-minimization-070}
        \mycpar{$\V{rhs} \destarV{drv} \Velement{w}{\V{a},\V{b}}$ is a minimal
        length derivation. \lmEnd}
\end{equation}
\end{lemma}

\begin{proof}
        We first note
\begin{equation}
        \label{eq:pr-lm-ht-minimization-040}
        \V{HtB} = \V{HtRHS} + 1 \cuz
                \eqref{eq:lm-ht-minimization-050}, \eqref{eq:lm-ht-minimization-055}, \eqref{eq:lm-ht-minimization-060}.
\end{equation}
It remains to show \eqref{eq:lm-ht-minimization-070}, which we do via the
following reductio.

For the reductio, we assume that there is a derivation $\V{rhs} \destarV{drv2} \Velement{w}{\V{a},\V{b}},$
which is shorter than that of
\eqref{eq:lm-ht-minimization-055}.
More specifically, we assume
\begin{equation}
        \label{eq:pr-lm-ht-minimization-050}
        \mycpar{$\V{B} \derivesV{drv} \V{rhs} \destarV{drv} \Velement{w}{\V{a},\V{b}},$
        is a minimal derivation of length \V{HtB} \cuz AF lemma, and}
\end{equation}
\begin{equation}
\label{eq:pr-lm-ht-minimization-070}
        \mycpar{$\V{rhs} \destarV{drv2} \Velement{w}{\V{a},\V{b}}$ is a minimal
        length derivation of length \V{HtRHS2} \cuz WLOG,}
\end{equation}
\begin{equation}
\label{eq:pr-lm-ht-minimization-080}
        \mycpar{where $\V{HtRHS2} < \V{HtRHS}$ \cuz AF reductio.}
\end{equation}
Then
\begin{equation}
        \label{eq:pr-lm-ht-minimization-090}
        \V{B} \de \V{rhs} \in \V{P} \cuz \eqref{eq:pr-lm-ht-minimization-050}.
\end{equation}
\begin{equation}
        \label{eq:pr-lm-ht-minimization-100}
        \mycpar{$\V{B} \derivesV{g} \V{rhs} \destarV{drv2} \Velement{w}{\V{a},\V{b}}$ \\
        is a derivation of length $\V{HtRHS2}+1$ \cuz
                \eqref{eq:pr-lm-ht-minimization-070}, \eqref{eq:pr-lm-ht-minimization-090}, and}
\end{equation}
\begin{equation}
        \label{eq:pr-lm-ht-minimization-110}
        \V{HtRHS2}+1 < \V{HtRHS}+1 \cuz \eqref{eq:pr-lm-ht-minimization-080}.
\end{equation}
\begin{equation}
        \label{eq:pr-lm-ht-minimization-115}
        \V{HtRHS2}+1 < \V{HtB}
                \cuz \eqref{eq:pr-lm-ht-minimization-040}, \eqref{eq:pr-lm-ht-minimization-110}.
\end{equation}
\begin{equation}
        \label{eq:pr-lm-ht-minimization-120}
        \mycpar{\eqref{eq:pr-lm-ht-minimization-100} is a derivation
        from \V{B} to \Velement{w}{\V{a},\V{b}} and
        the length of \eqref{eq:pr-lm-ht-minimization-100} is
        shorter than the length of the derivation in \eqref{eq:pr-lm-ht-minimization-050} \\
        \cuz \eqref{eq:pr-lm-ht-minimization-050}, \eqref{eq:pr-lm-ht-minimization-100},
                \eqref{eq:pr-lm-ht-minimization-115}.}
\end{equation}
But
\begin{equation}
        \label{eq:pr-lm-ht-minimization-130}
        \mycpar{\eqref{eq:pr-lm-ht-minimization-050} is a minimal
        derivation \cuz \eqref{eq:pr-lm-ht-minimization-050},}
\end{equation}
so that
\begin{equation}
        \label{eq:pr-lm-ht-minimization-140}
        \mycpar{\eqref{eq:pr-lm-ht-minimization-120} and
        \eqref{eq:pr-lm-ht-minimization-130}
        contradict,}
\end{equation}
which shows the reductio.
From the reductio, we conclude
\begin{equation}
        \label{eq:pr-lm-ht-minimization-150}
        \V{HtRHS2} \ge \V{HtRHS} \cuz
        \eqref{eq:pr-lm-ht-minimization-080},
        \eqref{eq:pr-lm-ht-minimization-140}.
\end{equation}
\begin{equation}
        \label{eq:pr-lm-ht-minimization-160}
        \mycpar{\V{HtRHS} is the minimal length for
        $\V{rhs} \destarV{g} \Velement{w}{\V{a},\V{b}}$
        cuz \eqref{eq:pr-lm-ht-minimization-070}, \eqref{eq:pr-lm-ht-minimization-150}.}
\end{equation}
and therefore,
\begin{equation}
\label{eq:lm-ht-minimization-170}
        \mycpar{$\V{rhs} \destarV{drv} \Velement{w}{\V{a},\V{b}}$ is a minimal
        length derivation \cuz \eqref{eq:lm-ht-minimization-060},
                \eqref{eq:pr-lm-ht-minimization-160},}
\end{equation}
which is what we were seeking in the lemma.
With
\eqref{eq:pr-lm-ht-minimization-040} and
\eqref{eq:lm-ht-minimization-170}, we have
what we need for this lemma.  \myqed
\end{proof}

\begin{lemma}[Reduction tributary inflow]
        \label{lm:red-trib}
        Let \V{downAL} be a reduced aletheme,
        whose derivation is \V{drv},
        whose predot symbol instance is \V{B:pd},
        whose current location is \V{current},
        and where \V{j} is such that
        \[
                0 \le \V{j} \le \V{current} \land
                \V{B:pd} \destarV{drv} \Velement{w}{\V{j},\V{current}}.
        \]
        Then \V{downAL} has
        a direct tributary, call it \V{tribAL},
        and a ranked, or proxy, tributary,
        call it \V{proxAL}.
        Both tributaries are at joint location \V{j},
        and have a current location of \V{j}.
        The rank of \V{proxAL}
        is such that
        \[
                \VFA{Rank}{proxAL} < \VFA{Rank}{downAL}.
        \]
        \V{proxAL} and \V{tribAL} need not differ.
        If they differ, they can do so only
        in their derivations, or in the RHS of their rules.
        \quad \lmEnd
\end{lemma}

\begin{proof}
Our proof strategy is to assume a reduced aletheme
that is arbitrary except
as described in
the statement of the lemma,
and then to show
that we have the tributaries as described in
the statement of the lemma.

We assume for the lemma the following reduced aletheme:
\begin{equation}
\label{eq:pr-red-trib-010}
        \begin{gathered}
        \V{downAL} =
                \left( \begin{gathered}
                        \V{drv},\V{fore},\V{aft},(\V{antepre}\cat\V{B:pd}),\V{post},\V{A}, \\
                        \V{origin},\V{current}
                \end{gathered} \right) \\
                \text{\cuz AF lemma, WLOG.}
        \end{gathered}
\end{equation}
We also assume for the lemma that
\begin{equation}
\label{eq:pr-red-trib-020}
        \begin{gathered}
                0 \le \V{j} \le \V{current} \\
                \land \; \V{B:pd} \destarV{drv} \Velement{w}{\V{j},\V{current}} \\
                \text{\cuz AF lemma, WLOG.}
        \end{gathered}
\end{equation}
From \V{downAL} we can conclude
\begin{gather}
\label{eq:pr-red-trib-030}
        \mycpar{$\V{A} \de \V{antepre}\cat\V{B} \cat \V{post} \in \V{P}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-010}.} \\
\label{eq:pr-red-trib-040}
        \mycpar{$\V{antepre}\cat\V{B:pd} \destarV{drv} \Velement{w}{\V{origin},\V{current}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-010}.} \\
\label{eq:pr-red-trib-050}
        \mycpar{$\V{S} \destarV{drv} \V{fore} \cat \V{A} \cat \V{aft}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-010}.} \\
\label{eq:pr-red-trib-060}
        \mycpar{$\V{fore} \destarV{drv} \Velement{w}{0,\V{origin}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-010}.}
\end{gather}

Because $\V{B} \in \V{N}$ we know that,
\begin{equation}
\label{eq:pr-red-trib-070}
                \mycpar{there is some $\V{B} \de \V{rhs} \in \V{P}$,}
\end{equation}
so that
\begin{equation}
\label{eq:pr-red-trib-080}
        \mycpar{$\V{S} \destarV{drv} \V{fore} \cat \V{A} \cat \V{aft}$ \\
        $\derivesV{drv} \V{fore} \cat \V{antepre} \cat \V{B:pd} \cat \V{post} \cat \V{aft}$ \\
        $\derivesV{drv} \V{fore} \cat \V{antepre} \cat \V{rhs} \cat \V{post} \cat \V{aft}$ \\
                \cuz \eqref{eq:pr-red-trib-010}, \eqref{eq:pr-red-trib-030}, \eqref{eq:pr-red-trib-050}.}
\end{equation}
We simplify \eqref{eq:pr-red-trib-080} to
\begin{equation}
\label{eq:pr-red-trib-090}
        \mycpar{$\V{S} \destarV{drv} \V{fore} \cat \V{antepre} \cat \V{B:pd} \cat \V{post} \cat \V{aft}$ \\
                \cuz \eqref{eq:pr-red-trib-080},}
\end{equation}
and deduce a few more facts that we will need:
\begin{equation}
\label{eq:pr-red-trib-150}
        \begin{gathered}
                \V{B:pd} \derivesV{drv} \V{rhs} \destar \Velement{w}{\V{j},\V{current}}
              \cuz \eqref{eq:pr-red-trib-020}, \eqref{eq:pr-red-trib-040}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-155}
        \begin{gathered}
                \V{rhs} \destarV{drv} \Velement{w}{\V{j},\V{current}}
              \cuz \eqref{eq:pr-red-trib-150}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-160}
        \begin{gathered}
                \V{antepre} \destarV{drv} \Velement{w}{\V{origin},\V{j}} \\
                \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-020}, \eqref{eq:pr-red-trib-040}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-170}
        \begin{gathered}
                \V{fore} \cat \V{antepre} \destarV{drv} \Velement{w}{0,\V{j}} \\
                \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-060}, \eqref{eq:pr-red-trib-160}.
        \end{gathered}
\end{equation}
With the foregoing, we have our direct tributary aletheme:
\begin{equation}
\label{eq:pr-red-trib-180}
        \begin{gathered}
        \V{tribAL} =
                \left( \begin{gathered}
                        \V{drv},(\V{fore}\cat\V{antepre}),(\V{post}\cat\V{aft}), \\
                        \V{rhs},\epsilon,\V{B:pd},\V{j},\V{current}
                \end{gathered} \right) \\
                \text{\cuz \Dfref{aletheme}, \Dfref{red-trib},
                        \eqref{eq:pr-red-trib-070}, \eqref{eq:pr-red-trib-090},
                        \eqref{eq:pr-red-trib-155}, \eqref{eq:pr-red-trib-170}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-190}
        \mycpar{The current location of \V{tribAL} is \V{current} \cuz \eqref{eq:pr-red-trib-180}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-200}
        \mycpar{The joint location of \V{tribAL} is \V{j} \cuz \Dfref{red-trib}, \eqref{eq:pr-red-trib-180}.}
\end{equation}
At this point,
\begin{equation}
\label{eq:pr-red-trib-210}
        \mycpar{we have what we needed to show about
        \V{tribAL} for the lemma
        \cuz \eqref{eq:pr-red-trib-180}, \eqref{eq:pr-red-trib-190} and \eqref{eq:pr-red-trib-200}.}
\end{equation}
For the lemma, it remains to
define \V{proxyAL}
and show what we need with respect to it.
The derivation for
\V{proxyAL} is potentially distinct from \V{drv},
so we will call it \V{drv2}.
Defining \V{drv2}, we
\begin{equation}
\label{eq:pr-red-trib-220}
        \mycpar{let \V{drv2} be identical to \V{drv} except that \\
                $\V{B:pd} \derivesV{drv2} \V{rhs2} \destarV{drv2} \Velement{w}{\V{j},\V{current}}$, \\
                where $\V{B} \de \V{rhs2} \in \V{P}$, \\
                is a minimal length derivation.}
\end{equation}
As an aside, we note that,
\begin{equation}
\label{eq:pr-red-trib-230}
        \mycpar{in \eqref{eq:pr-red-trib-220}
        it is quite possible that $\V{rhs2} = \V{rhs}$,
        in which case is it also possible that $\V{drv} = \V{drv2}$.}
\end{equation}
Breaking out \eqref{eq:pr-red-trib-220},
\begin{equation}
\label{eq:pr-red-trib-235}
        \mycpar{$\V{B} \de \V{rhs2} \in \V{P}$ and}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-240}
        \mycpar{\V{drv2} is identical to \V{drv} except in the subtree under \V{B:pd}.}
\end{equation}
To define \V{proxAL}, it remains to deduce a few facts.
\begin{equation}
\label{eq:pr-red-trib-250}
        \mycpar{$\V{S} \destarV{drv2} \V{fore} \cat \V{antepre} \cat \V{B:pd} \cat \V{post} \cat \V{aft}$ \\
                \cuz \eqref{eq:pr-red-trib-090}, \eqref{eq:pr-red-trib-240}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-260}
        \V{rhs} \destarV{drv2} \Velement{w}{\V{j},\V{current}} \cuz \eqref{eq:pr-red-trib-220}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-270}
        \V{fore} \cat \V{antepre} \destarV{drv2} \Velement{w}{0,\V{j}}
                \cuz \eqref{eq:pr-red-trib-170}, \eqref{eq:pr-red-trib-240}.
\end{equation}
We are now in a position to define our proxy aletheme.
\begin{equation}
\label{eq:pr-red-trib-280}
        \begin{gathered}
        \V{proxAL} =
                \left( \begin{gathered}
                        \V{drv2},(\V{fore}\cat\V{antepre}),(\V{post}\cat\V{aft}), \\
                        \V{rhs2},\epsilon,\V{B:pd},\V{j},\V{current}
                \end{gathered} \right) \\
                \text{\cuz \Dfref{aletheme}, \Dfref{red-trib},
                        \eqref{eq:pr-red-trib-235}, \eqref{eq:pr-red-trib-250},
                        \eqref{eq:pr-red-trib-260}, \eqref{eq:pr-red-trib-270}.}
        \end{gathered}
\end{equation}
For the lemma, it remains to determine the rank of \V{proxAL}.
\begin{equation}
\label{eq:pr-red-trib-310}
        \mycpar{Let \V{DownMinD}, ``downAl minimum depth''  be the minimum number of steps in the derivation \\
        $\V{S} \destarV{g} \V{fore} \cat \V{A} \cat \V{aft}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-320}
        \mycpar{\VFA{Dp}{downAL} = \V{DownMinD} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-010}, \eqref{eq:pr-red-trib-310}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-330}
        \mycpar{Let \V{TribMinD}, ``tribAl minimum depth''  be the minimum number of steps in the derivation \\
        $\V{S} \destarV{g} \V{fore} \cat \V{antepre} \cat \V{B} \cat \V{post} \cat \V{aft}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-340}
        \mycpar{\VFA{Dp}{tribAL} = \V{TribMinD} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-010}, \eqref{eq:pr-red-trib-330}.}
\end{equation}
Whatever the value of \V{TribMinD},
because of the derivation
\begin{equation}
\label{eq:pr-red-trib-350}
        \mycpar{$\V{S} \destarV{g} \V{fore} \cat \V{A} \cat \V{aft}$ \\
        $\derivesV{g} \V{fore} \cat \V{antepre} \cat \V{B} \cat \V{post} \cat \V{aft},$
        }
\end{equation}
the derivation of \eqref{eq:pr-red-trib-330}
cannot be longer than one step more than the derivation in \eqref{eq:pr-red-trib-310},
\begin{equation}
\label{eq:pr-red-trib-360}
        \V{TribMinD} \le \V{DownMinD} + 1 \cuz \eqref{eq:pr-red-trib-350},
\end{equation}
so that
\begin{equation}
\label{eq:pr-red-trib-370}
        \VFA{Dp}{tribAl} \le \VFA{Dp}{downAL} + 1
        \cuz \eqref{eq:pr-red-trib-320}, \eqref{eq:pr-red-trib-340}, \eqref{eq:pr-red-trib-360}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-450}
        \mycpar{Let \V{downMinH} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \cat \V{B} \destarV{g} \Velement{w}{0,\V{current}}$ \\
        \cuz \eqref{eq:pr-red-trib-040}, \eqref{eq:pr-red-trib-060}.
        }
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-460}
        \mycpar{\VFA{Ht}{downAL} = \V{downMinH} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-010}, \eqref{eq:pr-red-trib-450}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-470}
        \mycpar{Let \V{tribMinH} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \cat \V{rhs} \destarV{g} \Velement{w}{0,\V{current}}$ \\
        \cuz \eqref{eq:pr-red-trib-040}, \eqref{eq:pr-red-trib-060}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-480}
        \mycpar{\VFA{Ht}{tribAL} = \V{tribMinH} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-180}, \eqref{eq:pr-red-trib-470}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-490}
        \mycpar{Let \V{H1} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \destarV{g} \Velement{w}{0,\V{j}}$ \\
        \cuz \eqref{eq:pr-red-trib-060}, \eqref{eq:pr-red-trib-170}.}
\end{equation}
We recall from above that
\begin{equation}
\label{eq:pr-red-trib-500}
        \mycpar{$\V{B} \derivesV{drvs} \V{rhs} \destarV{drvs} \Velement{w}{\V{j},\V{current}}$
        \cuz \eqref{eq:pr-red-trib-080}, and}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-510}
        \V{B} \destarV{drvs} \Velement{w}{\V{j},\V{current}} \cuz \eqref{eq:pr-red-trib-500}.
\end{equation}
are minimal derivations.
\begin{equation}
\label{eq:pr-red-trib-520}
        \mycpar{Let \V{HtB} be the minimum number of steps in the derivation
        $\V{B} \destar \Velement{w}{\V{j},\V{current}} \cuz \eqref{eq:pr-red-trib-500}$, and}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-530}
        \mycpar{let \V{HtRHS} be the minimum number of steps in the derivation
        $\V{rhs} \destar \Velement{w}{\V{j},\V{current}} \cuz \eqref{eq:pr-red-trib-500}.$}
\end{equation}
Because \eqref{eq:pr-red-trib-520} and \eqref{eq:pr-red-trib-530}
are minimal derivations,
\begin{equation}
\label{eq:pr-red-trib-540}
        \V{HtB} = \V{HtRHS}+1
                \cuz \Lmref{ht-minimization},
                \eqref{eq:pr-red-trib-500}, \eqref{eq:pr-red-trib-510},
                        \eqref{eq:pr-red-trib-520}, \eqref{eq:pr-red-trib-530}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-550}
        \mycpar{$\VFA{Ht}{downAL} = \V{H1} + \V{HtB}
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-470}, \eqref{eq:pr-red-trib-480},
                \eqref{eq:pr-red-trib-490}, \eqref{eq:pr-red-trib-520}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-560}
        \mycpar{$\VFA{Ht}{tribAL} = \V{H1} + \V{HtRHS}
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-470}, \eqref{eq:pr-red-trib-480},
                \eqref{eq:pr-red-trib-490}, \eqref{eq:pr-red-trib-530}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-570}
        \mycpar{$\VFA{Ht}{downAL} = \VFA{Ht}{tribAL} + 1
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-540}, \eqref{eq:pr-red-trib-550},
                \eqref{eq:pr-red-trib-560}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-580}
        \VFA{Rank}{downAL} = \VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-590}
        \VFA{Rank}{tribAL} = \VFA{Dp}{tribAL} + 2 \mult \VFA{Ht}{tribAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-600}
        \mycpar{$\VFA{Rank}{tribAL} = \VFA{Dp}{tribAL} + 2 \mult (\VFA{Ht}{downAL} \subtract 1)$ \\
                \cuz \eqref{eq:pr-red-trib-570}, \eqref{eq:pr-red-trib-590}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-610}
        \mycpar{$\VFA{Rank}{tribAL} \le (\VFA{Dp}{downAL}+1) + 2 \mult (\VFA{Ht}{downAL} \subtract 1)$ \\
                \cuz \eqref{eq:pr-red-trib-370}, \eqref{eq:pr-red-trib-600}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-620}
        \VFA{Rank}{tribAL} \le \VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL} + 1 \subtract 2 \cuz
                \eqref{eq:pr-red-trib-610}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-630}
        \VFA{Rank}{tribAL} \le \VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL} \subtract 1 \cuz
                \eqref{eq:pr-red-trib-620}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-640}
        \VFA{Rank}{tribAl} \le \VFA{Rank}{downAL} \subtract 1
        \cuz \eqref{eq:pr-red-trib-580}, \eqref{eq:pr-red-trib-630}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-650}
        \VFA{Rank}{tribAl} < \VFA{Rank}{downAL}
        \cuz \eqref{eq:pr-red-trib-640}.
\end{equation}
With \eqref{eq:pr-red-trib-180}, \eqref{eq:pr-red-trib-190}, \eqref{eq:pr-red-trib-200}, \eqref{eq:pr-red-trib-280},
and \eqref{eq:pr-red-trib-650}, we have the lemma.
\myqed
\end{proof}

\begin{lemma}[Depth minimization helper]
        \label{lm:dp-minimization}
\begin{gather}
        \label{eq:lm-dp-minimization-050}
        \mycpar{Let \V{DpZ} be the length of a minimal length derivation
        from \V{S} to $\V{foreZ}\cat\V{Z}\cat\V{aftZ}$
        where $\V{Z} \in \V{N}, \V{foreZ}, \V{aftZ} \in \V{STR}$,} \\
        \label{eq:lm-dp-minimization-055}
        \mycpar{let $\V{S} \destarV{drv} \V{foreY}\cat\V{Y}\cat\V{aftY}
        \derivesV{drv} \V{foreZ}\cat\V{Z}\cat\V{aftZ}$ \V{foreZ} \\
        be a minimal length derivation of length \V{DpZ}, and} \\
        \label{eq:lm-dp-minimization-060}
        \mycpar{let \V{DpY} be the derivation length of
        $\V{S} \destarV{drv} \V{foreY}\cat\V{Y}\cat\V{aftY}$.}
\end{gather}
        Then
\begin{equation}
\label{eq:lm-dp-minimization-065}
        \mycpar{$\V{DpZ} = \V{DpY} + 1$ and}
\end{equation}
\begin{equation}
\label{eq:lm-dp-minimization-070}
        \mycpar{$\V{S} \destarV{drv} \V{foreY}\cat\V{Y}\cat\V{aftY}$ is a minimal
        length derivation. \lmEnd}
\end{equation}
\end{lemma}

\begin{proof}
        \todo{Write this proof}
        Proof omitted.  \myqed
\end{proof}

\begin{lemma}[Prediction mainstem inflow]
        \label{lm:pred-stem}
        Let \V{downAL} be a predicted aletheme,
        whose current location is \V{current}.
        Then \V{downAL} has
        a mainstem, call it \V{stemAL},
        whose current location is \V{current}.
        The rank of \V{stemAL}
        is such that
        \[
                \VFA{Rank}{stemAL} = \VFA{Rank}{downAL} \subtract 1.
        \]
        \quad \lmEnd
\end{lemma}

\begin{proof}
Our proof strategy is to assume a predicted aletheme
that is arbitrary except
as described in
the statement of the lemma,
and then to show
that we have the mainstem as described in
the statement of the lemma.

We assume for the lemma the following predicted aletheme:
\begin{equation}
\label{eq:pr-pred-stem-010}
        \begin{gathered}
        \V{downAL} =
                \left( \begin{gathered}
                        \V{drv},\V{foreZ},\V{aftZ},\epsilon,\V{rhsZ},\V{Z:f}, \\
                        \V{current},\V{current}
                \end{gathered} \right) \\
                \text{\cuz AF lemma, WLOG.}
        \end{gathered}
\end{equation}
In \eqref{eq:pr-pred-stem-010}, we can assume WLOG
\begin{equation}
\label{eq:pr-pred-stem-015}
        \mycpar{\V{drv} is a minimal derivation from \V{S} to \V{Z:f} \cuz WLOG.}
\end{equation}
From \V{downAL} we can conclude
\begin{gather}
\label{eq:pr-pred-stem-030}
        \mycpar{$\V{Z} \de \V{rhsZ} \in \V{P}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-pred-stem-010}.} \\
\label{eq:pr-pred-stem-040}
        \mycpar{$\V{S} \destarV{drv} \V{foreZ} \cat \V{Z:f} \cat \V{aftZ}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-pred-stem-010}.} \\
\label{eq:pr-pred-stem-050}
        \mycpar{$\V{foreZ} \destarV{drv} \Velement{w}{0,\V{origin}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-pred-stem-010}.}
\end{gather}

Because \V{downAL} is a predicted aletheme
we know that, by the definition of a prediction,
\begin{equation}
\label{eq:pr-pred-stem-070}
        \V{Z} \neq \V{S} \cuz \Dfref{ee-types}, \eqref{eq:pr-pred-stem-010}.
\end{equation}
We can therefore say there is some
\begin{equation}
\label{eq:pr-pred-stem-080}
        \V{pre}, \V{foreY}, \V{post}, \V{aftY} \in \V{STR}, \V{Y} \in \V{N}, \V{j} \in \naturals,
\end{equation}
such that
\begin{gather}
\label{eq:pr-pred-stem-090}
        \mycpar{$\V{foreY}\cat\V{pre} = \V{foreZ}$ \cuz WLOG,} \\
\label{eq:pr-pred-stem-100}
        \mycpar{$\V{post}\cat\V{aftY} = \V{aftZ}$ \cuz WLOG,} \\
\label{eq:pr-pred-stem-110}
        \mycpar{$\V{Y} \de \V{pre} \cat \V{Z} \cat \V{post} \in \V{P}$ \cuz WLOG,} \\
\label{eq:pr-pred-stem-120}
        \mycpar{$\V{S} \destarV{drv} \V{foreY} \cat \V{Y} \cat \V{aftY}$ \\
        $\derivesV{drv} \V{foreY} \cat \V{pre} \cat \V{Z:f} \cat \V{post} \cat \V{aftY}$ \\
        $\derivesV{drv} \V{foreY} \cat \V{pre} \cat \V{rhsZ} \cat \V{post} \cat \V{aftY}$ \\
                \cuz \eqref{eq:pr-pred-stem-030}, \eqref{eq:pr-pred-stem-040}, \eqref{eq:pr-pred-stem-110},} \\
\label{eq:pr-pred-stem-130}
        \mycpar{$\V{foreY} \destarV{drv} \Velement{w}{0,\V{j}}$ \cuz WLOG, and} \\
\label{eq:pr-pred-stem-140}
        \mycpar{$\V{pre} \destarV{drv} \Velement{w}{\V{j},\V{current}}$ \cuz WLOG.}
\end{gather}
We can simplify \eqref{eq:pr-pred-stem-120},
\begin{equation}
\label{eq:pr-pred-stem-150}
        \V{S} \destarV{drv} \V{foreY} \cat \V{Y} \cat \V{aftY}
              \cuz \eqref{eq:pr-pred-stem-120}.
\end{equation}
With the foregoing, we have our mainstem aletheme:
\begin{equation}
\label{eq:pr-pred-stem-160}
        \begin{gathered}
        \V{stemAL} =
                \left( \begin{gathered}
                        \V{drv},\V{foreY},\V{aftY}, \\
                        \V{pre},\V{Z:f}\cat\V{post},\V{Y},\V{j},\V{current}
                \end{gathered} \right) \\
                \text{\cuz \Dfref{aletheme}, \Dfref{prediction-stem},
                        \eqref{eq:pr-pred-stem-110}, \eqref{eq:pr-pred-stem-130},
                        \eqref{eq:pr-pred-stem-140}, \eqref{eq:pr-pred-stem-150}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-190}
        \mycpar{The current location of \V{tribAL} is \V{current} \cuz \eqref{eq:pr-pred-stem-160}.}
\end{equation}
At this point,
\begin{equation}
\label{eq:pr-pred-stem-210}
        \mycpar{we have what we needed to show about
        \V{stemAL} for the lemma
        \cuz \eqref{eq:pr-pred-stem-160}, \eqref{eq:pr-pred-stem-210}.}
\end{equation}
For the lemma, it remains to determine the rank of \V{stemAL}.
\begin{equation}
\label{eq:pr-pred-stem-310}
        \mycpar{Let \V{DownMinD}, ``downAl minimum depth''  be the minimum number of steps in the derivation \\
        $\V{S} \destarV{drv} \V{foreZ} \cat \V{Z:f} \cat \V{aftZ}.$}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-320}
        \mycpar{\VFA{Dp}{downAL} = \V{DownMinD} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-pred-stem-010}, \eqref{eq:pr-pred-stem-310}.}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-330}
        \mycpar{Let \V{StemMinD}, ``stemAl minimum depth''  be the minimum number of steps in the derivation \\
        $\V{S} \destarV{drv} \V{foreY} \cat \V{Y} \cat \V{aftY}.$}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-340}
        \mycpar{\VFA{Dp}{stemAL} = \V{StemMinD} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-pred-stem-160}, \eqref{eq:pr-pred-stem-330}.}
\end{equation}
Whatever the value of \V{downMinD},
because of the derivation
\begin{equation}
\label{eq:pr-pred-stem-350}
        \mycpar{$\V{S} \destarV{drv} \V{foreY} \cat \V{Y} \cat \V{aftY}$ \\
        $\derivesV{drv} \V{foreY} \cat \V{pre} \cat \V{Z:f} \cat \V{post} \cat \V{aftZ}$ \\
        $= \V{foreZ} \cat \V{Z:f} \cat \V{aftZ}$ \\
        \cuz \eqref{eq:pr-pred-stem-090}, \eqref{eq:pr-pred-stem-100},
                \eqref{eq:pr-pred-stem-310}, \eqref{eq:pr-pred-stem-330}.}
\end{equation}
the derivation of \eqref{eq:pr-pred-stem-310}
is exactly one step longer than the derivation in \eqref{eq:pr-pred-stem-330},
\begin{equation}
\label{eq:pr-pred-stem-360}
        \V{DownMinD} = \V{StemMinD} + 1
                \cuz \Lmref{dp-minimization}, \eqref{eq:pr-pred-stem-350}.
\end{equation}
so that
\begin{equation}
\label{eq:pr-pred-stem-370}
        \VFA{Dp}{downAl} = \VFA{Dp}{stemAL} + 1
        \cuz \eqref{eq:pr-pred-stem-320}, \eqref{eq:pr-pred-stem-340}, \eqref{eq:pr-pred-stem-360}.
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-380}
        \V{foreZ} \destarV{g} \Velement{w}{0,\V{current}} \cuz
                \eqref{eq:pr-pred-stem-090}, \eqref{eq:pr-pred-stem-130}, \eqref{eq:pr-pred-stem-140}.
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-450}
        \mycpar{Let \V{downMinH} be the minimum number of steps in the derivation \\
                $\V{foreZ} \destarV{g} \Velement{w}{0,\V{current}}$ \\
        \cuz \eqref{eq:pr-pred-stem-380}.
        }
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-460}
        \mycpar{\VFA{Ht}{downAL} = \V{downMinH}
                \cuz \Dfref{rank}, \eqref{eq:pr-pred-stem-010}, \eqref{eq:pr-pred-stem-450}.}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-470}
        \mycpar{Let \V{stemMinH} be the minimum number of steps in the derivation \\
        $\V{foreY} \cat \V{pre} \destarV{g} \Velement{w}{0,\V{current}}$ \\
        \cuz \eqref{eq:pr-pred-stem-130}, \eqref{eq:pr-pred-stem-140}.}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-480}
        \mycpar{\VFA{Ht}{stemAL} = \V{stemMinH} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-pred-stem-160}, \eqref{eq:pr-pred-stem-470}.}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-490}
        \mycpar{\V{downMinH} = \V{stemMinH} \\
        \cuz \eqref{eq:pr-pred-stem-090}, \eqref{eq:pr-pred-stem-450}, \eqref{eq:pr-pred-stem-470}.}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-500}
        \mycpar{\VFA{Ht}{downAL} = \VFA{Ht}{stemAL} \\
        \cuz \eqref{eq:pr-pred-stem-460}, \eqref{eq:pr-pred-stem-480}, \eqref{eq:pr-pred-stem-490}.}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-580}
        \VFA{Rank}{downAL} = \VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-590}
        \VFA{Rank}{stemAL} = \VFA{Dp}{stemAL} + 2 \mult \VFA{Ht}{stemAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-600}
        \VFA{Rank}{stemAL} = \VFA{Dp}{stemAL} + 2 \mult \VFA{Ht}{downAL}
                \cuz \eqref{eq:pr-pred-stem-500}, \eqref{eq:pr-pred-stem-590}.
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-610}
        \mycpar{$\VFA{Rank}{stemAL} = (\VFA{Dp}{downAL} \subtract 1) + 2 \mult \VFA{Ht}{downAL}$ \\
                \cuz \eqref{eq:pr-pred-stem-370}, \eqref{eq:pr-pred-stem-600}.}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-620}
        \mycpar{$\VFA{Rank}{stemAL} = (\VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL}) \subtract 1$ \\
                \cuz \eqref{eq:pr-pred-stem-610}.}
\end{equation}
\begin{equation}
\label{eq:pr-pred-stem-630}
        \VFA{Rank}{stemAL} = \VFA{Rank}{downAL} \subtract 1
                \cuz \eqref{eq:pr-pred-stem-580}, \eqref{eq:pr-pred-stem-620}.
\end{equation}
With \eqref{eq:pr-pred-stem-160}, \eqref{eq:pr-pred-stem-190}, and \eqref{eq:pr-pred-stem-630}, we have the lemma.
\myqed
\end{proof}

\section{Rank zero lemmas}

\begin{lemma}[Start symbol instance]
        \label{lm:start-symbol-instance}
        In a derivation, the only instance of \V{S} is the first (and only) symbol in the first step. \lmEnd
\end{lemma}

\begin{proof}
        Let \V{drv} be a derivation.
        \begin{equation}
        \label{eq:pr-start-symbol-instance-010}
                \mycpar{\V{S} cannot occur on a \V{rhs} \cuz
                       \Dfref{dedicated-start}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-symbol-instance-020}
                \mycpar{\V{S} is the first (and only) symbol instance in the first step of \V{drv}
                \cuz \Dfref{full-derivation}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-symbol-instance-030}
                \mycpar{Every transition of \V{drv} expands a symbol from its LHS step
                \cuz \Dfref{transition}, \Dfref{full-derivation}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-start-symbol-instance-040}
                \mycpar{The transition from the first step of \V{drv}
                to the second step
                expands \V{S} to a RHS
                \cuz \eqref{eq:pr-start-symbol-instance-020},
                        \eqref{eq:pr-start-symbol-instance-030}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-start-symbol-instance-050}
                \mycpar{\V{S} does not occur in the second step of \V{drv} \\
                \cuz \Dfref{transition}, \eqref{eq:pr-start-symbol-instance-010},
                        \eqref{eq:pr-start-symbol-instance-040}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-start-symbol-instance-060}
                \mycpar{A new symbol can occur in a step only as part of an expansion
                \cuz \Dfref{transition}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-start-symbol-instance-070}
                \mycpar{A symbol in an expansion must be a RHS symbol \\
                \cuz \Dfref{transition}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-start-symbol-instance-080}
                \mycpar{\V{S} can never occur in an expansion
                \cuz \eqref{eq:pr-start-symbol-instance-010},
                        \eqref{eq:pr-start-symbol-instance-070}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-start-symbol-instance-090}
                \mycpar{\V{S} cannot occur in a step after the first
                \cuz \eqref{eq:pr-start-symbol-instance-050},
                        \eqref{eq:pr-start-symbol-instance-060},
                        \eqref{eq:pr-start-symbol-instance-080}.}
        \end{equation}
        \V{drv} was chosen arbitrarily, so that with
        \eqref{eq:pr-start-symbol-instance-090}
        we have the theorem.
        \myqed
\end{proof}

\begin{definition}[Start symbol aletheme]
        \label{df:start-symbol-aletheme}
        A \textbf{start symbol aletheme} is an aletheme
        whose LHS symbol is the start symbol.
        \dfEnd
\end{definition}

\begin{lemma}[Start symbol aletheme]
        \label{lm:start-symbol-aletheme}
        Let \V{drv} be a derivation and let
        \[ \V{S} \de \V{pre} \cat \V{post} \]
        be the start rule of \V{g},
        divided at any point in the RHS into \V{pre} and \V{post}.
        An sound aletheme with the start symbol as its LHS will be of the form
        \begin{equation*}
                \V{startAL} = \left( \; \begin{gathered} \V{drv},\epsilon,\epsilon,\V{pre},\V{post}, \\
                        \V{S:lhs},0,\V{current} \\
                \end{gathered} \; \right),
        \end{equation*}
        \begin{equation*}
                \mycpar{where $\V{pre} \destarV{drv} \Velement{w}{0,\V{current}}$.}
        \end{equation*}
        The rank of \V{startAL} will be $2 \mult \VFA{Ht}{startAL}$.
        \lmEnd
\end{lemma}

\begin{proof}
        Let \V{drv} be an arbitrary derivation and let
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-010}
                \mycpar{$\V{S} \de \V{pre} \cat \V{post}$
                        \cuz \Dfref{dedicated-start}.}
        \end{equation}
        be the dedicated start rule, with its RHS
        arbitrarily divided into \V{pre} and \V{post}.
        Let
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-020}
                \V{startAL} = \left( \; \begin{gathered} \V{drv},\V{fore},\V{aft},\V{pre},\V{post}, \\
                        \V{S:lhs},\V{origin},\V{current} \\
                \end{gathered} \; \right) \\
                \cuz \Dfref{aletheme}.
        \end{equation}
        be a sound altheme with \V{S} on its LHS,
        where we seek to determine the values of
        \V{fore}, \V{aft}, \V{origin}, and \V{current}.
        The only transition that contains \V{S} is
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-030}
                (\V{S:top}, \V{pre} \cat \V{post}) \cuz
                \Lmref{start-symbol-instance}, \Dfref{transition}, \eqref{eq:pr-start-sym-aletheme-010}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-040}
                \mycpar{There is only one instance of \V{S} in \V{drv}
                \cuz \Lmref{start-symbol-instance},}
        \end{equation}
        so that, in
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-050}
                \V{S:top} \derivesRaw{\V{n}}{\V{drv}} \V{fore} \cat \V{S:lhs} \cat \V{aft}
                \cuz \Dfref{aletheme}, \eqref{eq:pr-start-sym-aletheme-020},
        \end{equation}
        it must be the case that
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-060}
                \mycpar{\V{S:top} = \V{S:lhs}
                \cuz \eqref{eq:pr-start-sym-aletheme-040}, \eqref{eq:pr-start-sym-aletheme-050}, and}
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-070}
                \mycpar{$\V{n} = 0 \cuz \eqref{eq:pr-start-sym-aletheme-050}$.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-080}
                \mycpar{$\V{S:top} \derivesRaw{0}{\V{drv}} \V{fore} \cat \V{S:top} \cat \V{aft}$
                \cuz \eqref{eq:pr-start-sym-aletheme-050}, \eqref{eq:pr-start-sym-aletheme-060}, \eqref{eq:pr-start-sym-aletheme-070}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-090}
                \mycpar{$\V{S:top} = \V{fore} \cat \V{S:top} \cat \V{aft}$
                \cuz \eqref{eq:pr-start-sym-aletheme-080}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-100}
                \V{fore} = \epsilon \land \V{aft} = \epsilon
                \cuz \eqref{eq:pr-start-sym-aletheme-090}.
        \end{equation}
        From the soundness of \V{startAL}, we know that
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-110}
                \mycpar{$\V{fore} \destarV{drv} \Velement{w}{0,\V{origin}}$
                        \cuz \Dfref{aletheme}, \eqref{eq:pr-start-sym-aletheme-020}, and}
        \end{equation}
        since $\V{fore} = \epsilon$,
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-120}
                \V{origin} = 0 \cuz \eqref{eq:pr-start-sym-aletheme-100},
                        \eqref{eq:pr-start-sym-aletheme-110}.
        \end{equation}
        Also from the soundness of \V{startAL}, we know that
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-130}
                \mycpar{$\V{pre} \destarV{drv} \Velement{w}{\V{origin},\V{current}}$
                        \cuz \Dfref{aletheme}, \eqref{eq:pr-start-sym-aletheme-020}, so that}
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-140}
                 \mycpar{$\V{pre} \destarV{drv} \Velement{w}{0,\V{current}}$ \cuz
                         \eqref{eq:pr-start-sym-aletheme-120},
                         \eqref{eq:pr-start-sym-aletheme-130}.}
         \end{equation}
        Collecting our results back into \V{startAL}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-150}
                \V{startAL} = \left( \; \begin{gathered} \V{drv},\epsilon,\epsilon,\V{pre},\V{post}, \\
                        \V{S:lhs},0,\V{current} \\
                \end{gathered} \; \right) \\
                \cuz \eqref{eq:pr-start-sym-aletheme-020}, \eqref{eq:pr-start-sym-aletheme-100},
                        \eqref{eq:pr-start-sym-aletheme-120}.
        \end{equation}
        \eqref{eq:pr-start-sym-aletheme-140} and \eqref{eq:pr-start-sym-aletheme-150} are two
        of the results we needed for the lemma.

        It remains to characterize the rank of \V{startAL}.
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-160}
                \V{S:top} \derivesRaw{0}{\V{drv}} \V{fore} \cat \V{S:lhs} \cat \V{aft}
                \cuz \eqref{eq:pr-start-sym-aletheme-050}, \eqref{eq:pr-start-sym-aletheme-070}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-170}
                \VFA{Dp}{\V{startAL}} = 0
                \cuz \Dfref{rank}, \eqref{eq:pr-start-sym-aletheme-020}, \eqref{eq:pr-start-sym-aletheme-160}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-260}
                \VFA{Rank}{startAL} = \VFA{Dp}{startAL} + 2 \mult \VFA{Ht}{startAL} \cuz \Dfref{rank}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-sym-aletheme-280}
                \VFA{Rank}{startAL} = 2 \mult \VFA{Ht}{startAL} \cuz
                        \eqref{eq:pr-start-sym-aletheme-170}, \eqref{eq:pr-start-sym-aletheme-260}.
        \end{equation}
        With \eqref{eq:pr-start-sym-aletheme-140}, \eqref{eq:pr-start-sym-aletheme-150},
        and \eqref{eq:pr-start-sym-aletheme-280},
        we have all of the results we needed for the lemma.
        \myqed
\end{proof}

\begin{lemma}[Zero height string]
        \label{lm:start-sym-0-aletheme}
        A partial derivative from a symbol instance string to a terminal symbol instance string
        is zero length
        iff all of the symbols in its source are terminals.
        \lmEnd
\end{lemma}

\begin{proof}
        \textbf{The ``if'' direction}:
        \begin{equation}
        \label{lm:pr-start-sym-0-aletheme-010}
                \mycpar{No non-trivial transitions are possible from a
                string of terminal symbol instances
                \cuz \Dfref{transition}.}
        \end{equation}
        \begin{equation}
        \label{lm:pr-start-sym-0-aletheme-020}
        \mycpar{The derivation length from a string of terminal
                symbol instances to any string is zero.
                \cuz \Dfref{derivation-length}, \Obref{derivation-source-length},
                        \eqref{lm:pr-start-sym-0-aletheme-010}.}
        \end{equation}
        \textbf{The ``only if'' direction}:
        \begin{equation}
        \label{lm:pr-start-sym-0-aletheme-030}
                \mycpar{
                In a derivation to a string of terminal symbol instances from
                a symbol instance string with a non-terminal,
                there must have be at least one non-trivial transition.
                \cuz \Dfref{transition}.}
        \end{equation}
        \begin{equation}
        \label{lm:pr-start-sym-0-aletheme-040}
        \mycpar{The derivation length from a string of terminal
                symbol instances to a terminal symbol instance string is
                greater than zero.
                \cuz \Dfref{derivation-length}, \Obref{derivation-source-length},
                        \eqref{lm:pr-start-sym-0-aletheme-030}.}
        \end{equation}
        With \eqref{lm:pr-start-sym-0-aletheme-020} and \eqref{lm:pr-start-sym-0-aletheme-040},
        we have both directions and the theorem.
        \myqed
\end{proof}

\begin{lemma}[Zero rank start symbol aletheme]
        \label{lm:rank-0-start-symbol-aletheme}
        A start symbol aletheme is zero rank
        iff all of the symbols in the predot string of its RHS are terminals.
        \lmEnd
\end{lemma}

\begin{proof}
        \begin{equation}
        \label{eq:pr-rank-0-start-symbol-aletheme-020}
                \mycpar{Let \V{startAL} be an arbitrary start symbol aletheme \\
                \cuz AF lemma.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-start-symbol-aletheme-030}
                \begin{gathered}
                \V{startAL} = \left( \; \begin{gathered}
                                \V{drv},\epsilon,\epsilon,\V{pre},\V{post}, \\
                                \V{S},0,\V{current} \\
                        \end{gathered} \; \right) \\
                        \text{\cuz \Lmref{start-symbol-aletheme},
                                \eqref{eq:pr-rank-0-start-symbol-aletheme-020}, WLOG.}
                \end{gathered}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-start-symbol-aletheme-040}
                \mycpar{$\VFA{Rank}{startAL} = 2 \mult \VFA{Ht}{startAL}$ \\
                \cuz \Lmref{start-symbol-aletheme},
                        \eqref{eq:pr-rank-0-start-symbol-aletheme-020}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-start-symbol-aletheme-050}
                \mycpar{\VFA{Ht}{startAL} is the length of the shortest derivation \\
                such that $\V{pre} \destarV{g} \Velement{w}{0,\V{current}}$
                \cuz \Dfref{rank}, \eqref{eq:pr-rank-0-start-symbol-aletheme-030}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-start-symbol-aletheme-060}
                \mycpar{\VFA{Ht}{startAL} is zero iff \V{pre} is all terminals \\
                \cuz \Lmref{start-sym-0-aletheme}, \eqref{eq:pr-rank-0-start-symbol-aletheme-050}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-start-symbol-aletheme-070}
                \mycpar{\VFA{Rank}{startAL} is zero iff \V{pre} is all
                terminals \cuz
                        \eqref{eq:pr-rank-0-start-symbol-aletheme-040}, \eqref{eq:pr-rank-0-start-symbol-aletheme-060}.}
        \end{equation}
        Recalling that \V{startAL} was an arbitrary start symbol aletheme, with
        \eqref{eq:pr-rank-0-start-symbol-aletheme-070} we have the lemma.
        \myqed
\end{proof}

\begin{lemma}[Zero rank aletheme]
        \label{lm:rank-0-aletheme}
        An altheme is zero rank iff
        \begin{itemize}
                \item it is a start symbol aletheme, and
                \item all of the symbols in the predot string of its RHS are terminals.
        \end{itemize}
        \lmEnd
\end{lemma}

\begin{proof}
        The ``if'' direction follows directly from
                cuz \Lmref{rank-0-start-symbol-aletheme}:
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-100}
                \mycpar{An altheme is zero rank if
                it is a start symbol aletheme, and
                all of the symbols in the predot string of its RHS are terminals
                \cuz \Lmref{rank-0-start-symbol-aletheme}.}
        \end{equation}
        For the ``only if'' direction, we must show that
        only start symbol alethemes are zero rank alethemes.
        We do this by reductio, assuming that there is a
        sound altheme whose LHS is not the start symbol
        but which has zero rank.
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-110}
                \begin{gathered}
                \V{notStartAL} = \left( \; \begin{gathered} \V{drv},\V{fore},\V{aft},\V{pre},\V{post}, \\
                        \V{X},\V{origin},\V{current} \\
                \end{gathered} \; \right) \\
                        \text{\cuz \Dfref{aletheme}, WLOG.}
                \end{gathered}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-120}
                \mycpar{$\V{X} \neq \V{S}$ \cuz AF reductio.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-130}
                \mycpar{$\VFA{Rank}{notStartAL} = 0$ \cuz AF reductio.}
        \end{equation}
        From the soundness of \V{notStartAL},
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-150}
                \V{S} \derivesRaw{\V{n}}{\V{drv}} \V{fore} \cat \V{X} \cat \V{aft}
                \cuz \Dfref{aletheme}, \eqref{eq:pr-rank-0-aletheme-110}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-160}
                \mycpar{$\V{n} > 0$ \cuz \eqref{eq:pr-rank-0-aletheme-120},
                        \eqref{eq:pr-rank-0-aletheme-150}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-170}
                \mycpar{$\VFA{Dp}{notStartAL} > 0$ \cuz
                        \Dfref{rank}, \eqref{eq:pr-rank-0-aletheme-150}, \eqref{eq:pr-rank-0-aletheme-160}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-180}
                \mycpar{$\VFA{Rank}{notStartAL} > 0$ \cuz
                        \Dfref{rank}, \eqref{eq:pr-rank-0-aletheme-170}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-190}
                \mycpar{$\V{X} = \V{S}$ \\
                \cuz reductio due to contradiction between \eqref{eq:pr-rank-0-aletheme-130} and
                        \eqref{eq:pr-rank-0-aletheme-180}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-200}
                \mycpar{An altheme is zero rank only if
                it is a start symbol aletheme
                        \cuz \eqref{eq:pr-rank-0-aletheme-110}, \eqref{eq:pr-rank-0-aletheme-190}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-210}
                \mycpar{A start symbol altheme is zero rank only if
                all of the symbols in the predot string of its RHS are terminals \\
                \cuz \Lmref{rank-0-start-symbol-aletheme}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-rank-0-aletheme-220}
                \mycpar{An altheme is zero rank only if
                it is a start symbol aletheme, and
                all of the symbols in the predot string of its RHS are terminals
                        \cuz \eqref{eq:pr-rank-0-aletheme-200},
                                \eqref{eq:pr-rank-0-aletheme-210}.}
        \end{equation}
        With \eqref{eq:pr-rank-0-aletheme-220} we have the ``only if''
        direction.  Together with \eqref{eq:pr-rank-0-aletheme-100}
        above, this gives us the lemma.
        \myqed
\end{proof}

\begin{lemma}[Start aletheme]
\label{lm:start-aletheme}
        The start altheme \Dfref{start-aletheme} for a derivation \V{drv} is
        \[ \V{startAL} = (\V{drv},\epsilon,\epsilon,\epsilon,\V{rhs},\V{S},0,0), \]
        where $\V{S} \de \V{rhs}$ is the start rule.
        The rank of \V{startAL} is zero.
\end{lemma}

\begin{proof}
        Let \V{drv} be a full derivation.
        \begin{equation}
        \label{eq:pr-start-aletheme-100}
                \mycpar{The start aletheme is a start symbol aletheme \\
                \cuz \Dfref{start-symbol-aletheme}.}
        \end{equation}
        We let an arbitrary start aletheme be
        \begin{equation}
        \label{eq:pr-start-aletheme-110}
                \begin{gathered}
                \V{startAL} = \left( \; \begin{gathered} \V{drv},\epsilon,\epsilon,\V{pre},\V{post}, \\
                        \V{S},0,\V{current} \\
                \end{gathered} \; \right) \\
                        \text{\cuz \Lmref{start-symbol-aletheme}, \eqref{eq:pr-start-aletheme-100}, WLOG.}
                \end{gathered}
        \end{equation}
        In \eqref{eq:pr-start-aletheme-110}, we seek to find the values of \V{pre}, \V{post}
        and \V{current}.
        Without loss of generality, we let the start edge be
        \begin{equation}
        \label{eq:pr-start-aletheme-120}
                \mycpar{$\V{S} \de \mydot \V{rhs}$
                \cuz \Dfref{dedicated-start}, \Dfref{ee-types}, WLOG.}
        \end{equation}
        Since \V{startAL} is the aletheme for the start edge,
        \begin{equation}
        \label{eq:pr-start-aletheme-130}
                \mycpar{$(\V{S} \de \mydot \V{rhs}) = (\V{S} \de \V{pre} \mydot \V{post})$ \\
                \cuz \Dfref{ee-to-al}, \Dfref{start-aletheme},
                        \eqref{eq:pr-start-aletheme-110}, \eqref{eq:pr-start-aletheme-120}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-aletheme-140}
                \V{pre} = \epsilon \cuz \eqref{eq:pr-start-aletheme-130}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-aletheme-150}
                \V{post} = \V{rhs} \cuz \eqref{eq:pr-start-aletheme-130}.
        \end{equation}
        By the soundness of \V{startAL},
        \begin{equation}
        \label{eq:pr-start-aletheme-160}
                \V{pre} \destarV{drv} \Velement{w}{0,\V{current}}
                        \cuz \Dfref{aletheme}, \eqref{eq:pr-start-aletheme-110}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-aletheme-170}
                \V{current} = 0 \cuz \eqref{eq:pr-start-aletheme-140}, \eqref{eq:pr-start-aletheme-160}.
        \end{equation}
        With the above, we have the first part of the lemma:
        \begin{equation}
        \label{eq:pr-start-aletheme-180}
                \begin{gathered}
                \V{startAL} = \left( \; \begin{gathered} \V{drv},\epsilon,\epsilon,\epsilon,\V{rhs}, \\
                        \V{S},0,0 \\
                \end{gathered} \; \right) \\
                        \text{\cuz \eqref{eq:pr-start-aletheme-110}, \eqref{eq:pr-start-aletheme-140},
                                \eqref{eq:pr-start-aletheme-150}, \eqref{eq:pr-start-aletheme-170}, WLOG.}
                \end{gathered}
        \end{equation}
        It remains to show the rank of \V{startAL}.
        \begin{equation}
        \label{eq:pr-start-aletheme-190}
        \VFA{Rank}{startAL} = 2 \mult \VFA{Ht}{startAL}
                \cuz \Lmref{start-symbol-aletheme}, \eqref{eq:pr-start-aletheme-100}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-aletheme-200}
                \mycpar{Let \V{n1} be the minimum length of $\V{pre} \destarV{g} \Velement{w}{0,0}$ \\
                        \cuz \eqref{eq:pr-start-aletheme-160}, \eqref{eq:pr-start-aletheme-170}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-aletheme-210}
                \VFA{Ht}{startAL} = \V{n1} \cuz \Dfref{rank}, \eqref{eq:pr-start-aletheme-200}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-aletheme-220}
                \V{n1} = 0 \cuz \eqref{eq:pr-start-aletheme-140}, \eqref{eq:pr-start-aletheme-200}.
        \end{equation}
        \begin{equation}
        \label{eq:pr-start-aletheme-230}
        \VFA{Rank}{startAL} = 0
                \cuz \eqref{eq:pr-start-aletheme-190}, \eqref{eq:pr-start-aletheme-210},
                \eqref{eq:pr-start-aletheme-220}.
        \end{equation}
        With \eqref{eq:pr-start-aletheme-180} and \eqref{eq:pr-start-aletheme-230},
        we have the lemma.
        \myqed
\end{proof}

\begin{lemma}[Start symbol aletheme location]
\label{start-symbol-aletheme-location}
The current location of a start symbol aletheme
is equal to the count of its predot symbols.
\lmEnd
\end{lemma}

\begin{proof}
\todo{Write this proof}
\myqed
\end{proof}

\begin{lemma}[Start symbol aletheme location]
\label{start-symbol-aletheme-location}
An altheme is a rank 0 aletheme in row 0
iff it is the start aletheme.
\lmEnd
\end{lemma}

\begin{proof}
\todo{Write this proof}
\myqed
\end{proof}

\section{Completion lemmas}

\begin{definition}[Complete ``as far as'']
\label{df:complete-as-far}
        We say that an Earley chart \V{ch} is
        \textbf{complete as far as} row \V{i},
        if all sound alethemes in the
        rows from 0 to \V{i} are present in the chart.
        We say that an Earley chart is
        \textbf{complete as far as} rank \V{r} of row \V{i},
        if the chart is complete as far as row $\V{i} \subtract 1$,
        and if all sound alethemes of rank
        from 0 to \V{r} in row \V{i} are present in the chart.
\dfEnd
\end{definition}

\begin{lemma}[Previous row inflows]
        \label{lm:prev-inflows}
        If the chart is complete as far as row \V{i},
        then Earley events
        for all sound alethemes in row \V{i} and earlier
        will be present in the chart
        throughout every activation event
        in row $\V{i}+1$.
        \lmEnd
\end{lemma}

\begin{proof}
        \begin{equation}
        \label{eq:pr-prev-inflows-010}
                \mycpar{Let \V{ev} be an activation event in row
                \V{j}, but otherwise arbitrary
                \cuz AF lemma, WLOG.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-020}
                \mycpar{Let \V{al} be a sound aletheme
                in row \V{i}, $\V{i}<\V{j}$,
                but otherwise arbitrary
                \cuz AF lemma, WLOG.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-030}
                \mycpar{Row \V{i} is complete \cuz AF lemma, WLOG.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-040}
                \mycpar{Let \V{ee} be the Earley edge corresponding to \V{al}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-050}
                \mycpar{\V{ee} will be recorded in the Earley chart \\
                        \cuz \Dfref{completeness},
                        \eqref{eq:pr-prev-inflows-020},
                        \eqref{eq:pr-prev-inflows-030},
                        \eqref{eq:pr-prev-inflows-040}.}
        \end{equation}
        In \eqref{eq:pr-prev-inflows-030}, we note that ``completeness'' is
        a concept which abstracts from the implementation.
        With \eqref{eq:pr-prev-inflows-050} we have shown that \V{ee} will be
        recorded in the Earley chart at some point,
        but we have not shown anything about when it will
        be recorded in terms of the implementation.
        In particular, we have yet to show that \V{ee} will have been
        recorded in the Earley chart
        before the event \V{ev} occurs.
        We proceed to do this.
        \begin{equation}
                \label{eq:pr-prev-inflows-060}
                \mycpar{If \V{ee} is in the Earley chart, it is recorded before
                any activation event in row \V{j} \cuz
                \Obref{activation-after-previous-row},
                        \eqref{eq:pr-prev-inflows-010},
                        \eqref{eq:pr-prev-inflows-020},
                        \eqref{eq:pr-prev-inflows-040}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-070}
                \mycpar{If \V{ee} is in the Earley chart, it is recorded
                before the event \V{ev} occurs
                \cuz \eqref{eq:pr-prev-inflows-010},
                        \eqref{eq:pr-prev-inflows-060}.}
        \end{equation}
        We know that \V{ee} is in the Earley chart \eqref{eq:pr-prev-inflows-050}.
        We therefore conclude
        \begin{equation}
                \label{eq:pr-prev-inflows-080}
                \mycpar{\V{ee} is recorded before \V{ev} \cuz
                        \eqref{eq:pr-prev-inflows-050},
                        \eqref{eq:pr-prev-inflows-070}.}
        \end{equation}
        Our choice of \V{al}, \V{ee} and \V{ev} were WLOG,
        so that the lemma follows directly from
                \eqref{eq:pr-prev-inflows-080}.
        \myqed
\end{proof}

\begin{lemma}[Tangible reduction completeness]
        \label{lm:rt-comp}
        When running \LEV,
        if the chart is complete as far as rank \V{r}
        of row $\V{i}+1$,
        and \V{downAL} is a sound tangible reduction aletheme
        of rank $\V{r}+1$ in row $\V{i}+1$,
        then \LEV will record the Earley edge
        for \V{downAL} in the chart.
\end{lemma}

\begin{proof}
\begin{equation}
        \label{eq:pr-rt-comp-005}
        \mycpar{Let \V{downAL}
        be an arbitrary sound tangible reduction aletheme of rank
        $\V{r}+1$ in row $\V{i}+1$
        \cuz AF lemma.}
\end{equation}
        Without loss of generality, we let the Earley edge of \V{downAL} be
\begin{equation}
        \label{eq:pr-rt-comp-010}
        \begin{gathered}
                \V{downEE} = (\V{A} \de \V{antepredot} \cat \V{B} \mydot \V{postdot}, \V{origin}, (\V{i}+1)) \\
        \text{\cuz AF lemma, \Dfref{ee-types}, WLOG.}
        \end{gathered}
\end{equation}
        where $\V{antepredot}, \V{postdot} \in \V{STR}$ and $\V{B} \in \V{N}$.
        Let \V{drv} be the derivation of \V{downAL}.
        By assumption for the lemma, \V{downEE} is tangible so that,
        where the predot symbol instance of \V{downAL} is \V{B:pd},
\begin{equation}
        \label{eq:pr-rt-comp-020}
        \begin{gathered}
                \existQ{\V{joint} \in \naturals}{\\
                        \V{B:pd} \destarV{drv} \Velement{w}{\V{joint}, (\V{i}+1)} \\
                        \land \; \V{joint} < (\V{i}+1)} \\
        \text{\cuz AF lemma, \eqref{eq:pr-rt-comp-010}.}
        \end{gathered}
\end{equation}
\begin{equation}
        \label{eq:pr-rt-comp-030}
        \mycpar{\V{joint} is the current location of \V{downEE} less the length of
        the terminal string produced by the predot symbol instance.
        \cuz \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-020}.}
\end{equation}
Noting that a reduction is a confirmation,
\begin{equation}
        \label{eq:pr-rt-comp-040}
        \mycpar{\V{stemAL} is the mainstem of \V{downAL} at \V{joint}
        \bcuz \Lmref{conf-stem},
                \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-020}, \eqref{eq:pr-rt-comp-030}.}
\end{equation}
        The EE of \V{stemAL} is
\begin{equation}
\label{eq:pr-rt-comp-050}
        \begin{gathered}
                \V{stemEE} = (\V{A} \de \V{antepredot} \mydot \V{B} \cat \V{postdot}, \V{origin}, \V{joint}) \\
        \cuz \Dfref{conf-stem}, \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-040}.
        \end{gathered}
\end{equation}
We now turn to consider the tributary of \V{downAL}.
\begin{equation}
        \label{eq:pr-rt-comp-090}
        \mycpar{\V{tribAL} is the ranked tributary of \V{downAL} at \V{joint} \\
        \cuz \Lmref{red-trib},
                \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-020}, \eqref{eq:pr-rt-comp-030}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-100}
        \mycpar{The Earley edge of \V{tribAL} is \\
                $\V{tribEE} = (\V{B} \de \V{rhs} \mydot, \V{joint}, (\V{i}+1))$ \\
        where $\V{B} \de \V{rhs} \in \V{P}$ \\
        \cuz \Dfref{red-trib}, \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-090}, WLOG.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-200}
        \mycpar{$\VFA{Rank}{tribAl} < \VFA{Rank}{downAL}$
                \cuz \Lmref{red-trib}, \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-090}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-210}
        \mycpar{$\VFA{Rank}{downAL} = \V{r} + 1$
                \cuz \eqref{eq:pr-rt-comp-005}, \eqref{eq:pr-rt-comp-200}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-220}
        \mycpar{$0 \le \VFA{Rank}{tribAL} \le \V{r}$
                \cuz \eqref{eq:pr-rt-comp-200}, \eqref{eq:pr-rt-comp-210}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-230}
        \mycpar{The chart is complete as far as rank \V{r} of row $\V{i}+1$ \\
        \cuz AF lemma.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-240}
        \begin{gathered}
                \text{\V{tribEE} is in the chart
                        \cuz \eqref{eq:pr-rt-comp-100},
                        \eqref{eq:pr-rt-comp-220}, \eqref{eq:pr-rt-comp-230}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-250}
        \begin{gathered}
                \text{\V{tribEE} will be activated exactly once
                        \cuz \Obref{activation-unique},
                        \eqref{eq:pr-rt-comp-240}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-260}
        \begin{gathered}
                \text{\V{tribEE} will be activated
                at row $\V{i}+1$
                        \cuz \Obref{activation-at-currloc}, \eqref{eq:pr-rt-comp-100}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-270}
        \mycpar{If \V{stemEE} is in the chart, it will be in row \V{joint},
            $\V{joint} < \V{i}+1$
            \cuz \Obref{recording-at-currloc} \eqref{eq:pr-rt-comp-020}, \eqref{eq:pr-rt-comp-050}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-280}
        \mycpar{Rows 0 thru $\V{i}+1$ are complete \cuz AF lemma.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-290}
        \mycpar{Row \V{joint} is complete \cuz \eqref{eq:pr-rt-comp-270}, \eqref{eq:pr-rt-comp-280}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-300}
                \mycpar{\V{stemEE} will be in row \V{joint} of the chart when
                \V{tribEE} is activated
        \cuz \Lmref{prev-inflows}, \eqref{eq:pr-rt-comp-260}, \eqref{eq:pr-rt-comp-270},
                        \eqref{eq:pr-rt-comp-290}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-310}
        \mycpar{When run for \V{tribEE}, \Algref{tangible-reduction}
            looks for \V{stemEE} in row \V{joint} and,
            if it finds it, records \V{downEE} \cuz \Algref{tangible-reduction}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-320}
        \mycpar{When run for \V{tribEE}, \Algref{tangible-reduction} records \V{downEE} \\
            \cuz \Algref{tangible-reduction} \eqref{eq:pr-rt-comp-300}, \eqref{eq:pr-rt-comp-310}.}
\end{equation}
Keeping in mind that \V{tribEE} is a completion, and tangible,
\begin{equation}
\label{eq:pr-rt-comp-330}
        \mycpar{When \V{tribEE} is activated, \Algref{tangible-reduction}
        is run for \V{tribEE} \\
        \cuz lines \ref{li:finish-row-050}--\ref{li:finish-row-080} of \Algref{finish-row},
                \eqref{eq:pr-rt-comp-020}, \eqref{eq:pr-rt-comp-100}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-340}
        \mycpar{\Sref{algorithm} records \V{downEE}
                \cuz \eqref{eq:pr-rt-comp-250}, \eqref{eq:pr-rt-comp-320}, \eqref{eq:pr-rt-comp-330}.}
\end{equation}
Equation \eqref{eq:pr-rt-comp-340} is what we needed to show
for the lemma.
\myqed
\end{proof}

\begin{lemma}[Intangible reduction completeness]
        \label{lm:ri-comp}
        When running \LEV,
        if the chart is complete as far as rank \V{r}
        of row $\V{i}+1$,
        and \V{downAL} is a sound intangible reduction aletheme
        of rank $\V{r}+1$ in row $\V{i}+1$,
        then either either \V{downAL} is a nulling completion,
        or \LEV will record the Earley edge
        for \V{downAL} in the chart.
\end{lemma}

\begin{proof}
\begin{equation}
        \label{eq:pr-ri-comp-005}
        \mycpar{Let \V{downAL}
        be an arbitrary sound intangible reduction aletheme of rank
        $\V{r}+1$ in row $\V{i}+1$
        \cuz AF lemma.}
\end{equation}
\begin{equation}
        \label{eq:pr-ri-comp-007}
        \begin{gathered}
        \V{downAL} = \left( \begin{gathered} \;
                \V{drv},\V{fore},\V{aft},(\V{antepredot}\cat\V{B:pd}),\V{postdot}, \\
                \V{lhs},\V{origin},(\V{i}+1)
                \; \end{gathered} \right) \\
        \mycpar{where $\V{antepredot}, \V{postdot} \in \V{STR}$ and $\V{B} \in \V{N}$ \\
        \cuz AF lemma, \Dfref{ee-types}, \eqref{eq:pr-ri-comp-005}, WLOG.}
        \end{gathered}
\end{equation}
\begin{equation}
        \label{eq:pr-ri-comp-010}
        \mycpar{$\V{downEE} = (\V{A} \de \V{antepredot} \cat \V{B} \mydot \V{postdot}, \V{origin}, (\V{i}+1))$ \\
                \cuz \Dfref{ee-to-al}, \eqref{eq:pr-ri-comp-007}.}
\end{equation}
        By assumption for the lemma, \V{downEE} is intangible so that
\begin{equation}
        \label{eq:pr-ri-comp-020}
        \mycpar{$\V{B:pd} \destarV{drv} \epsilon$ \cuz AF lemma, \eqref{eq:pr-ri-comp-010}.}
\end{equation}
\begin{equation}
        \label{eq:pr-ri-comp-030}
        \mycpar{(\V{i}+1) is the current location of \V{downEE} less the length of
        the terminal string produced by the predot symbol instance.
        \cuz \eqref{eq:pr-ri-comp-020}.}
\end{equation}
Noting that a reduction is a confirmation,
\begin{equation}
        \label{eq:pr-ri-comp-040}
        \mycpar{$\V{stemAL} = (\V{drv},\V{fore},\V{aft},\V{antepredot},(\V{B:pd}\cat\V{postdot}),$ \\
        $\V{lhs},\V{origin},(\V{i}+1))$ \\
        is the mainstem of \V{downAL} at $\V{i}+1$ \\
        and $\VFA{Rank}{stemAL} < \VFA{Rank}{downAL}$ \\
        \cuz \Lmref{conf-stem}, \eqref{eq:pr-ri-comp-007}, \eqref{eq:pr-ri-comp-030}.}
\end{equation}
        The EE of \V{stemAL} is
\begin{equation}
\label{eq:pr-ri-comp-050}
        \begin{gathered}
                \V{stemEE} = (\V{A} \de \V{antepredot} \mydot \V{B} \cat \V{postdot}, \V{origin},(\V{i}+1)) \\
        \cuz \Dfref{ee-to-al}, \eqref{eq:pr-ri-comp-040}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-210}
        \mycpar{$\VFA{Rank}{downAL} = \V{r} + 1$ \cuz \eqref{eq:pr-ri-comp-005}.}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-220}
        \mycpar{$\VFA{Rank}{stemAL} < \VFA{Rank}{downAL}$ \\
                \cuz \eqref{eq:pr-ri-comp-040}.}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-230}
        \mycpar{$0 \le \VFA{Rank}{stemAL} \le \V{r}$
                \cuz \eqref{eq:pr-ri-comp-210}, \eqref{eq:pr-ri-comp-220}.}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-240}
        \mycpar{The chart is complete as far as rank \V{r} of row $\V{i}+1$ \\
        \cuz AF lemma.}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-250}
        \begin{gathered}
                \text{\V{stemEE} is in the chart
                        \cuz \eqref{eq:pr-ri-comp-050},
                        \eqref{eq:pr-ri-comp-230}, \eqref{eq:pr-ri-comp-240}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-260}
        \begin{gathered}
                \text{\V{stemEE} will be activated exactly once
                        \cuz \Obref{activation-unique},
                        \eqref{eq:pr-ri-comp-250}.}
        \end{gathered}
\end{equation}
Keeping in mind that \V{stemEE} is an incompletion,
with a nullable postdot symbol,
\begin{equation}
\label{eq:pr-ri-comp-330}
        \mycpar{When \V{stemEE} is activated, \Algref{intangible-reduction}
        is run for \V{stemEE} \\
        \cuz lines \ref{li:finish-row-090}--\ref{li:finish-row-130} of \Algref{finish-row}
                \eqref{eq:pr-ri-comp-020}, \eqref{eq:pr-ri-comp-050}.}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-340}
        \mycpar{When run for \V{stemEE}, \Algref{intangible-reduction} records \V{downEE} \\
            \cuz \Algref{intangible-reduction}, \eqref{eq:pr-ri-comp-010}, \eqref{eq:pr-ri-comp-050}.}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-350}
        \mycpar{\Sref{algorithm} records \V{downEE}
                \cuz \eqref{eq:pr-ri-comp-260}, \eqref{eq:pr-ri-comp-330}, \eqref{eq:pr-ri-comp-340}.}
\end{equation}
Equation \eqref{eq:pr-ri-comp-350} is what we needed to show
for the lemma.
\myqed
\end{proof}

\begin{lemma}[Reduction completeness]
        \label{lm:red-comp}
        When running \LEV,
        if the chart is complete as far as rank \V{r}
        of row $\V{i}+1$,
        and \V{downAL} is a reduction aletheme
        of rank $\V{r}+1$ in row $\V{i}+1$,
        then either \V{downAL} is a nulling completion,
        or \LEV will record the Earley edge
        for \V{downAL} in the chart.
        \lmEnd
\end{lemma}

\begin{proof}
        \begin{equation}
        \label{eq:pr-red-comp-100}
                \mycpar{Every reduction is either tangible or intangible. \\
        \cuz \Dfref{tangible-symbol}, \Dfref{tangible-reduction}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-red-comp-110}
                \mycpar{The statement of this lemma is true for tangible reductions. \cuz \Lmref{rt-comp}.}
        \end{equation}
        \begin{equation}
        \label{eq:pr-red-comp-120}
                \mycpar{The statement of this lemma is true for intangible reductions. \cuz \Lmref{ri-comp}.}
        \end{equation}
        The lemma follows directly from
        \eqref{eq:pr-red-comp-100}, \eqref{eq:pr-red-comp-110}, and \eqref{eq:pr-red-comp-120}.
\myqed
\end{proof}

\begin{lemma}[Scansion completeness]
        \label{lm:scansion-completeness}
        When running \LEV,
        if the chart is complete as far as row \V{i},
        and \V{downAL} is a sound scansion aletheme
        in row $\V{i}+1$,
        then \LEV will record the Earley edge
        for \V{downAL} in the chart.
\end{lemma}

\begin{proof}
\begin{equation}
        \label{eq:pr-scan-comp-005}
        \mycpar{Let \V{downAL}
        be an arbitrary sound scansion aletheme of rank
        $\V{r}+1$ in row $\V{i}+1$
        \cuz AF lemma.}
\end{equation}
        Without loss of generality, we let the Earley edge of \V{downAL} be
\begin{equation}
        \label{eq:pr-scan-comp-010}
        \begin{gathered}
                \V{downEE} = (\V{A} \de \V{antepredot} \cat \V{t} \mydot \V{postdot}, \V{origin}, (\V{i}+1)) \\
        \text{\cuz AF lemma, \Dfref{ee-types}, WLOG.}
        \end{gathered}
\end{equation}
        where $\V{antepredot}, \V{postdot} \in \V{STR}$ and $\V{t} \in \V{T}$.
        Let \V{drv} be the derivation of \V{downAL}.
        By assumption for the lemma, \V{downEE} is a scansion so that,
        where the predot symbol instance of \V{downAL} is \V{t:f},
\begin{equation}
        \label{eq:pr-scan-comp-015}
        \mycpar{$\V{t:f} = \Velement{w}{\V{i}}$ \cuz AF lemma, \eqref{eq:pr-scan-comp-010}.}
\end{equation}
\begin{equation}
        \label{eq:pr-scan-comp-020}
        \mycpar{$\V{t:f} \destarV{drv} \Velement{w}{\V{i}}$
                \cuz AF lemma, \eqref{eq:pr-scan-comp-010}, \eqref{eq:pr-scan-comp-015}.}
\end{equation}
\begin{equation}
        \label{eq:pr-scan-comp-030}
        \mycpar{\V{i} is the current location of \V{downEE} less the length of
        the terminal string produced by the predot symbol instance \\
        \cuz \eqref{eq:pr-scan-comp-010}, \eqref{eq:pr-scan-comp-020}.}
\end{equation}
Noting that a scansion is a confirmation,
\begin{equation}
        \label{eq:pr-scan-comp-040}
        \mycpar{\V{stemAL} is the mainstem of \V{downAL} at \V{i}
        \bcuz \Lmref{conf-stem},
                \eqref{eq:pr-scan-comp-010}, \eqref{eq:pr-scan-comp-020}, \eqref{eq:pr-scan-comp-030}.}
\end{equation}
        The EE of \V{stemAL} is
\begin{equation}
\label{eq:pr-scan-comp-050}
        \begin{gathered}
                \V{stemEE} = (\V{A} \de \V{antepredot} \mydot \V{t:f} \cat \V{postdot}, \V{origin}, \V{i}) \\
        \cuz \Dfref{conf-stem}, \eqref{eq:pr-scan-comp-010}, \eqref{eq:pr-scan-comp-040}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-scan-comp-230}
        \mycpar{The chart is complete as far as row \V{i} \\
        \cuz AF lemma.}
\end{equation}
\begin{equation}
\label{eq:pr-scan-comp-240}
        \mycpar{Row \V{i} is complete \cuz \eqref{eq:pr-scan-comp-230}.}
\end{equation}
\begin{equation}
\label{eq:pr-scan-comp-270}
        \mycpar{If \V{stemEE} is in the chart, it will be in row \V{i} \\
            \cuz \Obref{recording-at-currloc} \eqref{eq:pr-scan-comp-020}, \eqref{eq:pr-scan-comp-050}.}
\end{equation}
\begin{equation}
\label{eq:pr-scan-comp-300}
                \mycpar{\V{stemEE} will be in row \V{i} of the chart when
                \Algref{scansion} is called for row $\V{i}+1$
        \cuz \Obref{scansion-timing}, \eqref{eq:pr-scan-comp-240},
                        \eqref{eq:pr-scan-comp-270}.}
\end{equation}
\begin{equation}
\label{eq:pr-scan-comp-310}
        \mycpar{\Algref{scansion}
            looks for \V{stemEE} in row \V{i} and,
            if it finds it, records \V{downEE}
            \cuz \Algref{scansion}, \eqref{eq:pr-scan-comp-010}, \eqref{eq:pr-scan-comp-270}.}
\end{equation}
\begin{equation}
\label{eq:pr-scan-comp-340}
        \mycpar{\LEV records \V{downEE}
                \cuz \eqref{eq:pr-scan-comp-300}, \eqref{eq:pr-scan-comp-310}.}
\end{equation}
Equation \eqref{eq:pr-scan-comp-340} is what we needed to show
for the lemma.
\myqed
\end{proof}

\begin{lemma}[Prediction completeness]
        \label{lm:prediction-completeness}
        When running \LEV,
        if the chart is complete as far as rank \V{r}
        of row $\V{i}+1$,
        and \V{downAL} is a prediction aletheme
        of rank $\V{r}+1$ in row $\V{i}+1$,
        then either \V{downAL} is a nulling completion,
        or \LEV will record the Earley edge
        for \V{downAL} in the chart.
        \todo{Revise to be useable in row 0}
        \lmEnd
\end{lemma}

\begin{proof}
\begin{equation}
        \label{eq:pred-comp-010}
        \mycpar{Let \V{downAL}
        be an arbitrary sound prediction aletheme of rank
        $\V{r}+1$ in row $\V{i}+1$
        \cuz AF lemma.}
\end{equation}
\begin{equation}
        \label{eq:pred-comp-020}
        \begin{gathered}
        \V{downAL} = \left( \begin{gathered} \;
                \V{drv},\V{fore},\V{aft},\epsilon,\V{rhs}, \\
                \V{Z:f},(\V{i}+1),(\V{i}+1)
                \; \end{gathered} \right) \\
                \mycpar{where $\V{fore}, \V{pre}, \V{rhs} \in \V{STR}$ and $\V{Z} \in \V{N}$ \\
        \cuz AF lemma, \Dfref{ee-types}, \eqref{eq:pred-comp-010}, WLOG.}
        \end{gathered}
\end{equation}
\begin{equation}
        \label{eq:pred-comp-030}
        \mycpar{$\V{downEE} = (\V{Z} \de \mydot \V{rhs}, (\V{i}+1)), (\V{i}+1))$ \\
                \cuz \Dfref{ee-to-al}, \eqref{eq:pred-comp-020}.}
\end{equation}
\begin{equation}
        \label{eq:pred-comp-040}
        \begin{gathered}
        \V{stemAL} = \left( \begin{gathered}
                        \V{drv},\V{foreY},\V{aftY}, \\
                        \V{pre},(\V{Z:f}\cat\V{post}),\V{Y},\V{origin},(\V{i}+1)
                \end{gathered} \right) \\
        \mycpar{is the mainstem of \V{downAL} at $\V{i}+1$ \\
                and $\VFA{Rank}{stemAL} = \VFA{Rank}{downAL} \subtract 1$ \\
                \cuz \Lmref{pred-stem}, \eqref{eq:pred-comp-020}, \eqref{eq:pred-comp-030}, WLOG.}
        \end{gathered}
\end{equation}
        The EE of \V{stemAL} is
\begin{equation}
\label{eq:pred-comp-050}
        \begin{gathered}
                \V{stemEE} = (\V{Y} \de \V{pre} \mydot \V{Z:f} \cat \V{post}, \V{origin},(\V{i}+1)) \\
        \cuz \Dfref{ee-to-al}, \eqref{eq:pred-comp-040}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pred-comp-210}
        \mycpar{$\VFA{Rank}{downAL} = \V{r} + 1$ \cuz \eqref{eq:pred-comp-010}.}
\end{equation}
\begin{equation}
\label{eq:pred-comp-220}
        \mycpar{$\VFA{Rank}{stemAL} = \VFA{Rank}{downAL} \subtract 1$ \\
                \cuz \eqref{eq:pred-comp-040}.}
\end{equation}
\begin{equation}
\label{eq:pred-comp-230}
        \mycpar{$\VFA{Rank}{stemAL} = \V{r}$
                \cuz \eqref{eq:pred-comp-210}, \eqref{eq:pred-comp-220}.}
\end{equation}
\begin{equation}
\label{eq:pred-comp-240}
        \mycpar{The chart is complete as far as rank \V{r} of row $\V{i}+1$ \\
        \cuz AF lemma.}
\end{equation}
\begin{equation}
\label{eq:pred-comp-250}
        \begin{gathered}
                \text{\V{stemEE} is in the chart
                        \cuz \eqref{eq:pred-comp-050},
                        \eqref{eq:pred-comp-230}, \eqref{eq:pred-comp-240}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pred-comp-260}
        \begin{gathered}
                \text{\V{stemEE} will be activated exactly once
                        \cuz \Obref{activation-unique},
                        \eqref{eq:pred-comp-250}.}
        \end{gathered}
\end{equation}
Keeping in mind that \V{stemEE} is an incompletion,
\begin{equation}
\label{eq:pred-comp-330}
        \mycpar{When \V{stemEE} is activated, \Algref{predictions}
        is run for \V{stemEE} \\
        \cuz lines \ref{li:finish-row-100}--\ref{li:finish-row-150} of \Algref{finish-row},
                \eqref{eq:pred-comp-050}.}
\end{equation}
\begin{equation}
\label{eq:pred-comp-340}
        \mycpar{When run for \V{stemEE}, \Algref{predictions} records \V{downEE} \\
            \cuz \Algref{predictions}, \eqref{eq:pred-comp-030}, \eqref{eq:pred-comp-050}.}
\end{equation}
\begin{equation}
\label{eq:pred-comp-350}
        \mycpar{\LEV records \V{downEE}
                \cuz \eqref{eq:pred-comp-260}, \eqref{eq:pred-comp-330}, \eqref{eq:pred-comp-340}.}
\end{equation}
Equation \eqref{eq:pred-comp-350} is what we needed to show
for the lemma.
\myqed
\end{proof}

\begin{lemma}[Chart basis]
        \label{lm:chart-basis}
        After starting \LEV,
        the chart is complete as far as row 0.
        \lmEnd
\end{lemma}

\begin{proof}
        Proof omitted. \todo{Write this proof}
        \todo{Use row 0 version of row step}
        \myqed
\end{proof}

\begin{lemma}[Row basis]
        \label{lm:row-basis}
        If \LEV is complete as far as row \V{i},
        then \LEV is complete as far as rank 0 of row $\V{i}+1$.
        \lmEnd
\end{lemma}

\begin{proof}
        Proof omitted. \todo{Write this proof}
        \myqed
\end{proof}

\begin{lemma}[Row step]
        \label{lm:row-step}
        When running \LEV,
        if the chart is complete
        as far as rank \V{r} of row $\V{i}+1$,
        then the chart is complete
        as far as rank $\V{r}+1$ of row $\V{i}+1$.
        \todo{Create row zero version of row step}
        \lmEnd
\end{lemma}

\begin{proof}
        \begin{equation}
                \label{eq:pr-row-step-950}
                \mycpar{Let \V{newAL} be a sound aletheme
                of rank $\V{r}+1$ in row \V{i}+1
                \cuz AF lemma.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-row-step-1000}
                \mycpar{The rank of the start aletheme is 0
                \cuz \Lmref{start-aletheme}.}
        \end{equation}
        Obviously,
        \begin{equation}
                \label{eq:pr-row-step-1010}
                0 < \V{r}+1,
        \end{equation}
        so it is the case vacuously that
        \begin{equation}
                \label{eq:pr-row-step-1020}
                \mycpar{if \V{newAL} is a start aletheme,
                either \V{newAL} is a nulling completion,
                or \LEV will record the Earley edge for \V{newAL} in the chart
                \cuz \eqref{eq:pr-row-step-950}, \eqref{eq:pr-row-step-1000},
                        \eqref{eq:pr-row-step-1010}, vacuously.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-row-step-1030}
                \mycpar{The chart is complete
                        as far as rank \V{r} of row $\V{i}+1$ \\
                        \cuz AF lemma.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-row-step-1040}
                \mycpar{If \V{newAL} is a scansion aletheme,
                then \LEV will record the Earley edge for \V{newAL} in the chart \\
                \cuz \Lmref{scansion-completeness},
                \eqref{eq:pr-row-step-950}, \eqref{eq:pr-row-step-1030}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-row-step-1050}
                \mycpar{If \V{newAL} is a reduction aletheme,
                either \V{newAL} is a nulling completion,
                or \LEV will record the Earley edge for \V{newAL} in the chart
                \cuz \Lmref{red-comp},
                \eqref{eq:pr-row-step-950}, \eqref{eq:pr-row-step-1030}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-row-step-1060}
                \mycpar{If \V{newAL} is a predicted aletheme,
                either \V{newAL} is a nulling completion,
                or \LEV will record the Earley edge for \V{newAL} in the chart
                \cuz \Lmref{prediction-completeness},
                \eqref{eq:pr-row-step-950}, \eqref{eq:pr-row-step-1030}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-row-step-1070}
                \mycpar{\V{newAL} is either the start aletheme,
                a scansion,
                a reduction,
                or a predicted aletheme \\
                \cuz \Dfref{ee-types}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-row-step-1080}
                \mycpar{Either \V{newAL} is a nulling completion,
                or \LEV will record the Earley edge for \V{newAL} in the chart \\
                \cuz \eqref{eq:pr-row-step-1020}, \eqref{eq:pr-row-step-1040}, \eqref{eq:pr-row-step-1050},
                \eqref{eq:pr-row-step-1060}, \eqref{eq:pr-row-step-1070}.}
        \end{equation}
        Since \V{newAL} was arbitrarily chosen,
        the lemma follows from \eqref{eq:pr-row-step-1080}.
        \myqed
\end{proof}

\begin{lemma}[Chart step]
        \label{lm:chart-step}
        When running \LEV,
        the chart is complete as far as row $\V{i}+1$
        if it is complete as far as row \V{i}.
        \lmEnd
\end{lemma}

\begin{proof}
        We use induction on the ranks,
        with \Lmref{row-basis} as the basis,
        and \Lmref{row-step} as the step.
        \myqed
\end{proof}

\begin{theorem}[\LEV is complete]
        \label{th:lev-complete}
        \LEV is complete.
        \lmEnd
\end{theorem}

\begin{proof}
        We use induction on the rows.
        with \Lmref{chart-basis} as the basis,
        and \Lmref{chart-step} as the step.
        \myqed
\end{proof}

\begin{theorem}[\LEV is correct]
        \LEV is correct.
        \lmEnd
\end{theorem}

\begin{proof}
        The theorem follows from
        \Thref{lev-sound} and \Thref{lev-complete}.
        \myqed
\end{proof}

\FloatBarrier

{
\clearpage

% Ragged right, do not hyphenate.
\RaggedRight
\hyphenpenalty=10000
\exhyphenpenalty=10000

% Silence current hbox warnings, but allow them if
% badness increases further
\hbadness=2000

\begin{thebibliography}{10}

\bibitem{AH1972v1}
\newblock{Aho, Alfred V., and Jeffrey D. Ullman.}
\newblock{\em The theory of parsing, translation, and compiling. Vol. 1.}
\newblock{Prentice-Hall, 1972.}

\bibitem{Kegler2023}
\newblock{Jeffrey Kegler.}
\newblock{``Marpa, A practical general parser: the recognizer''.}
\newblock{\url{https://arxiv.org/abs/1910.08129}.
   Retrieved 2 December, 2024.}

\bibitem{llguidance}
\newblock{llguidance team.}
\newblock{"Low-level guidance parser".}
\newblock{
  \url{https://github.com/microsoft/llguidance}.
  Retrieved 2 December, 2024.}

\end{thebibliography}

} % RaggedRight

% \clearpage
% \phantomsection
% \listofalgorithms

\clearpage
\phantomsection
\renewcommand{\listtheoremname}{Formal apparatus}

\clearpage
\phantomsection
\pdfbookmark[0]{\listtheoremname}{listoflemmas}
% swapnumber would be cool, but is not in the thmtools in
% the latest Raspbian
\listoftheorems[ignoreall,onlynamed=observation,
    show={lemma,ldef,theorem,example,remark,definition}]

\ifdraft{
    \clearpage
    \phantomsection
    \listoftodos
}{}

\end{document}
