\documentclass[draft,12pt]{amsart}
\usepackage{float}

\usepackage[final]{listings}
\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}
\usepackage{arydshln}
\usepackage{multirow}
\usepackage{needspace}

\usepackage{thmtools}

\newcommand{\Pipe}{\charâ€˜\|}
\newcommand{\See}[2]{\emph{see} #1}
\usepackage{amssymb}
\usepackage{wasysym} % Used for \Circle
\usepackage{algorithm}
\usepackage[commentColor=blue,italicComments=false]{algpseudocodex}
\usepackage{xspace}
\usepackage{graphicx}
\usepackage{ragged2e}
\usepackage{url}
\usepackage[final]{hyperref}
\usepackage{placeins}
\usepackage{mfirstuc}
\usepackage{ifdraft}
\usepackage[obeyDraft]{todonotes}
\usepackage{datetime2}
\ifdraft{
        \usepackage[
    colorspec=0,
    text=DRAFT\ \DTMnow{}\ DRAFT,
    angle=0,
    scale=1.5,
    fontsize=12pt,
    vpos=.5in
        ]{draftwatermark}
}{}

% Fix conflict between todonotes and amsart packages
% See http://ctan.math.washington.edu/tex-archive/macros/latex/contrib/todonotes/todonotes.pdf,
% p. 10.
\makeatletter
\providecommand\@dotsep{5}
\def\listtodoname{List of TODOs}
\def\listoftodos{\@starttoc{tdo}\listtodoname}
\makeatother

\makeatletter
\renewcommand{\listofalgorithms}{\@starttoc{loa}{List of algorithms}}
\let\l@algorithm=\l@figure
\makeatother

% Re hbox's, see
% https://tex.stackexchange.com/questions/241343/what-is-the-meaning-of-fussy-sloppy-emergencystretch-tolerance-hbadness
\raggedbottom

% Replaced by todonotes package
% \newcommand{\todo}[1]{\par{\large\bf Todo: #1}\par}

\newcommand{\mymathop}[1]{\mathop{\texttt{#1}}}
\newcommand{\mymathbin}[1]{\mathbin{\texttt{#1}}}

% For a type name, when it occurs in text
\newcommand{\type}[1]{\ensuremath{\texttt{#1}}}

\newcommand{\True}{\mbox{\sf T}\xspace}
\newcommand{\False}{\mbox{\sf F}\xspace}
\newcommand{\Trueword}{\sf true}
\newcommand{\Falseword}{\sf false}
\newcommand{\Neg}{\neg}
\newcommand{\Implies}{\supset}
\newcommand{\ImpliesAlt}{\Rightarrow}
\newcommand{\NEquiv}{\not\equiv}
\newcommand{\NEquivRel}{\mathrel{\not\equiv}}

\newcommand{\qeq}{\simeq}
\newcommand{\nqeq}{\not\simeq}
\newcommand{\unicorn}{\ensuremath{\bot}\xspace}
\newcommand{\TRUE}{\ensuremath{\mathbb T}\xspace}
\newcommand{\FALSE}{\ensuremath{\mathbb F}\xspace}

\newcommand{\mult}{\mathbin{\ast}}
\newcommand{\dfn}[1]{{\bf #1}}
\newcommand{\sep}{\,\mid\,}
\newcommand{\mydot}{\raisebox{.05em}{$\,\bullet\,$}}
\newcommand{\wmydot}{\raisebox{.05em}{$\,\,\bullet\,\,$}}
\newcommand{\cat}{\,.\,}
\newcommand{\wcat}{\,\,.\,\,}
\newcommand{\size}[1]{\ensuremath{\left | {#1} \right |}}
\newcommand{\Vsize}[1]{\ensuremath{\size{\var{#1}}}}
\newcommand{\bigsize}[1]{\ensuremath{\bigl| {#1} \bigr|}}
\newcommand{\order}[1]{\ensuremath{{\mathcal O}(#1)}\xspace}
\newcommand{\Oc}{\order{1}}
\newcommand{\On}{\order{\var{n}}}
\newcommand{\inference}[2]{\genfrac{}{}{1pt}{}{#1}{#2}}

\newcommand{\lastix}[1]{\ensuremath{\##1}}
\newcommand{\Vlastix}[1]{\ensuremath{\lastix{\V{#1}}}}
\newcommand{\VlastElement}[1]{\Velement{#1}{\Vlastix{#1}}}
\newcommand{\element}[2]{\ensuremath{\mathop{#1}
    \mathopen{}\left[#2\right]\mathclose{}}}
\newcommand{\Velement}[2]{\ensuremath{\mathop{\V{#1}}
    \mathopen{}\left[#2\right]\mathclose{}}}
\newcommand{\VVelement}[2]{\ensuremath{\mathop{\V{#1}}
    \mathopen{}\left[ \V{#2}
    \right]\mathclose{} }}

% \newcommand{\tuple}[1]{\ensuremath{\left\langle #1 \right\rangle}}
\newcommand{\tuple}[1]{\ensuremath{\mathopen{}\left[#1\right]\mathclose{}}}

\newcommand{\mcolon}{\mathrel:}
\newcommand{\mcoloncolon}{\mathrel{\vcenter{\hbox{$::$}}}}

% \newcommand{\suchthat}{\mcoloncolon}
% In this paper, use \mid
\newcommand{\suchthat}{\mid}
\newcommand{\quantify}[3]{% quantifier, binding, predicate
    \ensuremath{\mathrel{#1}#2 \; \suchthat \; #3}%
}

\newcommand{\existUniqQOp}{\mathop{\exists{!}}}
\newcommand{\existUniqQ}[2]{\quantify{\existUniqQOp}{#1}{#2}}
% extra {} in existQOP and univQOp to raise to baseline
\newcommand{\existQOp}{\mathop{\exists{}}}
\newcommand{\existQ}[2]{\quantify{\existQOp}{#1}{#2}}
% extra {} in existQOP and univQOp to raise to baseline
\newcommand{\univQOp}{\mathop{\forall{}\,}}
\newcommand{\univQ}[2]{\quantify{\univQOp}{#1}{#2}}

% I use hyphens in variable names,
% so I need to ensure that subtraction is
% clearly distinguished by the typography
\newcommand{\subtract}{\,-\,}

\newcommand{\var}[1]{\ensuremath{\texttt{#1}}}
\newcommand{\V}[1]{\ensuremath{\texttt{\mbox{#1}}}}

\newcommand{\cfg}{CFG}

\newcommand{\de}{\mathrel{::=}}
\newcommand{\derives}{\Rightarrow}
\newcommand{\derivesW}[1]
    {\mathrel{\mbox{$\:\underset{#1}{\Rightarrow}$}}}
\newcommand{\derivesV}[1]{\derivesW{\V{#1}}}
\newcommand{\destar}
    {\mathrel{\mbox{$\:\stackrel{\!{\ast}}{\Rightarrow\!}\:$}}}
\newcommand{\destarW}[1]
    {\mathrel{\mbox{$\:\underset{#1}{\overset{\ast\:}{\Rightarrow}}$}}}
\newcommand{\destarV}[1]{\destarW{\V{#1}}}
\newcommand{\deplus}
    {\mathrel{\mbox{$\:\stackrel{\!{+}}{\Rightarrow\!}\:$}}}
\newcommand{\deplusW}[1]
    {\mathrel{\mbox{$\:\underset{#1}{\overset{{+}\:}{\Rightarrow}}$}}}
\newcommand{\deplusV}[1]{\deplusW{\V{#1}}}
\newcommand{\derivg}[1]{\mathrel{\mbox{$\:\Rightarrow\:$}}}
\newcommand{\derivrg}[2]{\mathrel{\mbox{$\:\stackrel{\!{#1}}%
        {\Rightarrow\!}\:$}}}

% For the type subscript for powersets
\newcommand{\setOf}[1]{{{#1}^{\mbox{\normalsize $\ast$}}}}

\newcommand{\set}[1]{{\left\lbrace #1 \right\rbrace} }
\newcommand{\bigset}[1]{{\bigl\lbrace #1 \bigr\rbrace} }
\newcommand{\Bigset}[1]{{\Bigl\lbrace #1 \Bigr\rbrace} }

\DeclareMathOperator{\wrt}{wrt}

% use internal counter of algorithmicx
\newcommand{\algnested}{ %
  \makeatletter\ALG@nested\makeatother %
}

\newcommand{\algstrut}{\rule{0pt}{.85\baselineskip}}



% I use parboxes in equations.  This sets a useful width for them.
\newlength{\mathparwidth}
\newlength{\longtagwidth}
\settowidth{\longtagwidth}{(99999)\quad}
\setlength{\mathparwidth}{\dimexpr\textwidth-\longtagwidth}
\newcommand{\myparbox}[2][\mathparwidth]{%
  \parbox[t]{#1}{%
  % \linespread{1.15}\selectfont
  \ignorespaces#2\par%
  }%
}
\newcommand{\mycpar}[2][\mathparwidth]{%
  \parbox[c]{#1}{\centering%
  % \linespread{1.15}\selectfont
  \ignorespaces#2\par%
  }%
}

\newcommand{\parcomment}[2]{\hspace{\dimexpr \algorithmicindent * #1}$\triangleright$ #2}

% \newcommand{\rawparcomment}[2][\algparwidth]{%
  % \myparbox[#1]{#2}%
% }
% \newcommand{\parcomment}[2][\algparwidth]{%
  % \myparbox[#1]{$\triangleright$ #2}%
% }
% \newcommand{\parcomment}[1]{\hspace{\dimexpr \algorithmicindent - \labelwidth }$\triangleright$
  % \protect\parbox[t]{\dimexpr \textwidth - (\algorithmicindent - \labelwidth)}{#1}%
% }

% I want to use 'call' outside of pseudocode
\newcommand\call[2]{\textproc{#1}\ifthenelse{\equal{#2}{}}{}{(#2)}}%

\newcommand{\mname}[1]{\mbox{\sf #1}}
% [O]perator [A]pplication
\newcommand{\Oname}[1]{\mname{#1}}
% The \mathopen{} and \mathclose{} eliminate unwanted extra space
\newcommand{\OA}[2]{\ensuremath{%
    \mathop{\Oname{#1}}\mathopen{}\left(#2\right)\mathclose{}%
}}
\newcommand{\VOA}[2]{\OA{#1}{\V{#2}}}
% [F]unction [A]pplication, replaces \myfn
\newcommand{\smallrawfn}[2]{\ensuremath{\mathop{#1}(#2)}}
% The \mathopen{} and \mathclose{} eliminate unwanted extra space
\newcommand{\rawfn}[2]{\ensuremath{\mathop{#1}\mathopen{}\left(#2\right)\mathclose{}}}
\newcommand{\Fname}[1]{\V{#1}}
\newcommand{\FA}[2]{\ensuremath{\rawfn{\mathop{\Fname{#1}}}{#2}}}
\newcommand{\VFA}[2]{\FA{#1}{\V{#2}}}

\newcommand{\cuz}{\ensuremath{\mathrel{\because}}\xspace}
\newcommand{\bcuz}{\linebreak[1]\cuz}

% * Reference meta tags ("classifying prefixes") use in this document:
% * From fancyref:
% Chapter chap:
% Section sec:
% Equation eq:
% Figure fig:
% Table tab:
% Enumeration enum:
% Footnote fn:
%
% * Not in fancyref
% Definition df:
% Epigraph epi:
% Theorem th:
% Lemma lm:
% Remark rm:
% Observation obs:
% Example ex:
% Page page:

% The "page:" metatag is for labels intended as the target of
% page references.

% The auto-placement of qed's fails a lot.
% Semi-manual replacement using \qedhere often fails as well.
% I went with % 100% manual placement,
% which in fact is not any more trouble,
% and which is the only way to guarantee the QED's wind up where I
% want them.

% Try to gather all the stuff to do with theoremoids here
% Start off with theorems, then the other theoremoids,
% mostly alphabetically.

\renewcommand{\qedsymbol}{}
\newcommand{\myqed}{%
  \ifmmode\square
  \else$\square$
  \fi%
}

\newcommand{\colonpageref}[1]{%
 \ifthenelse{\equal{\pageref{#1}}{\thepage}}%
  {}{{:}\pageref*{#1}}%
}

% genref -- generic reference
\newcommand{\genref}[3][]{%
    \ifthenelse{\equal{#1}{}}{}{%
      \ifmmode \text{``#1''}%
      \else``#1'' %
      \fi%
    }%
    (\ensuremath{% To cover both cases, force math mode
        \hyperref[#2]{%
            \textrm{#3}\ref*{#2}\colonpageref{#2}%
        }%
    })%
}

\newcommand{\Sref}[2][]{\genref[#1]{sec:#2}{S}}

\theoremstyle{definition}

% theoremoids: Th

\newtheorem{theorem}{Theorem}
\newcommand{\Thref}[2][]{%
    \genref[#1]{th:#2}{Th}%
}
% some day delete \longThref
\newcommand{\longThref}[2]{%
  \ifmmode \text{``#1''\Thref{#2}}%
  \else``#1'' \Thref{#2}%
  \fi%
}
% "full" ref -- always includes page
\newcommand{\ThFref}[1]{(\textrm{Th}\ref{#1}:\pageref{#1})}
\newcommand{\thEnd}{\Circle}

% theoremoids: Df

\newtheorem{definition}[theorem]{Definition}
\newcommand{\Dfref}[2][]{%
    \genref[#1]{df:#2}{Df}%
}
\newcommand{\dfEnd}{\Circle}

% theoremoids: Eq

\newcommand{\Algref}[1]{\genref{alg:#1}{Alg}}
\newcommand{\Eqref}[1]{\genref{eq:#1}{Eq}}

% theoremoids: Ex

\newtheorem{example}[theorem]{Example}
\newcommand{\Exref}[1]{\genref{ex:#1}{Ex}}
\newcommand{\exEnd}{\Circle}

% theoremoids: Ob

\newtheorem{observation}[theorem]{Observation}
\newcommand{\Obref}[1]{\genref{obs:#1}{Ob}}
\newcommand{\obEnd}{\Circle}

% theoremoids: Rm

\newtheorem{remark}[theorem]{Remark}
\newcommand{\Rmref}[2][]{\genref[#1]{rm:#2}{Rm}}
\newcommand{\rmEnd}{\Circle}

% local theoremoids: Lm

\newtheorem{lemma}[theorem]{Lemma}
\newcommand{\Lmref}[2][]{\genref[#1]{lm:#2}{Lm}}
% some day delete \longLmref
\newcommand{\longLmref}[2]{%
  \ifmmode \text{``#1''\Lmref{#2}}%
  \else``#1'' \Lmref{#2}%
  \fi%
}
\newcommand{\lmEnd}{\thEnd}

\newcommand{\naturals}{\ensuremath{\mathbb{N}}\xspace}
\newcommand{\countables}{\ensuremath{\mathbb{CNT}}\xspace}
\newcommand{\integers}{\ensuremath{\mathbb{Z}}\xspace}

\hyphenation{oper-and oper-ands}
\hyphenation{look-ahead}
\hyphenation{memo-ization}

% I like to silence underfull hbox messages.
% This is syntactic sugar for doing that.
\newenvironment{MYsloppy}[1][3em]{\par\tolerance9999 \emergencystretch#1\relax}{\par}
% This form allows the resetting of hbadness, which may be necessary to
% shut up an "underfull" warning.
\newenvironment{MYsloppyB}[2]{\par\tolerance9999 \emergencystretch#1 \hbadness#2\relax}{\par}
% This form is for a trick:  Tolerances are evaluated line by line, so a tolerance
% less than 9999 may produce a better looking paragraph and reduce the "badness".
\newenvironment{MYsloppyC}[3]{\par\tolerance#3 \emergencystretch#1 \hbadness#2\relax}{\par}

\title
  [llguidance proof]
  {Completeness proof for llguidance Earley variant}

\author{Jeffrey Kegler}
\ifdraft{ \thanks{DRAFT as of \DTMnow} }{}
\date{\DTMnow.}

\newcommand{\llguidance}{{\tt llguidance}\xspace}
\newcommand{\llE}{{\llguidance Earley}\xspace}
\newcommand{\pref}[1]{\ref{#1} on page~\pageref{#1}\xspace}

\begin{document}

\maketitle
\tableofcontents

\section{About this document}
\label{sec:about-me}

This document contains a proof of completeness for the variant of
Earley's algorithm in \llguidance.
It assumes some familiarity with the code in
\llguidance\cite{llguidance},
and with the traditional proof of correctness
for Earley's algorithm.\footnote{%
    As found, for example,
    in~\cite[pp. 323-325]{AH1972v1}.
    }

\section{Conventions}
\noindent $\bullet$
``AF'' and its capitalization variants abbreviates
``assumption for''.
For example ``AF theorem'' abbreviates
``assumption for the theorem''.
\par
\noindent $\bullet$
``Iff'' and its capitalization variants abbreviates
``if and only if''.
\par
\noindent $\bullet$
``Wlog'' and its capitalization variants abbreviates
``without log of generality''.
\par
\noindent $\bullet$
``Wrt'' and its capitalization variants abbreviates
    ``with respect to''.
    \par
\noindent $\bullet$
Ranges are inclusive start,
    exclusive end, so that, for example,
        \begin{gather*}
            \element{(\texttt{"abcd"})}{0,2} = \texttt{"ab"} \text{, and} \\
            \element{(\texttt{"abcd"})}{2,3} = \texttt{"c"}.
        \end{gather*}
\par
\noindent $\bullet$ \TRUE is a boolean (or optional boolean) true; and
        \FALSE is a boolean (or optional boolean) false.

\section{Definitions}

\begin{definition}[The input \V{w}]
        In  this paper, \V{w} is a string of symbols.
        The ``symbols'' are, for our purposes, an unordered
        set of opaque objects.
        We call the string \V{w}, the \textbf{input}.
        \dfEnd
\end{definition}

\begin{definition}[Grammar]
\label{df:grammar}
A grammar is a 4-tuple
\[
        \tuple{\V{N},\V{T},\V{P},\V{S}},
\]
where \V{N} (the non-terminals)
and \V{T} (the terminals) are disjoint sets of symbols.
$\V{S} \in \V{N}$ is
the start symbol.
\V{P} is the set of rules, or productions.
The rules are of the form
$\V{A} \de \V{rhs}$,
where $\V{A} \in \V{N}$
and
$\V{rhs} \in (\V{N}\cup\V{T})^\ast$.
\dfEnd
\end{definition}

\begin{definition}[The grammar \V{g}]
\label{df:g}
When we say that \V{g} is \textbf{proper} we mean that it has
no unreachable symbols, no unproductive symbol,
and no cycles.
Every grammar in this document is the proper grammar
\[
        \V{g} = \tuple{\V{N},\V{T},\V{P},\V{S}}. \qquad \dfEnd
\]
\end{definition}

\begin{definition}[Earley item]
We will write an Earley item as
\[
        \tuple{\V{A} \de \alpha \mydot \beta, \V{origin}, \V{current}}
\]
where $\alpha$ and $\beta$ are sentential forms,
\[
        \alpha \in (\V{N} \cup \V{T}^\ast) \land \beta \in (\V{N} \cup \V{T})^\ast,
\]
and $\V{A} \de \alpha \cat \beta$ is a rule in the grammar \V{g},
\[
        (\V{A} \de \alpha \cat \beta) \in \V{P}.
\]
A large raised dot ($\mydot$) indicates the dot location in the rule.
\V{origin} is the origin location of the item in the input, and
\V{current} is the location of the dot in the input,
or dot location.
\dfEnd
\end{definition}

\begin{definition}[Predot symbol]
In an Earley item
\[
        \tuple{\V{A} \de \alpha \mydot \beta, \V{origin}, \V{current}},
\]
we call the last symbol in $\alpha$, \element{\alpha}{\lastix{\alpha}},
the predot symbol.
When $\size{\alpha} = 0$, there is no predot symbol. \dfEnd
\end{definition}

\begin{definition}[Types of Earley items]
        \label{df:ei-types}
We say that
\begin{itemize}
\item an Earley item is a \textbf{start item}
        if its LHS is the start symbol and
        it has no predot symbol;
\item an Earley item is \textbf{predicted}, or a \textbf{prediction}
        if its LHS is not the start symbol and
        it has no predot symbol;
\item an Earley item is \textbf{confirmed}, or a \textbf{confirmation},
        if it has a predot symbol;
\item an Earley item is \textbf{scanned}, or a \textbf{scansion},
        if its predot symbol is a terminal,
         $\element{\alpha}{\lastix{\alpha}} \in \V{T}$;
\item an Earley item is \textbf{reduced}, or a \textbf{reduction},
        if its predot symbol is a non-terminal;
        $\element{\alpha}{\lastix{\alpha}} \in \V{N}$; \qquad \dfEnd
\end{itemize}
\end{definition}

\begin{definition}[Strings]
\label{df:string}
        A \textbf{string} is a sequence whose members are
        elements of the set $(\V{N}\cup\V{T})$.
        In this document, we will use the symbol \V{STR} for set of finite
        strings,
        and $\V{STR}^+$ for set of non-empty finite strings:
        \[ \V{STR}^+ = \V{STR} \subtract \epsilon. \]
        A \textbf{terminal string} is a sequence whose members are
        elements of the set \V{T}.
        In this document, we will use the symbol \V{TSTR} for set of finite
        terminal strings,
        and $\V{TSTR}^+$ for set of non-empty finite terminal strings:
        \[ \V{TSTR}^+ = \V{TSTR} \subtract \epsilon.  \dfEnd \]
\end{definition}

\begin{definition}[SF transition]
        \label{df:transition}
        An \textbf{SF transition}
        is a duple of two sentential forms,
        such that a non-terminal member in the first element of the pair
        is expanded, according to a rule of \V{g}, in the second element of the pair.
        More precisely, let $\V{tr} = (\V{Lstr}, \V{Rstr})$ be an SF transition.
        Then, without loss of generality,
        \begin{equation}
                \V{Lstr} = \alpha \cat \V{A} \cat \beta \\
                \land \; \V{Rstr} = \alpha \cat \V{rhsA} \cat \beta \\
                \land \; \V{A} \de \V{rhsA} \in \V{P}
        \end{equation}
        where $\alpha$ and $\beta$ are strings.
        Overloading terminology a bit,
        \V{Lstr} is called the \textbf{LHS} string of \V{tr},
        and \V{Rstr} is called the \textbf{RHS} string of \V{tr}.
        \dfEnd
\end{definition}

\begin{definition}[Trivial derivation]
        In \Dfref{transition} the symbols in
        $\alpha$ and $\beta$ are simply copied --- they can
        be said to be derived from themselves.
        We say that the
        $\alpha$ and $\beta$ in \V{Rstr}
        are \textbf{trivially derived} from
        $\alpha$ and $\beta$ in \V{Lstr}.
        We also that that
        the substrings of $\alpha$ and $\beta$ in \V{Lstr}
        are \textbf{trivially derived} from
        the corresponding substrings of $\alpha$ and $\beta$ in \V{Lstr};
        and that
        the symbol instances of $\alpha$ and $\beta$ in \V{Lstr}
        are \textbf{trivially derived} from
        the corresponding symbol instances in $\alpha$ and $\beta$ in \V{Lstr};
\dfEnd
\end{definition}

\begin{definition}[Derivation]
        A derivation, call it \V{drv}, is a sequence of strings
        such that every consecutive pair of the sequence is a string transition.
        The individual members of a derivation are strings,
        and in the context of the derivation are called \V{steps}.
        \dfEnd
\end{definition}

\begin{definition}[Symbol instance]
        A symbol may occur many times in a derivation.
        Each occurrence can be identified by the index of the step (\V{stepIX}),
        within the derivation (\V{drv}),
        and the index (\V{pos}) of the symbol occurrence within the string,
        so that the triple $(\V{stepIX}, \V{pos}, \V{drv})$ represents
        a symbol instance.
        More practically, we will tag symbols with an instance identifier,
        separated from the symbol name by a colon, for example,
        \begin{equation}
                \label{eq:df-instance-010}
                \V{A:f,0}.
        \end{equation}
        The instance tag consists of a major and minor identifier,
        separated by a comma.
        For example in \eqref{eq:df-instance-010},
        ``\texttt{A}'' is the symbol name,
        ``\texttt{f,0}'' is the instance tag,
        ``\texttt{f}'' is the major identifier, and
        ``\texttt{0}'' is the minor identifier.

        The major identifier of the tag is inherited by its trivial productions.
        The minor identifier of the tag is used to distinguish symbol instances
        with the same major identifier.

        The minor identifier is rarely necessary and is almost always omitted.
        For example, \eqref{eq:df-instance-010}
        would almost always be written \V{A:f}.

        Instance tags are also used after strings,
        to indicate that every symbol instance in the string instance has that
        instance tag.
        For example, if
        \[
        \V{predot} = \V{A}\cat\V{B}\cat\V{C},
        \]
        then
        \[
        \V{predot:f} = \V{A:f}\cat\V{B:f}\cat\V{C:f}.
        \]
        \dfEnd
\end{definition}

\begin{definition}[Sentences and Sentential forms]
        If the first step of a derivation is $\V{S}$,
        the string consisting only of the start symbol,
every step in the derivation is a \textbf{sentential form}.
If a sentential form consists entirely of terminals,
it is a \textbf{sentence}.
\dfEnd
\end{definition}

\begin{definition}[Earley item to focus correspondence]
        \todo{Revise for aletheme}
        \label{df:earley-item-to-focus}
The Earley item
\[
        \tuple{\V{A} \de \V{predot} \mydot \V{postdot}, \V{origin}, \V{current}}
\]
\textbf{corresponds} to the focus
\[
        (\V{predot},\V{postdot},\V{A:f},\V{origin},\V{current})
\]
and vice versa.
We note that, while the focus specifies the focus symbol instance \V{A:f},
the Earley item only specifies the LHS symbol \V{A}.
Thus focus to Earley item correspondence is a many-to-one relationship.
\dfEnd
\end{definition}

\begin{definition}[Earley item concepts and focuses]
\label{df:ei-focus-concept}
        \todo{Revise for aletheme}
        An Earley item concept applied to a focus
        applies to the Earley item of the focus.
        For example, a focused derivation
        is a reduction if its Earley item is a reduction.
        \qquad \dfEnd
\end{definition}

\begin{definition}[Tangible symbol]
        In the context of a derivation,
        a \textbf{tangible} symbol instance is one that produces
        at least one terminal,
        and an \textbf{intangible} symbol instance in one that is
        not tangible.
        \dfEnd
\end{definition}

\begin{definition}[Tangible reduction FD]
        \label{df:rt}
        A \textbf{tangible reduction FD}
        is a focused derivation,
        where the focus is a reduction,
        and the predot symbol instance in the derivation
        is tangible.
        A \textbf{intangible reduction FD}
        is a focused derivation,
        where the focus is a reduction,
        and the predot symbol instance in the derivation
        is intangible.
        \dfEnd
\end{definition}

\begin{definition}[Soundness]
A set of Earley items is \textbf{sound} for an input \V{w} iff
the corresponding focus of every Earley item
matches a derivation with input \V{w}.
\qquad \dfEnd
\end{definition}

\begin{definition}[Completeness]
\label{df:completeness}
An Earley chart is \textbf{complete} for an input \V{w} with
respect to a set of alethemes iff
for every aletheme in that set, call that aletheme \V{al},
either \V{al} is a nulling completion,
or an Earley entry corresponding to \V{al} is in \V{ch}.  \dfEnd
\end{definition}

We note that our definition of \Dfref{completeness},
carves nulling completions out of the definition.
This differs from
the usual definition of completeness in Earley parsing,

\begin{definition}[Fundamental invariant]
\label{df:invariant}
The \textbf{fundamental invariant}\footnote{
This fundamental invariant is similar to the traditional
one, as found in~\cite[Theorem 4.9, p. 323]{AH1972v1}
}
requires the set of Earley items in a Earley stack
to be both sound and complete.
\dfEnd
\end{definition}

\begin{definition}[Focus concepts and focused derivations]
        \label{df:focus-fd-concept}
        An focus concept applies to a focused derivation
        if it applies to the focus of the focused derivation.
        For example, the Earley item of a focused derivation
        is the Earley item of its focus.
        \dfEnd
\end{definition}

\begin{definition}[Reduction tributary]
        \todo{To be deleted}
Let
\begin{equation}
        \V{down} = (\V{A} \de \V{antepredotA} \cat \V{B} \mydot \V{postdotA},\V{joint},\V{current}),
\end{equation}
be an Earley item.
We say that an Earley item of the form
\begin{equation}
\begin{gathered}
        \V{trib} = (\V{B} \de \V{rhs} \mydot,\V{joint},\V{current}), \\
        \text{where $\V{B} \de \V{rhs} \in \V{P}.$}
\end{gathered}
\end{equation}
is a \textbf{tributary} of \V{down}.
We also say that
\V{down} is the \textbf{downstream channel}
(or simply \textbf{downstream})
of \V{tributary}.
\dfEnd
\end{definition}

\begin{definition}[Tangible reduction tributary]
\label{df:tr-trib}
        Let \V{tribFD} be a tributary FD
        of the tangible reduction FD \V{downFD},
        where \V{tribFD} and \V{downFD} share a derivation \V{drv}.
        Let \V{B:pd} be the predot instance of \V{downFD},
        and let
\begin{gather*}
        \V{B} \de \V{rhs} \in \V{P}, \\
        \land \; \V{B} \deplusV{drv} \Velement{w}{\V{joint},\V{current}}, \\
        \land \; \V{joint} < \V{current}.
\end{gather*}
We say that
\V{tribFD} is a \textbf{tangible reduction tributary} of \V{downFD} at \V{joint}.
We also say that
\V{downFD} is the \textbf{tangible reduction downstream channel}
(or simply \textbf{downstream})
of \V{tribFB}.
\dfEnd
\end{definition}

\begin{definition}[Prediction mainstem]
\label{df:prediction-stem}
        Suppose, without loss of generality, that
\begin{equation}
        \V{down} = \FA{DI}{\epsilon,\V{rhsA},\V{A},\V{current},\V{current}} \\
\end{equation}
is an prediction DI.
Then we say that
any DI of the form
\begin{equation*}
        \V{mainstem} =
        \FA{DI}{
        \begin{gathered}
        \; \V{predotB}, \; \V{A} \cat\V{afterPostdotB}, \; \\
                \V{B},\; \V{originB},\; \V{current}
        \end{gathered}
}
\end{equation*}
        is a \textbf{mainstem} of
        \V{down}.
We also say that \V{down} is the \textbf{downstream channel}
(or simply \textbf{downstream})
of \V{mainstem}.
\dfEnd
\end{definition}

\section{Definitions 2}

\begin{definition}[Altheme]
        \label{df:aletheme}
        An \textbf{Earley aletheme}, or \textbf{aletheme},
        is an 8-tuple
        \begin{equation}
        \begin{gathered}
                (\V{fore},\V{aft},\V{pre},\V{post},\V{lhs},\V{origin},\V{current}) \\
                \text{where $\V{fore},\V{aft},\V{pre},\V{post} \in \V{STR}$} \\
                \land \; \V{lhs} \in \V{N} \\
                \land \; \V{origin},\V{current} \in \naturals.
        \end{gathered}
        \end{equation}
        An aletheme is considered true if and only if
        \begin{gather}
                \V{A} \de \V{pre} \cat \V{post} \in \V{P} \\
                \land \; \V{pre} \destar \Velement{w}{\V{origin},\V{current}} \\
                \land \; \V{S} \destar \V{fore} \cat \V{lhs} \cat \V{aft} \\
                \land \; \V{fore} \destar \Velement{w}{0,\V{origin}}. \quad \dfEnd
        \end{gather}
\end{definition}

An aletheme is so called because it is the smallest unit of soundness
in an Earley parsing context.  It comes from \textit{\kern-2pt alethes},
the Greek word
for ``truth''.

\begin{definition}[Rank]
        \label{df:rank}
        Let
        \[ \V{x} = (\V{fore},\V{aft},\V{pre},\V{post},\V{lhs},\V{origin},\V{current}) \]
        be an aletheme.
        The \textbf{depth} of \V{x}, \VFA{Dp}{x}, is the length of the shortest derivation such
        that
        \[ \V{S} \destarV{g} \V{fore} \cat \V{lhs} \cat \V{aft}. \]
        The \textbf{height} of \V{x}, \VFA{Ht}{x}, is the length of the shortest derivation such
        that
        \[ \V{fore} \cat \V{pre} \destarV{g} \Velement{w}{0,\V{current}}. \]
        The \textbf{rank} of \V{x} is
        \[ \VFA{Rank}{x} = \VFA{Dp}{x} + 2 \mult \VFA{Ht}{x}. \quad \dfEnd \]
\end{definition}

\begin{definition}[Confirmation mainstem]
        \label{df:conf-stem}
        Suppose, without loss of generality, that
        \[ \V{down} = (\V{fore},\V{aft},(\V{antepre}\cat\V{B}),\V{post},\V{lhs},\V{origin},\V{current}) \]
        is an confirmed aletheme.
Then we say that
an aletheme of the form
\[
        \V{stem} = (\V{fore},\V{aft},\V{antepre},(\V{B} \cat \V{post}),\V{lhs},\V{origin},\V{j})
\]
is a \textbf{mainstem} of
\V{down} at the \textbf{joint location} \V{j}.
We also say that \V{down} is the \textbf{downstream channel}
(or simply \textbf{downstream})
of \V{mainstem}.
\dfEnd
\end{definition}

\begin{definition}[Reduction tributary]
\label{df:red-trib}
        Suppose, without loss of generality, that
        \[ \V{down} = (\V{fore},\V{aft},(\V{antepre}\cat\V{B}),\V{post},\V{lhs},\V{origin},\V{current}) \]
        is an confirmed aletheme.
        Where $\V{B} \de \V{rhs} \in \V{P}$,
then we say that
an aletheme of the form
        \[ \V{trib} = ((\V{fore}\cat\V{antepre}),\V{aft},\V{rhs},\epsilon,\V{B},\V{j},\V{current}) \]
is a \textbf{tributary} of
\V{down} at the \textbf{joint location} \V{j}.
We also say that \V{down} is the \textbf{downstream channel}
(or simply \textbf{downstream})
of \V{trib}.
\dfEnd
\end{definition}

The term ``joint location'' is based on the idea that the joint location
is the place where the mainstem and tributary ``join'' to form the downstream.

\needspace{3in}
\section{Algorithm}
\label{sec:algorithm}
\FloatBarrier

\begin{algorithm}[ht]
\caption{Do Earley Parse}
\label{alg:earley}
\begin{algorithmic}[1]
        \Procedure{DoEarleyParse}{}
        \State \Call {AddRow0}{}
        \For{$\V{i} \gets 1, \Vsize{\V{w}}$}
                \State \Call {AddRow}{\V{i}}
        \EndFor
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
\caption{Add Row 0}
\label{alg:add-row-0}
\begin{algorithmic}[1]
        \Procedure{AddRow0}{}
        \State \Call {AddStartStates}{}
        \State \Call {FinishRow}{0}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Add Row \V{n}}
\label{alg:add-row-n}
\begin{algorithmic}[1]
        \Procedure{AddRow}{\V{n}}
        \State \Call {AddScansions}{\V{n}}
        \State \Call {FinishRow}{\V{n}}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\FloatBarrier

\begin{algorithm}[ht]
        \caption{Finish Row \V{n}}
\label{alg:finish-row}
\begin{algorithmic}[1]
        \Procedure{FinishRow}{\V{n}}
        \label{li:finish-row-010}
        \State $\V{i} \gets 0$ \Comment{Initialize \V{i}}
        \label{li:finish-row-020}
        \While {$\V{i} < \Vsize{row}$} \Comment {Earley entry activation loop}
        \LComment{The activation loop activates the entries in \V{row}, from index 0 to \Vsize{row}.
        New entries are added to \V{row} during the loop
                so that \Vsize{row} increases during the running of the loop.}
        \label{li:finish-row-030}
        \State $\V{current} \gets \Velement{row}{\V{i}}$
                \Comment {\VVelement{row}{i} is \V{i}'th Earley item in row}
        \label{li:finish-row-040}
        \If {\V{current} is complete}
        \label{li:finish-row-050}
             \State $\V{origin} \gets$ origin of \V{current}
        \label{li:finish-row-060}
             \If {$\V{origin} < \V{n}$}
        \label{li:finish-row-070}
                  \State \Call{AddTangibleReductions}{\V{current}}
        \label{li:finish-row-080}
             \EndIf
        \label{li:finish-row-090}
        \Else \Comment {... else if \V{current} is an incompletion}
        \label{li:finish-row-100}
             \State $\V{postdot} \gets$ postdot symbol of \V{current}
        \label{li:finish-row-110}
             \If {\V{postdot} is nullable}
        \label{li:finish-row-120}
                  \State \Call{AddIntangibleReduction}{\V{current}}
        \label{li:finish-row-130}
             \EndIf
        \label{li:finish-row-140}
             \State \Call{AddPredictions}{\V{postdot},\V{n}}
        \label{li:finish-row-150}
        \EndIf
        \label{li:finish-row-160}
        \State $\V{i} \gets \V{i} + 1$
        \label{li:finish-row-170}
        \EndWhile
        \label{li:finish-row-180}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{definition}[Earley entry recording]
        An Earley entry is \textbf{recorded} when it is added to the
        Earley chart.
        An \textbf{Earley entry recording event} is the series of
        code step during which the Earley entry is recorded.
\dfEnd
\end{definition}

\begin{definition}[Earley entry activation]
        An Earley entry is \textbf{activated} when it is examined
        and used for recording other Earley entries.
        An \textbf{Earley entry activation event} is the series of
        code steps during which it is begin examined and used
        for the purpose of recording other Earley entries.
\dfEnd
\end{definition}

Based on the pseudocode, we make a series of useful
observations.

\begin{observation}[No Earley entry is recorded twice]
        There are no duplicate Earley entries.
        That is, an Earley entry is recorded at most one.
        This is enforced at
        line \ref{li:record-edge-100} of \Algref{record-edge}.
        \obEnd
\end{observation}

\begin{observation}[An Earley entry is activated once]
        \label{obs:activation-unique}
        A recorded Earley entry is activated exactly once.
        Relevant to this observation is the activation loop in \Algref{finish-row}.
        \obEnd
\end{observation}

\begin{observation}[Recording and activation of an event do not overlap]
        While the activation loop \Algref{finish-row} records entries
        during activation events,
        these are always entries other than the activated entry.
        No steps in the activation of an event \V{ev} overlaps
        steps in the the recording of \V{ev},
        and vice versa.
        \obEnd
\end{observation}

\begin{observation}[Entry activation is after recording]
        \label{obs:activation-after-recording}
        Before any Earley entry is activated,
        it must first be recorded.
        \obEnd
\end{observation}

\begin{observation}[Edges are recorded row by row]
        \label{obs:recording-row-by-row}
        Edges are recorded one row at a time.
        More precisely, no edge in row \V{i}
        will
        ever be recorded after any edge in row $\V{i}+1$
        is recorded.
        \obEnd
\end{observation}

\begin{observation}[Edges are recorded row by row]
        \label{obs:recording-at-currloc}
        An edge is recorded in the activation loop for
        its current location.
        \obEnd
\end{observation}

\begin{observation}[Edges are activated row by row]
        \label{obs:activation-row-by-row}
        Edges are activated one row at a time.
        More precisely, no edge in row \V{i}
        will
        ever be activated after any edge in row $\V{i}+1$
        is recorded.
        \obEnd
\end{observation}

\begin{observation}[Edge activation at current location]
        \label{obs:activation-at-currloc}
        An edge is activated in the activation loop for
        its current location.
        \obEnd
\end{observation}

\begin{observation}[Activation is after recording of previous rows]
        \label{obs:activation-after-previous-row}
        Before any Earley entry is activated,
        all Earley entries that will ever be recorded in previous rows
        must already have been recorded.
        One way this can be seen is from
        \Obref{activation-after-recording},
        \Obref{recording-row-by-row},
        and \Obref{activation-row-by-row}.
        \obEnd
\end{observation}

\FloatBarrier

\begin{algorithm}[ht]
        \caption{Add Tangible Reductions}
\label{alg:tangible-reduction}
\begin{algorithmic}[1]
        \Procedure{AddTangibleReductions}{\V{tributary}}
        \label{li:tangible-reduction-010}
        \State $\V{tribOrigin} \gets \text{origin of \V{tributary}}$
        \label{li:tangible-reduction-020}
        \State $\V{tribCurrent} \gets \text{current location of \V{tributary}}$
        \label{li:tangible-reduction-030}
        \State $\V{tribLHS} \gets \text{LHS of \V{tributary}`s rule}$
        \label{li:tangible-reduction-040}
        \LComment{Find the row where \V{tributary} starts}
        \State $\V{originRow} \gets \VVelement{rows}{tribOrigin}$
        \label{li:tangible-reduction-050}
        \label{li:tangible-reduction-060}
        \LComment{Set \V{mainstems} to the set of Earley items in \V{originRow} whose postdot
                item is \V{tribLHS}.}
        \State $\V{mainstems} \gets$
        \label{li:tangible-reduction-070}
        \Statex $\qquad \qquad \lbrace \V{item} \in \V{originRow} \mid \VFA{Postdot}{item} =  \V{tribLHS} \rbrace$
        \label{li:tangible-reduction-080}
     \For {$\V{mainstem} \in \V{mainstems}$}
        \label{li:tangible-reduction-100}
          \State $\V{dotted} \gets \text{dotted rule of \V{mainstem}}$
          \label{li:tangible-reduction-110}
          \State $\V{newDotted} \gets \Call{AdvanceDot}{\V{dotted}}$
          \label{li:tangible-reduction-120}
          \State $\V{newOrigin} \gets \text{origin of \V{mainstem}}$
          \label{li:tangible-reduction-130}
          \State \Call{RecordEdge}{\V{newDotted}, \V{newOrigin}, \V{tribCurrent}}
     \EndFor
        \label{li:tangible-reduction-170}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Advance Dot}
\label{alg:advance-dot}
\begin{algorithmic}[1]
        \Function{AdvanceDot}{\V{dottedRule}}
        \State \textbf{let} \V{dottedRule} \text{be} $(\V{A} \de \alpha \mydot \V{B} \cat \beta)$
        \State $\qquad \qquad \textbf{where } \alpha, \beta \in (\V{N}\cup\V{T})^\ast \text{ and }  \V{B} \in (\V{N}\cup\V{T})$
        \State \textbf{return} $(\V{A} \de \alpha \cat \V{B} \mydot \beta)$
\EndFunction
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Record Edge}
\label{alg:record-edge}
\begin{algorithmic}[1]
        \Function{RecordEdge}{\V{edge}}
        \State \textbf{let} \V{edge} \text{be} $(\V{dottedRule}, \V{origin}, \V{current})$
        \If {\V{edge} is already in the Earley chart}
        \State \textbf{return} \Comment{Do not add duplicate items}
        \label{li:record-edge-100}
        \EndIf
        \If {\V{dottedRule} is completion and $\V{origin} = \V{current}$}
        \State \textbf{return} \Comment{Do not add nulling completion}
        \EndIf
        \State Add \V{edge} to the Earley chart
\EndFunction
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Add Intangible Reduction}
\label{alg:intangible-reduction}
\begin{algorithmic}[1]
        \Procedure{AddIntangibleReduction}{\V{mainstem}}
        \State \textbf{let} \V{mainstem} \text{be} $(\V{dottedRule}, \V{origin}, \V{current})$
        \State $\V{newDotted} \gets \Call{AdvanceDot}{\V{dotted}}$
        \State \Call{RecordEdge}{\V{newDotted}, \V{origin}, \V{current}}
        \label{li:intangible-reduction-record-edge}
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}[ht]
        \caption{Add Predictions}
\label{alg:predictions}
\begin{algorithmic}[1]
        \Procedure{AddPredictions}{\V{sym},\V{currLoc}}
        \LComment{for every \V{rule} in grammar with LHS equal to \V{sym}}
        \For {every \V{rule} such that $\V{sym} \de \alpha$ and $\alpha \in (\V{N}\cup\V{T})^\ast$}
                \State \Call{RecordEdge}{$(\V{sym} \de \mydot \alpha), \V{currLoc}, \V{currLoc}$}
        \EndFor
\EndProcedure
\end{algorithmic}
\end{algorithm}

\FloatBarrier

\section{Inflow lemmas}

\begin{lemma}[Confirmation mainstem]
\todo{Define predot symbol instance}
        \label{lm:conf-stem}
        Let \V{downAL} be a confirmed aletheme,
        whose predot symbol is \V{B},
        whose current location is \V{current},
        and where \V{j} is such that
        \[
                0 \le \V{j} \le \V{current} \land
                \V{B} \destar \Velement{w}{\V{j},\V{current}}.
        \]
        Then \V{downAL} has a mainstem \V{stemAL}
        at joint location \V{j},
        the current location of \V{stemAL} is \V{j},
        and
        \[
                \VFA{Rank}{stemAL} < \VFA{Rank}{downAL}. \quad \lmEnd
        \]
\end{lemma}

\begin{proof}
Our proof strategy is to assume a confirmed aletheme,
as described in
the statement of the lemma, and otherwise arbitrary,
and then to show
that we have a mainstem as described in
the statement of the lemma.

We assumed for the lemma the following confirmed aletheme:
\begin{equation}
\label{eq:pr-conf-stem-010}
        \begin{gathered}
        \V{downAL} =
                \left( \begin{gathered}
                        \V{fore},\V{aft},(\V{antepre}\cat\V{B}),\V{post},\V{A}, \\
                        \V{origin},\V{current}
                \end{gathered} \right) \\
                \text{\cuz AF lemma, WLOG.}
        \end{gathered}
\end{equation}
We also assumed for the lemma that
\begin{equation}
\label{eq:pr-conf-stem-020}
        \begin{gathered}
                0 \le \V{j} \le \V{current} \\
                \land \; \V{B} \destar \Velement{w}{\V{j},\V{current}} \\
                \text{\cuz AF lemma, WLOG.}
        \end{gathered}
\end{equation}
From \V{downAL} we can conclude
\begin{gather}
\label{eq:pr-conf-stem-030}
        \mycpar{$\V{A} \de \V{antepre}\cat\V{B} \cat \V{post} \in \V{P}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-conf-stem-010}.} \\
\label{eq:pr-conf-stem-040}
        \mycpar{$\V{antepre}\cat\V{B} \destar \Velement{w}{\V{origin},\V{current}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-conf-stem-010}.} \\
\label{eq:pr-conf-stem-050}
        \mycpar{$\V{S} \destar \V{fore} \cat \V{A} \cat \V{aft}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-conf-stem-010}.} \\
\label{eq:pr-conf-stem-060}
        \mycpar{$\V{fore} \destar \Velement{w}{0,\V{origin}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-conf-stem-010}.}
\end{gather}
We can deduce one useful new derivation:
\begin{gather}
\label{eq:pr-conf-stem-070}
        \mycpar{$\V{antepre} \destar \Velement{w}{\V{origin},\V{j}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-conf-stem-020}.}
\end{gather}
With the foregoing, we have our mainstem aletheme:
\begin{equation}
\label{eq:pr-conf-stem-080}
        \begin{gathered}
        \V{stemAL} =
                \left( \begin{gathered}
                        \V{fore},\V{aft},\V{antepre},(\V{B}\cat\V{post}),\V{A}, \\
                        \V{origin},\V{j}
                \end{gathered} \right) \\
                \text{\cuz \Dfref{aletheme}, \Dfref{conf-stem},
                        \eqref{eq:pr-conf-stem-030}, \eqref{eq:pr-conf-stem-050},
                        \eqref{eq:pr-conf-stem-060}, \eqref{eq:pr-conf-stem-070}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-090}
        \mycpar{The current location of \V{stemAL} is \V{j} \cuz \eqref{eq:pr-conf-stem-080}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-100}
        \mycpar{The joint location of \V{stemAL} is \V{j} \cuz \Dfref{conf-stem}, \eqref{eq:pr-conf-stem-080}.}
\end{equation}
For the lemma, it remains to show the relationship between the rank of the mainstem
and its downstream.
\begin{equation}
\label{eq:pr-conf-stem-110}
        \mycpar{Let \V{n1} be the minimum number of steps in the derivation \\
        $\V{S} \destar \V{fore} \cat \V{A} \cat \V{aft}.$}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-120}
        \mycpar{\VFA{Dp}{downAL} = \V{n1} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-010}, \eqref{eq:pr-conf-stem-110}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-123}
        \mycpar{\VFA{Dp}{stemAL} = \V{n1} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-080}, \eqref{eq:pr-conf-stem-110}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-126}
        \mycpar{\VFA{Dp}{downAL} = \VFA{Dp}{stemAL} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-120}, \eqref{eq:pr-conf-stem-123}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-130}
        \mycpar{Let \V{n2} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \cat \V{B} \destar \Velement{w}{0,\V{current}}$ \\
        \cuz \eqref{eq:pr-conf-stem-040}, \eqref{eq:pr-conf-stem-060}.
        }
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-140}
        \mycpar{\VFA{Ht}{downAL} = \V{n2} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-010}, \eqref{eq:pr-conf-stem-130}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-150}
        \mycpar{Let \V{n3} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \destar \Velement{w}{0,\V{j}}$ \\
        \cuz \eqref{eq:pr-conf-stem-040}, \eqref{eq:pr-conf-stem-060}.}
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-160}
        \mycpar{\VFA{Ht}{stemAL} = \V{n3} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-conf-stem-080}, \eqref{eq:pr-conf-stem-150}.}
\end{equation}
Because the derivation from \V{B}, even if it is $\V{B} \derives \epsilon$,
must take at least one step, we know that
\begin{equation}
\label{eq:pr-conf-stem-170}
        \V{n3} < \V{n2} \cuz \eqref{eq:pr-conf-stem-130}, \eqref{eq:pr-conf-stem-150}.
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-180}
        \VFA{Ht}{stemAL} < \VFA{Ht}{downAL} \cuz \eqref{eq:pr-conf-stem-140},
                \eqref{eq:pr-conf-stem-160}, \eqref{eq:pr-conf-stem-170}.
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-190}
        \VFA{Rank}{downAL} = \VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-200}
        \VFA{Rank}{stemAL} = \VFA{Dp}{stemAL} + 2 \mult \VFA{Ht}{stemAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-conf-stem-210}
        \VFA{Rank}{stemAL} < \VFA{Rank}{downAL} \cuz \eqref{eq:pr-conf-stem-126},
                \eqref{eq:pr-conf-stem-180},
                \eqref{eq:pr-conf-stem-190},
                \eqref{eq:pr-conf-stem-200}.
\end{equation}
With \eqref{eq:pr-conf-stem-080}, \eqref{eq:pr-conf-stem-090}, \eqref{eq:pr-conf-stem-100},
and \eqref{eq:pr-conf-stem-210},
we have the lemma.
\myqed
\end{proof}

\begin{lemma}[Reduction tributary]
        \label{lm:red-trib}
        Let \V{downAL} be a reduced aletheme,
        whose predot symbol is \V{B},
        whose current location is \V{current},
        and where \V{j} is such that
        \[
                0 \le \V{j} \le \V{current} \land
                \V{B} \destar \Velement{w}{\V{j},\V{current}}.
        \]
        Then \V{downAL} has a tributary \V{tribAL}
        at joint location \V{j},
        the current location of \V{tribAL} is \V{j},
        and
        \[
                \VFA{Rank}{tribAL} < \VFA{Rank}{downAL}. \quad \lmEnd
        \]
\end{lemma}

\begin{proof}
Our proof strategy is to assume a reduced aletheme
that is arbitrary except
as described in
the statement of the lemma,
and then to show
that we have a tributary as described in
the statement of the lemma.

We assumed for the lemma the following reduced aletheme:
\begin{equation}
\label{eq:pr-red-trib-010}
        \begin{gathered}
        \V{downAL} =
                \left( \begin{gathered}
                        \V{fore},\V{aft},(\V{antepre}\cat\V{B}),\V{post},\V{A}, \\
                        \V{origin},\V{current}
                \end{gathered} \right) \\
                \text{\cuz AF lemma, WLOG.}
        \end{gathered}
\end{equation}
We also assumed for the lemma that
\begin{equation}
\label{eq:pr-red-trib-020}
        \begin{gathered}
                0 \le \V{j} \le \V{current} \\
                \land \; \V{B} \destar \Velement{w}{\V{j},\V{current}} \\
                \text{\cuz AF lemma, WLOG.}
        \end{gathered}
\end{equation}
From \V{downAL} we can conclude
\begin{gather}
\label{eq:pr-red-trib-030}
        \mycpar{$\V{A} \de \V{antepre}\cat\V{B} \cat \V{post} \in \V{P}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-010}.} \\
\label{eq:pr-red-trib-040}
        \mycpar{$\V{antepre}\cat\V{B} \destar \Velement{w}{\V{origin},\V{current}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-010}.} \\
\label{eq:pr-red-trib-050}
        \mycpar{$\V{S} \destar \V{fore} \cat \V{A} \cat \V{aft}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-010}.} \\
\label{eq:pr-red-trib-060}
        \mycpar{$\V{fore} \destar \Velement{w}{0,\V{origin}}$
              \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-010}.}
\end{gather}

Let the derivation \V{minDrv} be the shortest derivation of
\Velement{w}{\V{j},\V{current}} from \V{B}.
Because $\V{B} \in \V{N}$ we know that,
for some $\V{rhs} \in \V{STR}$,
\begin{gather}
\label{eq:pr-red-trib-070}
        \mycpar{$\V{B} \derivesV{minDrv} \V{rhs} \destarV{minDrv} \Velement{w}{\V{j},\V{current}}$
        \cuz \eqref{eq:pr-red-trib-020},
        } \\
\label{eq:pr-red-trib-075}
        \land \; \V{B} \de \V{rhs} \in \V{P} \cuz \eqref{eq:pr-red-trib-070}.
\end{gather}

We consider a new derivation:
\begin{equation}
\label{eq:pr-red-trib-080}
        \mycpar{$\V{S} \destar \V{fore} \cat \V{A} \cat \V{aft}$ \\
        $\derives \V{fore} \cat \V{antepre} \cat \V{B} \cat \V{post} \cat \V{aft}$ \\
        $\derives \V{fore} \cat \V{antepre} \cat \V{rhs} \cat \V{post} \cat \V{aft}$ \\
                \cuz \eqref{eq:pr-red-trib-030}, \eqref{eq:pr-red-trib-050}, \eqref{eq:pr-red-trib-070}.}
\end{equation}
which we simplify to
\begin{equation}
\label{eq:pr-red-trib-090}
        \mycpar{$\V{S} \derives \V{fore} \cat \V{antepre} \cat \V{B} \cat \V{post} \cat \V{aft}$ \\
                \cuz \eqref{eq:pr-red-trib-080}.}
\end{equation}

We deduce a few more facts that we will need:
\begin{equation}
\label{eq:pr-red-trib-150}
        \begin{gathered}
        \V{B} \derives \V{rhs} \destar \Velement{w}{\V{j},\V{current}}
              \cuz \eqref{eq:pr-red-trib-020}, \eqref{eq:pr-red-trib-040}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-155}
        \begin{gathered}
        \V{rhs} \destar \Velement{w}{\V{j},\V{current}}
              \cuz \eqref{eq:pr-red-trib-150}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-160}
        \begin{gathered}
                \V{antepre} \destar \Velement{w}{\V{origin},\V{j}} \\
                \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-020}, \eqref{eq:pr-red-trib-040}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-170}
        \begin{gathered}
                \V{fore} \cat \V{antepre} \destar \Velement{w}{0,\V{j}} \\
                \cuz \Dfref{aletheme}, \eqref{eq:pr-red-trib-060}, \eqref{eq:pr-red-trib-160}.
        \end{gathered}
\end{equation}
With the foregoing, we have our tributary aletheme:
\begin{equation}
\label{eq:pr-red-trib-180}
        \begin{gathered}
        \V{tribAL} =
                \left( \begin{gathered}
                        \V{rhs},\epsilon,(\V{fore}\cat\V{antepre}),(\V{post}\cat\V{aft}),\V{B}, \\
                        \V{j},\V{current}
                \end{gathered} \right) \\
                \text{\cuz \Dfref{aletheme}, \Dfref{red-trib},
                        \eqref{eq:pr-red-trib-075}, \eqref{eq:pr-red-trib-090}, \eqref{eq:pr-red-trib-155},
                        \eqref{eq:pr-red-trib-170}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-190}
        \mycpar{The current location of \V{tribAL} is \V{current} \cuz \eqref{eq:pr-red-trib-180}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-200}
        \mycpar{The joint location of \V{tribAL} is \V{j} \cuz \Dfref{red-trib}, \eqref{eq:pr-red-trib-180}.}
\end{equation}
For the lemma, it remains to show the relationship between the rank of the tributary
and its downstream.
\begin{equation}
\label{eq:pr-red-trib-310}
        \mycpar{Let \V{DownMinD}, ``downAl minimum depth''  be the minimum number of steps in the derivation \\
        $\V{S} \destar \V{fore} \cat \V{A} \cat \V{aft}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-320}
        \mycpar{\VFA{Dp}{downAL} = \V{DownMinD} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-010}, \eqref{eq:pr-red-trib-310}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-330}
        \mycpar{Let \V{TribMinD}, ``tribAl minimum depth''  be the minimum number of steps in the derivation \\
        $\V{S} \destar \V{fore} \cat \V{antepre} \cat \V{B} \cat \V{post} \cat \V{aft}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-340}
        \mycpar{\VFA{Dp}{tribAL} = \V{TribMinD} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-010}, \eqref{eq:pr-red-trib-330}.}
\end{equation}
Whatever the value of \V{TribMinD},
because of the derivation
\begin{equation}
\label{eq:pr-red-trib-350}
        \mycpar{$\V{S} \destar \V{fore} \cat \V{A} \cat \V{aft}$ \\
        $\derives \V{fore} \cat \V{antepre} \cat \V{B} \cat \V{post} \cat \V{aft},$
        }
\end{equation}
the derivation of \eqref{eq:pr-red-trib-310}
cannot be longer than one step more than the derivation in \eqref{eq:pr-red-trib-310},
\begin{equation}
\label{eq:pr-red-trib-360}
        \V{TribMinD} \le \V{DownMinD} + 1,
\end{equation}
so that
\begin{equation}
\label{eq:pr-red-trib-370}
        \VFA{Dp}{tribAl} \le \VFA{Dp}{downAL} + 1.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-450}
        \mycpar{Let \V{downMinH} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \cat \V{B} \destar \Velement{w}{0,\V{current}}$ \\
        \cuz \eqref{eq:pr-red-trib-040}, \eqref{eq:pr-red-trib-060}.
        }
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-460}
        \mycpar{\VFA{Ht}{downAL} = \V{downMinH} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-010}, \eqref{eq:pr-red-trib-450}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-470}
        \mycpar{Let \V{tribMinH} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \cat \V{rhs} \destar \Velement{w}{0,\V{current}}$ \\
        \cuz \eqref{eq:pr-red-trib-040}, \eqref{eq:pr-red-trib-060}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-480}
        \mycpar{\VFA{Ht}{tribAL} = \V{tribMinH} \\
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-180}, \eqref{eq:pr-red-trib-470}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-490}
        \mycpar{Let \V{H1} be the minimum number of steps in the derivation \\
        $\V{fore} \cat \V{antepre} \destar \Velement{w}{0,\V{j}}$ \\
        \cuz \eqref{eq:pr-red-trib-060}, \eqref{eq:pr-red-trib-170}.}
\end{equation}
Recalling from above the derivation
\begin{equation}
\label{eq:pr-red-trib-500}
        \mycpar{$\V{B} \derivesV{minDrv} \V{rhs} \destarV{minDrv} \Velement{w}{\V{j},\V{current}}$
        \cuz \eqref{eq:pr-red-trib-070},}
\end{equation}
where
\begin{equation}
\label{eq:pr-red-trib-510}
        \V{B} \destarV{minDrv} \Velement{w}{\V{j},\V{current}} \cuz \eqref{eq:pr-red-trib-500}.
\end{equation}
was a shortest derivation,
\begin{equation}
\label{eq:pr-red-trib-520}
        \mycpar{we let \V{HtB} be the minimum number of steps in the derivation
        $\V{B} \destar \Velement{w}{\V{j},\V{current}} \cuz \eqref{eq:pr-red-trib-500}$, and}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-530}
        \mycpar{we let \V{HtRHS} be the minimum number of steps in the derivation
        $\V{rhs} \destar \Velement{w}{\V{j},\V{current}} \cuz \eqref{eq:pr-red-trib-500},$}
\end{equation}
so that
\begin{equation}
\label{eq:pr-red-trib-540}
        \V{HtB} = \V{HtRHS}+1
                \cuz \eqref{eq:pr-red-trib-500}, \eqref{eq:pr-red-trib-510},
                        \eqref{eq:pr-red-trib-520}, \eqref{eq:pr-red-trib-530}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-550}
        \mycpar{$\VFA{Ht}{downAL} = \V{H1} + \V{HtB}
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-470}, \eqref{eq:pr-red-trib-480},
                \eqref{eq:pr-red-trib-490}, \eqref{eq:pr-red-trib-520}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-560}
        \mycpar{$\VFA{Ht}{tribAL} = \V{H1} + \V{HtRHS}
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-470}, \eqref{eq:pr-red-trib-480},
                \eqref{eq:pr-red-trib-490}, \eqref{eq:pr-red-trib-530}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-570}
        \mycpar{$\VFA{Ht}{downAL} = \VFA{Ht}{tribAL} + 1
        \cuz \Dfref{rank}, \eqref{eq:pr-red-trib-540}, \eqref{eq:pr-red-trib-550},
                \eqref{eq:pr-red-trib-560}.$}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-580}
        \VFA{Rank}{downAL} = \VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-590}
        \VFA{Rank}{tribAL} = \VFA{Dp}{tribAL} + 2 \mult \VFA{Ht}{tribAL} \cuz \Dfref{rank}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-600}
        \mycpar{$\VFA{Rank}{tribAL} = \VFA{Dp}{tribAL} + 2 \mult (\VFA{Ht}{downAL} \subtract 1)$ \\
                \cuz \eqref{eq:pr-red-trib-570}, \eqref{eq:pr-red-trib-590}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-610}
        \mycpar{$\VFA{Rank}{tribAL} \le (\VFA{Dp}{downAL}+1) + 2 \mult (\VFA{Ht}{downAL} \subtract 1)$ \\
                \cuz \eqref{eq:pr-red-trib-370}, \eqref{eq:pr-red-trib-600}.}
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-620}
        \VFA{Rank}{tribAL} \le \VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL} + 1 \subtract 2 \cuz
                \eqref{eq:pr-red-trib-610}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-630}
        \VFA{Rank}{tribAL} \le \VFA{Dp}{downAL} + 2 \mult \VFA{Ht}{downAL} \subtract 1 \cuz
                \eqref{eq:pr-red-trib-620}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-640}
        \VFA{Rank}{tribAl} \le \VFA{Rank}{downAL} \subtract 1
        \cuz \eqref{eq:pr-red-trib-580}, \eqref{eq:pr-red-trib-630}.
\end{equation}
\begin{equation}
\label{eq:pr-red-trib-650}
        \VFA{Rank}{tribAl} < \VFA{Rank}{downAL}
        \cuz \eqref{eq:pr-red-trib-640}.
\end{equation}
With \eqref{eq:pr-red-trib-180}, \eqref{eq:pr-red-trib-190}, \eqref{eq:pr-red-trib-200},
and \eqref{eq:pr-red-trib-650},
we have the lemma.
        \todo{Check this lemma}
\myqed
\end{proof}

\begin{lemma}[Prediction mainstem]
\todo{Define predot symbol instance}
        \label{lm:pred-stem}
        Let \V{downAL} be a prediction aletheme
        whose current location is \V{current}.
        Then \V{downAL} has a mainstem \V{stemAL}
        at current location \V{j},
        the current location of \V{stemAL} is \V{j},
        and
        \[
                \VFA{Rank}{stemAL} < \VFA{Rank}{downAL}. \quad \lmEnd
        \]
\end{lemma}

\begin{proof}
        \todo{Write this proof}
        \myqed
\end{proof}

\section{Completion lemmas}

\begin{definition}[Complete ``as far as'']
\label{df:complete-as-far}
        We say that an Earley chart \V{ch} is
        \textbf{complete as far as} row \V{i},
        if all alethemes in the
        rows from 0 to \V{i} are present in the chart.
        We say that an Earley chart is
        \textbf{complete as far as} rank \V{r} of row \V{i},
        if the chart is complete as far as row $\V{i} \subtract 1$,
        and if all alethemes of rank
        from 0 to \V{r} in row \V{i} are present in the chart.
\dfEnd
\end{definition}

\begin{lemma}[Previous row inflows]
        \label{lm:prev-inflows}
        If the chart is complete as far as row \V{i},
        then Earley events
        for all alethemes in row \V{i} and earlier
        will be present in the chart
        throughout every activation event
        in row $\V{i}+1$.
        \lmEnd
\end{lemma}

\begin{proof}
        \begin{equation}
        \label{eq:pr-prev-inflows-010}
                \mycpar{Let \V{ev} be an activation event in row
                \V{j}, but otherwise arbitrary
                \cuz AF lemma, WLOG.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-020}
                \mycpar{Let \V{al} be an aletheme,
                in row \V{i}, $\V{i}<\V{j}$,
                but otherwise arbitrary
                \cuz AF lemma, WLOG.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-030}
                \mycpar{Row \V{i} is complete \cuz AF lemma, WLOG.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-040}
                \mycpar{Let \V{ee} be the Earley entry corresponding to \V{al}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-050}
                \mycpar{\V{ee} will be recorded in the Earley chart \\
                        \cuz \Dfref{completeness},
                        \eqref{eq:pr-prev-inflows-020},
                        \eqref{eq:pr-prev-inflows-030},
                        \eqref{eq:pr-prev-inflows-040}.}
        \end{equation}
        In \eqref{eq:pr-prev-inflows-030}, we note that ``completeness'' is
        a concept which abstracts from the implementation.
        With \eqref{eq:pr-prev-inflows-050} we have shown that \V{ee} will be
        recorded in the Earley chart at some point,
        but we have not shown anything about when it will
        be recorded in terms of the implementation.
        In particular, we have yet to show that \V{ee} will have been
        recorded in the Earley chart
        before the event \V{ev} occurs.
        We proceed to do this.
        \begin{equation}
                \label{eq:pr-prev-inflows-060}
                \mycpar{If \V{ee} is in the Earley chart, it is recorded before
                any activation event in row \V{j} \cuz
                \Obref{activation-after-previous-row},
                        \eqref{eq:pr-prev-inflows-010},
                        \eqref{eq:pr-prev-inflows-020},
                        \eqref{eq:pr-prev-inflows-040}.}
        \end{equation}
        \begin{equation}
                \label{eq:pr-prev-inflows-070}
                \mycpar{If \V{ee} is in the Earley chart, it is recorded
                before the event \V{ev} occurs
                \cuz \eqref{eq:pr-prev-inflows-010},
                        \eqref{eq:pr-prev-inflows-060}.}
        \end{equation}
        We know that \V{ee} is in the Earley chart \eqref{eq:pr-prev-inflows-050}.
        We therefore conclude
        \begin{equation}
                \label{eq:pr-prev-inflows-080}
                \mycpar{\V{ee} is recorded before \V{ev} \cuz
                        \eqref{eq:pr-prev-inflows-050},
                        \eqref{eq:pr-prev-inflows-070}.}
        \end{equation}
        Our choice of \V{al}, \V{ee} and \V{ev} were WLOG,
        so that the lemma follows directly from
                \eqref{eq:pr-prev-inflows-080}.
        \myqed
\end{proof}

\begin{lemma}[Tangible reduction completion]
        \label{lm:rt-comp}
        When running the algorithm of \Sref{algorithm},
        if the chart is complete as far as rank \V{r}
        of row $\V{i}+1$,
        and \V{downAL} is a tangible reduction aletheme
        of rank $\V{r}+1$ in row $\V{i}+1$,
        then \Sref{algorithm} will record the Earley entry
        for \V{downAL} in the chart.
\end{lemma}

\begin{proof}
\begin{equation}
        \label{eq:pr-rt-comp-005}
        \mycpar{Let \V{downAL}
        be an arbitrary tangible reduction aletheme of rank
        $\V{r}+1$ in row $\V{i}+1$
        \cuz AF lemma.}
\end{equation}
        Without loss of generality, we let the Earley item of \V{downAL} be
\begin{equation}
        \label{eq:pr-rt-comp-010}
        \begin{gathered}
                \V{downEE} = (\V{A} \de \V{antepredot} \cat \V{B} \mydot \V{postdot}, \V{origin}, (\V{i}+1)) \\
        \text{\cuz AF lemma, \Dfref{ei-types}, WLOG.}
        \end{gathered}
\end{equation}
        where $\V{antepredot}, \V{postdot} \in \V{STR}$ and $\V{B} \in \V{N}$.
        Let \V{drv} be the derivation of \V{downAL}.
        By assumption for the lemma, \V{downEE} is tangible so that,
        where the predot symbol instance of \V{downAL} is \V{B:pd},
\begin{equation}
        \label{eq:pr-rt-comp-020}
        \begin{gathered}
                \existQ{\V{joint} \in \naturals}{\\
                        \V{B:pd} \destarV{drv} \Velement{w}{\V{joint}, (\V{i}+1)} \\
                        \land \; \V{joint} < (\V{i}+1)} \\
        \text{\cuz AF lemma, \eqref{eq:pr-rt-comp-010}.}
        \end{gathered}
\end{equation}
\begin{equation}
        \label{eq:pr-rt-comp-030}
        \mycpar{\V{joint} is the current location of \V{downEE} less the length of
        the terminal string produced by the predot symbol instance.
        \bcuz \eqref{eq:pr-rt-comp-020}.}
\end{equation}
Noting that a reduction is a confirmation,
\begin{equation}
        \label{eq:pr-rt-comp-040}
        \mycpar{\V{stemAL} is the mainstem of \V{downAL} at \V{joint}
        \bcuz \Lmref{conf-stem},
                \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-020}, \eqref{eq:pr-rt-comp-030}.}
\end{equation}
        The EE of \V{stemAL} is
\begin{equation}
\label{eq:pr-rt-comp-050}
        \begin{gathered}
                \V{stemEE} = (\V{A} \de \V{antepredot} \mydot \V{B} \cat \V{postdot}, \V{origin}, \V{joint}) \\
        \cuz \Dfref{conf-stem}, \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-040}.
        \end{gathered}
\end{equation}
We now turn to consider the tributary of \V{downAL}.
\begin{equation}
        \label{eq:pr-rt-comp-090}
        \mycpar{\V{tribAL} is the tributary of \V{downAL} at \V{joint} \\
        \cuz \Lmref{red-trib},
                \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-020}, \eqref{eq:pr-rt-comp-030}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-100}
        \mycpar{The Earley entry of \V{tribAL} is \\
                $\V{tribEE} = (\V{B} \de \V{rhs} \mydot, \V{joint}, (\V{i}+1))$ \\
        where $\V{B} \de \V{rhs} \in \V{P}$ \\
        \cuz \Dfref{red-trib}, \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-090}, WLOG.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-200}
        \mycpar{$\VFA{Rank}{tribAl} < \VFA{Rank}{downAL}$
                \cuz \Lmref{red-trib}, \eqref{eq:pr-rt-comp-010}, \eqref{eq:pr-rt-comp-090}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-210}
        \mycpar{$\VFA{Rank}{downAL} = \V{r} + 1$
                \cuz \eqref{eq:pr-rt-comp-005}, \eqref{eq:pr-rt-comp-200}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-220}
        \mycpar{$0 \le \VFA{Rank}{tribAL} \le \V{r}$
                \cuz \eqref{eq:pr-rt-comp-200}, \eqref{eq:pr-rt-comp-210}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-230}
        \mycpar{The chart is complete as far as rank \V{r} of row $\V{i}+1$ \\
        \cuz AF lemma.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-240}
        \begin{gathered}
                \text{\V{tribEE} is in the chart
                        \cuz \eqref{eq:pr-rt-comp-100},
                        \eqref{eq:pr-rt-comp-220}, \eqref{eq:pr-rt-comp-230}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-250}
        \begin{gathered}
                \text{\V{tribEE} will be activated exactly once
                        \cuz \Obref{activation-unique},
                        \eqref{eq:pr-rt-comp-240}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-260}
        \begin{gathered}
                \text{\V{tribEE} will be activated
                at row $\V{i}+1$
                        \cuz \Obref{activation-at-currloc}, \eqref{eq:pr-rt-comp-100}.}
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-270}
        \mycpar{If \V{stemEE} is in the chart, it will be in row \V{joint},
            $\V{joint} < \V{i}+1$ \cuz \eqref{eq:pr-rt-comp-020}, \eqref{eq:pr-rt-comp-050}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-280}
        \mycpar{Rows 0 thru $\V{i}+1$ are complete \cuz AF lemma.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-290}
        \mycpar{Row \V{joint} is complete \cuz \eqref{eq:pr-rt-comp-270}, \eqref{eq:pr-rt-comp-280}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-300}
                \mycpar{\V{stemEE} will be in row \V{joint} of the chart when
                \V{tribEE} is activated
        \cuz \Lmref{prev-inflows}, \eqref{eq:pr-rt-comp-260}, \eqref{eq:pr-rt-comp-270},
                        \eqref{eq:pr-rt-comp-290}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-310}
        \mycpar{When run for \V{tribEE}, \Algref{tangible-reduction}
            looks for \V{stemEE} in row \V{joint} and,
            if it finds it, records \V{downEE} \cuz \Algref{tangible-reduction}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-320}
        \mycpar{When run for \V{tribEE}, \Algref{tangible-reduction}
            records \V{downEE} \cuz \Algref{tangible-reduction}
                \eqref{eq:pr-rt-comp-300}, \eqref{eq:pr-rt-comp-310}.}
\end{equation}
Keeping in mind that \V{tribEE} is a completion, and tangible,
\begin{equation}
\label{eq:pr-rt-comp-330}
        \mycpar{When \V{tribEE} is activated, \Algref{tangible-reduction}
        is run for \V{tribEE} \\
        \cuz lines \ref{li:finish-row-050}--\ref{li:finish-row-080} of \Algref{finish-row},
                \eqref{eq:pr-rt-comp-020}, \eqref{eq:pr-rt-comp-100}.}
\end{equation}
\begin{equation}
\label{eq:pr-rt-comp-340}
        \mycpar{\Sref{algorithm} records \V{downEE}
                \cuz \eqref{eq:pr-rt-comp-320}, \eqref{eq:pr-rt-comp-330}.}
\end{equation}
Equation \eqref{eq:pr-rt-comp-340} is what we needed to show
for the lemma.
\todo{Recheck this lemma}
\myqed
\end{proof}

\begin{lemma}[Chart basis]
        \label{lm:chart-basis}
        After starting the algorithm of \Sref{algorithm},
        the chart is complete as far as row 0.
        \lmEnd
\end{lemma}

\begin{proof}
        Proof omitted.
        \myqed
\end{proof}

\begin{lemma}[Scansion completion]
        \label{lm:row-basis}
        When running the algorithm of \Sref{algorithm},
        scansion will be complete in row $\V{i}+1$ the chart
        is complete as far as row \V{i}.
        \lmEnd
\end{lemma}

\begin{proof}
        Proof is omitted because it is straightforward,
        and essentially the same
        as others in the literature.
        \myqed
\end{proof}

\begin{lemma}[Row completion step]
        \label{lm:row-step}
        When running the algorithm of \Sref{algorithm},
        reductions will be complete as far as generation $\V{g}+1$
        of row $\V{i}+1$ if
        the chart is complete
        as far as generation \V{g} of row $\V{i+1}$.
        \lmEnd
\end{lemma}

\begin{proof}
        \todo{Write this proof}
        \myqed
\end{proof}

\begin{lemma}[Intangible reduction completion]
        \label{lm:ri-comp}
        When running the algorithm of \Sref{algorithm},
        if the chart is complete as far as generation \V{g}
        of row $\V{i}+1$,
        the algorithm will add all intangible reductions
        in generation $\V{g}+1$ to the chart.
\end{lemma}

\begin{proof}
        \todo{Recheck from here}
        Let \V{downFD}
        be an arbitrary intangible reduction FD in generation
        $\V{g}+1$ of row $\V{i}+1$.
        Let the derivative of \V{downFD} be \V{drv},
        and let the predot symbol instance be \V{B:pd}.
        Without loss of generality, we let the Earley item of \V{downFD} be
\begin{equation}
        \label{eq:pr-ri-comp-010}
        \begin{gathered}
                \V{downEI} = (\V{A} \de \V{antepredot} \cat \V{B} \mydot \V{postdot}, \V{origin}, (\V{i}+1)) \\
        \text{\cuz AF lemma, \Dfref{ei-types}, WLOG.}
        \end{gathered}
\end{equation}
        where $\V{antepredot}, \V{postdot} \in \V{STR}$ and $\V{B} \in \V{N}$.
        Because by assumption for the lemma, \V{downFD} is intangible,
\begin{equation}
        \label{eq:pr-ri-comp-020}
        \V{B:pd} \destarV{drv} \epsilon \text{ \cuz AF lemma, \eqref{eq:pr-ri-comp-010}.}
\end{equation}
\begin{equation}
        \label{eq:pr-ri-comp-030}
        \mycpar{\V{joint} is the current location of \V{fdConf} less the length of
        the terminal string produced by the predot symbol instance.
        \bcuz \eqref{eq:pr-ri-comp-020}.}
\end{equation}
Noting that a reduction is a confirmation,
\begin{equation}
        \label{eq:pr-ri-comp-040}
        \mycpar{\V{stemFD} is the mainstem of \V{downFD} at \V{joint}
        \bcuz \Lmref{conf-stem},
                \eqref{eq:pr-ri-comp-010}, \eqref{eq:pr-ri-comp-020}, \eqref{eq:pr-ri-comp-030}.}
\end{equation}
The EI of \V{stemFD} is
\begin{equation}
\label{eq:pr-ri-comp-050}
        \begin{gathered}
                \V{stemEI} = (\V{A} \de \V{antepredot} \mydot \V{B} \cat \V{postdot}, \V{origin}, (\V{i}+1)) \\
        \cuz \Dfref{conf-stem}, \eqref{eq:pr-ri-comp-010}, \eqref{eq:pr-ri-comp-020},
                \eqref{eq:pr-ri-comp-040}.
        \end{gathered}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-200}
        \text{\V{downFD} is in generation $\V{g}+1$ \cuz AF lemma.}
\end{equation}
Recalling that the generation inflow of a intangible reduction is its mainflow,
\begin{equation}
\label{eq:pr-ri-comp-210}
        \text{\V{stemFD} is in generation \V{g} \cuz \Dfref{rank},
                \eqref{eq:pr-ri-comp-040}, \eqref{eq:pr-ri-comp-200}.}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-220}
        \mycpar{Generations 0 through \V{g} of row $\V{i}+1$ are complete \\
                \cuz AF lemma.}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-230}
        \begin{gathered}
                \text{\V{stemEI} is in the chart
                        \cuz \eqref{eq:pr-ri-comp-210}, \eqref{eq:pr-ri-comp-220}.}
        \end{gathered}
\end{equation}
Recalling again that \V{downFD} is intangible,
\begin{equation}
\label{eq:pr-ri-comp-240}
        \mycpar{Line \ref{li:finish-row-120} of \Algref{finish-row} calls
        \Algref{intangible-reduction} for \V{stemEI}
        \cuz \eqref{eq:pr-ri-comp-050}.}
\end{equation}
\begin{equation}
\label{eq:pr-ri-comp-300}
        \mycpar{Line \ref{li:intangible-reduction-record-edge}
        in \Algref{intangible-reduction} adds \V{downEI}
        to the chart \\
        \cuz \eqref{eq:pr-ri-comp-010}.}
\end{equation}
Equation \eqref{eq:pr-ri-comp-300} is what we needed to show
for the lemma.
\myqed
\end{proof}

\begin{lemma}[Chart step]
        \label{lm:chart-step}
        When running the algorithm of \Sref{algorithm},
        the chart is complete as far as row $\V{i}+1$
        if it is complete as row \V{i}.
        \lmEnd
\end{lemma}

\begin{proof}
        We use induction on the generations of row \V{i}.
        \todo{Finish this proof}
        \myqed
\end{proof}

\begin{theorem}[The llguidance Earley algorithm is complete]
        After running the algorithm of \Sref{algorithm},
        the llguidance Earley algorithm is complete.
        \lmEnd
\end{theorem}

\begin{proof}
        We use induction on the rows.
        with \Lmref{chart-basis} as the basis,
        and \Lmref{chart-step} as the step.
        \todo{Finish this proof}
        \myqed
\end{proof}

\FloatBarrier

{
\clearpage

% Ragged right, do not hyphenate.
\RaggedRight
\hyphenpenalty=10000
\exhyphenpenalty=10000

% Silence current hbox warnings, but allow them if
% badness increases further
\hbadness=2000

\begin{thebibliography}{10}

\bibitem{AH1972v1}
\newblock{Aho, Alfred V., and Jeffrey D. Ullman.}
\newblock{\em The theory of parsing, translation, and compiling. Vol. 1.}
\newblock{Prentice-Hall, 1972.}

\bibitem{Kegler2023}
\newblock{Jeffrey Kegler.}
\newblock{``Marpa, A practical general parser: the recognizer''.}
\newblock{\url{https://arxiv.org/abs/1910.08129}.
   Retrieved 2 December, 2024.}

\bibitem{llguidance}
\newblock{llguidance team.}
\newblock{"Low-level guidance parser".}
\newblock{
  \url{https://github.com/microsoft/llguidance}.
  Retrieved 2 December, 2024.}

\end{thebibliography}

} % RaggedRight

% \clearpage
% \phantomsection
% \listofalgorithms

\clearpage
\phantomsection
\renewcommand{\listtheoremname}{Formal apparatus}

\clearpage
\phantomsection
\pdfbookmark[0]{\listtheoremname}{listoflemmas}
% swapnumber would be cool, but is not in the thmtools in
% the latest Raspbian
\listoftheorems[ignoreall,onlynamed=observation,
    show={lemma,ldef,theorem,example,remark,definition}]

\ifdraft{
    \clearpage
    \phantomsection
    \listoftodos
}{}

\end{document}
